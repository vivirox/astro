"use strict";exports.id=80,exports.ids=[80],exports.modules={325:(e,t,r)=>{r.a(e,async(e,s)=>{try{let a;r.d(t,{Ay:()=>c,_K:()=>d});var o=r(2971),n=e([o]);let l=(o=(n.then?(await n)():n)[0]).z.object({NODE_ENV:o.z.enum(["development","production","test"]).default("development"),VERCEL:o.z.string().optional(),VERCEL_ENV:o.z.enum(["development","preview","production"]).optional(),VERCEL_URL:o.z.string().optional(),VERCEL_TOKEN:o.z.string().optional(),VERCEL_ORG_ID:o.z.string().optional(),VERCEL_PROJECT_ID:o.z.string().optional(),PORT:o.z.string().transform(Number).default("3000"),LOG_LEVEL:o.z.enum(["error","warn","info","verbose","debug"]).default("info"),ENABLE_RATE_LIMITING:o.z.string().transform(e=>"true"===e).default("true"),POSTGRES_URL:o.z.string().optional(),POSTGRES_PRISMA_URL:o.z.string().optional(),POSTGRES_URL_NON_POOLING:o.z.string().optional(),SUPABASE_URL:o.z.string().url().optional(),SUPABASE_KEY:o.z.string().optional(),SUPABASE_ANON_KEY:o.z.string().optional(),SUPABASE_SERVICE_ROLE_KEY:o.z.string().optional(),SUPABASE_JWT_SECRET:o.z.string().optional(),OPENAI_API_KEY:o.z.string().optional(),OPENAI_BASE_URL:o.z.string().url().optional(),TOGETHER_API_KEY:o.z.string().optional(),GOOGLE_API_KEY:o.z.string().optional(),REPLICATE_API_TOKEN:o.z.string().optional(),SENTRY_DSN:o.z.string().url().optional(),AXIOM_DATASET:o.z.string().optional(),AXIOM_TOKEN:o.z.string().optional(),VITE_LITLYX_PROJECT_ID:o.z.string().optional(),VITE_LITLYX_API_KEY:o.z.string().optional(),EMAIL_FROM:o.z.string().email().optional(),RESEND_API_KEY:o.z.string().optional(),SECURITY_ENABLE_BRUTE_FORCE_PROTECTION:o.z.string().transform(e=>"true"===e).default("true"),SECURITY_MAX_LOGIN_ATTEMPTS:o.z.string().transform(Number).default("5"),SECURITY_ACCOUNT_LOCKOUT_DURATION:o.z.string().transform(Number).default("1800"),SECURITY_API_ABUSE_THRESHOLD:o.z.string().transform(Number).default("100"),SECURITY_ENABLE_ALERTS:o.z.string().transform(e=>"true"===e).default("true"),RATE_LIMIT_MAX_REQUESTS:o.z.string().transform(Number).default("100"),RATE_LIMIT_WINDOW_MS:o.z.string().transform(Number).default("900000"),LOG_CONSOLE:o.z.string().transform(e=>"true"===e).default("true"),LOG_AUDIT:o.z.string().transform(e=>"true"===e).default("true"),VITE_API_URL:o.z.string().url().optional(),VITE_SUPABASE_URL:o.z.string().url().optional(),VITE_SUPABASE_ANON_KEY:o.z.string().optional()});function i(){return a||(a=l.parse(process.env)),a}let d=i(),c={isDevelopment:()=>"development"===i().NODE_ENV,isProduction:()=>"production"===i().NODE_ENV,isTest:()=>"test"===i().NODE_ENV,server:{port:()=>i().PORT,logLevel:()=>i().LOG_LEVEL,enableRateLimiting:()=>i().ENABLE_RATE_LIMITING},database:{url:()=>i().POSTGRES_URL,prismaUrl:()=>i().POSTGRES_PRISMA_URL,nonPoolingUrl:()=>i().POSTGRES_URL_NON_POOLING},supabase:{url:()=>i().SUPABASE_URL,key:()=>i().SUPABASE_KEY,anonKey:()=>i().SUPABASE_ANON_KEY,serviceRoleKey:()=>i().SUPABASE_SERVICE_ROLE_KEY,jwtSecret:()=>i().SUPABASE_JWT_SECRET},ai:{openAiKey:()=>i().OPENAI_API_KEY,openAiBaseUrl:()=>i().OPENAI_BASE_URL,togetherApiKey:()=>i().TOGETHER_API_KEY,googleApiKey:()=>i().GOOGLE_API_KEY,replicateToken:()=>i().REPLICATE_API_TOKEN},monitoring:{sentryDsn:()=>i().SENTRY_DSN,axiomDataset:()=>i().AXIOM_DATASET,axiomToken:()=>i().AXIOM_TOKEN,litlyxProjectId:()=>i().VITE_LITLYX_PROJECT_ID,litlyxApiKey:()=>i().VITE_LITLYX_API_KEY},email:{from:()=>i().EMAIL_FROM,resendApiKey:()=>i().RESEND_API_KEY},deployment:{vercelEnv:()=>i().VERCEL_ENV,isVercel:()=>i().VERCEL,vercelUrl:()=>i().VERCEL_URL,vercelToken:()=>i().VERCEL_TOKEN,vercelOrgId:()=>i().VERCEL_ORG_ID,vercelProjectId:()=>i().VERCEL_PROJECT_ID},security:{enableBruteForceProtection:()=>i().SECURITY_ENABLE_BRUTE_FORCE_PROTECTION,maxLoginAttempts:()=>i().SECURITY_MAX_LOGIN_ATTEMPTS,accountLockoutDuration:()=>i().SECURITY_ACCOUNT_LOCKOUT_DURATION,apiAbuseThreshold:()=>i().SECURITY_API_ABUSE_THRESHOLD,enableAlerts:()=>i().SECURITY_ENABLE_ALERTS},rateLimiting:{maxRequests:()=>i().RATE_LIMIT_MAX_REQUESTS,windowMs:()=>i().RATE_LIMIT_WINDOW_MS},logging:{console:()=>i().LOG_CONSOLE,audit:()=>i().LOG_AUDIT},client:{apiUrl:()=>i().VITE_API_URL,supabaseUrl:()=>i().VITE_SUPABASE_URL,supabaseAnonKey:()=>i().VITE_SUPABASE_ANON_KEY}};s()}catch(e){s(e)}})},339:(e,t,r)=>{r.d(t,{Ht:()=>o});var s=r(3939);async function o(e){try{console.log("Processing request:",e.url);let t=(0,s.createClient)((void 0).PUBLIC_SUPABASE_URL,(void 0).PUBLIC_SUPABASE_ANON_KEY),{data:r,error:o}=await t.auth.getSession();if(o||!r?.session)return console.log("Error getting session:",o),null;return{user:r?.session.user,session:r?.session}}catch(e){return console.error("Error getting session:",e),null}}!function(){var e=Error("Cannot find module '../audit/log.js'");throw e.code="MODULE_NOT_FOUND",e}()},2754:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{v_:()=>i});var o=r(8090);r(7048),r(3511);var n=e([o]);let i=new(o=(n.then?(await n)():n)[0]).h;s()}catch(e){s(e)}})},3480:(e,t,r)=>{e.exports=r(5600)},3511:(e,t,r)=>{var s=r(3939);let o=(void 0).PUBLIC_SUPABASE_URL,n=(void 0).PUBLIC_SUPABASE_ANON_KEY;o&&n?(0,s.createClient)(o,n):(console.warn("Using mock Supabase client in AI schema module. This should not be used in production."),()=>Promise.resolve({error:null}))},5754:(e,t,r)=>{let s;r.d(t,{iL:()=>a});var o=r(3939);let n=(void 0).PUBLIC_SUPABASE_URL,i=(void 0).PUBLIC_SUPABASE_ANON_KEY;async function a(e,t,r,o={},n){try{let i=new Date,a=null,l=null;if(n&&(a=n.headers.get("x-forwarded-for")||n.headers.get("x-real-ip"),l=n.headers.get("user-agent")),"string"==typeof e){let{error:n}=await s.from("audit_logs").insert({user_id:e,action:t,resource_id:r,resource_type:"unknown",metadata:o,timestamp:i.toISOString(),ip_address:a,user_agent:l});if(n){let s=`Error creating audit log: ${n.message}`;console.error(s,{userId:e,action:t,resource:r})}}else{let{error:t}=await s.from("audit_logs").insert({id:e.id,user_id:e.userId,action:e.action,resource_id:e.resource.id,resource_type:e.resource.type,metadata:e.metadata,timestamp:e.timestamp.toISOString()});if(t){let r=`Error creating audit log: ${t.message}`;console.error(r,{entry:e})}}}catch(e){console.error(`Exception in audit logging: ${e instanceof Error?e.message:String(e)}`)}}n&&i||console.error("CRITICAL: Missing Supabase credentials for audit logging in production"),n&&i?s=(0,o.createClient)(n,i):(console.warn("CRITICAL: Using mock Supabase client for audit logging in production. This should never happen."),s={from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})})},5934:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{ND:()=>A});var o=r(3939),n=r(325),i=e([n]);n=(i.then?(await i)():i)[0];let l="undefined"!=typeof process?process.env:{},d=l.NODE_ENV||"development",c="https://example.supabase.co",_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example",u="production"===d,m=n._K?.SUPABASE_URL||l.PUBLIC_SUPABASE_URL||(u?void 0:c),E=n._K?.SUPABASE_ANON_KEY||l.PUBLIC_SUPABASE_ANON_KEY||(u?void 0:_),p=n._K?.SUPABASE_SERVICE_ROLE_KEY;function a(){return console.warn(u?"CRITICAL: Using mock Supabase client in production. This should never happen.":"Using mock Supabase client for development. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:null}),signOut:()=>Promise.resolve({error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})}}!u||m&&E||console.error("CRITICAL: Missing Supabase credentials in production environment");let g=m&&m!==c&&E&&E!==_,A=g?(0,o.createClient)(m,E,{auth:{persistSession:!0,autoRefreshToken:!0}}):a();g&&p?(0,o.createClient)(m,p,{auth:{persistSession:!1,autoRefreshToken:!1}}):a(),s()}catch(e){s(e)}})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7048:(e,t,r)=>{r(5754),r(3511)},7626:(e,t,r)=>{r.d(t,{E:()=>s});function s(e){let t=e.togetherBaseUrl||"https://api.together.xyz/v1",r=e.apiKey||e.togetherApiKey;if(!r)throw Error("TogetherAI API key is required");async function s(e,o={}){try{let{model:s="mistralai/Mixtral-8x7B-Instruct-v0.2",temperature:n=.7,maxTokens:i=1e3}=o,a=e.map(e=>({role:e.role,content:e.content,name:e.name||"default_name"})),l=await fetch(`${t}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:s,messages:a,temperature:n,max_tokens:i})});if(!l?.ok){let e=await l?.json();throw Error(`TogetherAI API error: ${e.error?.message||l.statusText}`)}let d=await l?.json();return{id:d?.id||`together_${Date.now()}`,model:d?.model||s,created:Date.now(),content:d?.choices[0].message.content,choices:[{message:{role:"assistant",content:d?.choices[0].message.content,name:"assistant"},finishReason:d?.choices[0].finish_reason||"stop"}],usage:{promptTokens:d?.usage?.prompt_tokens||0,completionTokens:d?.usage?.completion_tokens||0,totalTokens:d?.usage?.total_tokens||0},provider:"together"}}catch(e){throw console.error("Error generating completion:",e),e}}return{generateCompletion:async(e,t)=>{let r=await s(e,t);return{content:r?.content,model:r?.model,usage:r?.usage?{promptTokens:r?.usage.promptTokens||0,completionTokens:r?.usage.completionTokens||0,totalTokens:r?.usage.totalTokens||0}:void 0}},createChatCompletion:async(e,t)=>s(e,t),createStreamingChatCompletion:async(e,t)=>(async function*(){throw yield{id:`together_${Date.now()}`,model:t?.model||"unknown",created:Date.now(),content:"",done:!0},Error("Streaming not supported yet")})(),getModelInfo:e=>({id:e,name:e,provider:"together",capabilities:["chat"],contextWindow:8192,maxTokens:8192}),createChatCompletionWithTracking:async(t,r)=>{let o=await s(t,r);return e.onUsage&&o?.usage&&await e.onUsage({timestamp:Date.now(),model:o?.model,promptTokens:o?.usage.promptTokens||0,completionTokens:o?.usage.completionTokens||0,totalTokens:o?.usage.totalTokens||0,id:o?.id,provider:"together"}),o},dispose:()=>{}}}},8090:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{h:()=>i});var o=r(5934),n=e([o]);o=(n.then?(await n)():n)[0];class i{async storeSentimentAnalysis(e){let{data:t,error:r}=await o.ND.from("ai_sentiment_analysis").insert({user_id:e?.userId,model_id:e?.modelId,model_provider:e?.modelProvider,request_tokens:e?.requestTokens,response_tokens:e?.responseTokens,total_tokens:e?.totalTokens,latency_ms:e?.latencyMs,success:e?.success,error:e?.error,text:e?.text,sentiment:e?.sentiment,score:e?.score,confidence:e?.confidence,metadata:e?.metadata}).select("id").single();if(r)throw console.error("Error storing sentiment analysis:",r),r;return t?.id}async storeCrisisDetection(e){let{data:t,error:r}=await o.ND.from("ai_crisis_detection").insert({user_id:e?.userId,model_id:e?.modelId,model_provider:e?.modelProvider,request_tokens:e?.requestTokens,response_tokens:e?.responseTokens,total_tokens:e?.totalTokens,latency_ms:e?.latencyMs,success:e?.success,error:e?.error,text:e?.text,crisis_detected:e?.crisisDetected,crisis_type:e?.crisisType,confidence:e?.confidence,risk_level:e?.riskLevel,sensitivity_level:e?.sensitivityLevel,metadata:e?.metadata}).select("id").single();if(r)throw console.error("Error storing crisis detection:",r),r;return t?.id}async storeResponseGeneration(e){let{data:t,error:r}=await o.ND.from("ai_response_generation").insert({user_id:e?.userId,model_id:e?.modelId,model_provider:e?.modelProvider,request_tokens:e?.requestTokens,response_tokens:e?.responseTokens,total_tokens:e?.totalTokens,latency_ms:e?.latencyMs,success:e?.success,error:e?.error,prompt:e?.prompt,response:e?.response,context:e?.context,instructions:e?.instructions,temperature:e?.temperature,max_tokens:e?.maxTokens,metadata:e?.metadata}).select("id").single();if(r)throw console.error("Error storing response generation:",r),r;return t?.id}async storeInterventionAnalysis(e){if(!e?.userId||!e?.modelId||!e?.modelProvider)throw Error("Missing required fields");let{data:t,error:r}=await o.ND.from("ai_intervention_analysis").insert({user_id:e?.userId,model_id:e?.modelId,model_provider:e?.modelProvider,request_tokens:e?.requestTokens??0,response_tokens:e?.responseTokens??0,total_tokens:e?.totalTokens??0,latency_ms:e?.latencyMs??0,success:e?.success??!1,error:e?.error??null,conversation:e?.conversation,intervention:e?.intervention,user_response:e?.userResponse,effectiveness:e?.effectiveness,insights:e?.insights,recommended_follow_up:e?.recommendedFollowUp??null,metadata:e?.metadata??null}).select("id").single();if(r)throw console.error("Error storing intervention analysis:",r),r;return t?.id}async updateUsageStats(e){let{error:t}=await o.ND.from("ai_usage_stats").upsert({user_id:e.userId,period:e.period,date:e.date.toISOString().split("T")[0],total_requests:e.totalRequests,total_tokens:e.totalTokens,total_cost:e.totalCost,model_usage:e.modelUsage},{onConflict:"user_id, period, date"});if(t)throw console.error("Error updating AI usage stats:",t),t}async getSentimentAnalysisByUser(e,t=10,r=0){let{data:s,error:n}=await o.ND.from("ai_sentiment_analysis").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw console.error("Error getting sentiment analysis:",n),n;return s?.map(e=>({id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),modelId:e.model_id,modelProvider:e.model_provider,requestTokens:e.request_tokens,responseTokens:e.response_tokens,totalTokens:e.total_tokens,latencyMs:e.latency_ms,success:e.success,error:e.error,text:e.text,sentiment:e.sentiment,score:e.score,confidence:e.confidence,metadata:e.metadata||{}}))}async getCrisisDetectionByUser(e,t=10,r=0){let{data:s,error:n}=await o.ND.from("ai_crisis_detection").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw console.error("Error getting crisis detection:",n),n;return s?.map(e=>({id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),modelId:e.model_id,modelProvider:e.model_provider,requestTokens:e.request_tokens,responseTokens:e.response_tokens,totalTokens:e.total_tokens,latencyMs:e.latency_ms,success:e.success,error:e.error,text:e.text,crisisDetected:e.crisis_detected,crisisType:e.crisis_type,confidence:e.confidence,riskLevel:e.risk_level,sensitivityLevel:e.sensitivity_level,metadata:e.metadata||{}}))}async getResponseGenerationByUser(e,t=10,r=0){let{data:s,error:n}=await o.ND.from("ai_response_generation").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw console.error("Error getting response generation:",n),n;return s?.map(e=>({id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),modelId:e.model_id,modelProvider:e.model_provider,requestTokens:e.request_tokens,responseTokens:e.response_tokens,totalTokens:e.total_tokens,latencyMs:e.latency_ms,success:e.success,error:e.error,prompt:e.prompt,response:e.response,context:e.context,instructions:e.instructions,temperature:e.temperature,maxTokens:e.max_tokens,metadata:e.metadata||{}}))}async getInterventionAnalysisByUser(e,t=10,r=0){let{data:s,error:n}=await o.ND.from("ai_intervention_analysis").select("*").eq("user_id",e).order("created_at",{ascending:!1}).range(r,r+t-1);if(n)throw console.error("Error getting intervention analysis:",n),n;return s?.map(e=>({id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),modelId:e.model_id,modelProvider:e.model_provider,requestTokens:e.request_tokens,responseTokens:e.response_tokens,totalTokens:e.total_tokens,latencyMs:e.latency_ms,success:e.success,error:e.error,conversation:e.conversation,intervention:e.intervention,userResponse:e.user_response,effectiveness:e.effectiveness,insights:e.insights,recommendedFollowUp:e.recommended_follow_up,metadata:e.metadata||{}}))}async getUsageStatsByUser(e,t,r=30){let{data:s,error:n}=await o.ND.from("ai_usage_stats").select("*").eq("user_id",e).eq("period",t).order("date",{ascending:!1}).limit(r);if(n)throw console.error("Error getting AI usage stats:",n),n;return s?.map(e=>({userId:e.user_id,period:e.period,date:new Date(e.date),totalRequests:e.total_requests,totalTokens:e.total_tokens,totalCost:e.total_cost,modelUsage:e.model_usage}))}async getAllUsageStats(e,t=30){let{data:r,error:s}=await o.ND.from("ai_usage_stats").select("*").eq("period",e).order("date",{ascending:!1}).limit(t);if(s)throw console.error("Error getting all AI usage stats:",s),s;return r?.map(e=>({userId:e.user_id,period:e.period,date:new Date(e.date),totalRequests:e.total_requests,totalTokens:e.total_tokens,totalCost:e.total_cost,modelUsage:e.model_usage}))}async getHighRiskCrisisDetections(e=20,t=0){let{data:r,error:s}=await o.ND.from("ai_crisis_detection").select("*").in("risk_level",["high","critical"]).eq("crisis_detected",!0).order("created_at",{ascending:!1}).range(t,t+e-1);if(s)throw console.error("Error getting high risk crisis detections:",s),s;return r?.map(e=>({id:e.id,userId:e.user_id,createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at),modelId:e.model_id,modelProvider:e.model_provider,requestTokens:e.request_tokens,responseTokens:e.response_tokens,totalTokens:e.total_tokens,latencyMs:e.latency_ms,success:e.success,error:e.error,text:e.text,crisisDetected:e.crisis_detected,crisisType:e.crisis_type,confidence:e.confidence,riskLevel:e.risk_level,sensitivityLevel:e.sensitivity_level,metadata:e.metadata||{}}))}}s()}catch(e){s(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};