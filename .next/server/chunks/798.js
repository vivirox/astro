"use strict";exports.id=798,exports.ids=[798],exports.modules={339:(e,r,t)=>{t.d(r,{Ht:()=>n});var o=t(3939);async function n(e){try{console.log("Processing request:",e.url);let r=(0,o.createClient)((void 0).PUBLIC_SUPABASE_URL,(void 0).PUBLIC_SUPABASE_ANON_KEY),{data:t,error:n}=await r.auth.getSession();if(n||!t?.session)return console.log("Error getting session:",n),null;return{user:t?.session.user,session:t?.session}}catch(e){return console.error("Error getting session:",e),null}}!function(){var e=Error("Cannot find module '../audit/log.js'");throw e.code="MODULE_NOT_FOUND",e}()},3480:(e,r,t)=>{e.exports=t(5600)},5754:(e,r,t)=>{let o;t.d(r,{iL:()=>a});var n=t(3939);let i=(void 0).PUBLIC_SUPABASE_URL,s=(void 0).PUBLIC_SUPABASE_ANON_KEY;async function a(e,r,t,n={},i){try{let s=new Date,a=null,l=null;if(i&&(a=i.headers.get("x-forwarded-for")||i.headers.get("x-real-ip"),l=i.headers.get("user-agent")),"string"==typeof e){let{error:i}=await o.from("audit_logs").insert({user_id:e,action:r,resource_id:t,resource_type:"unknown",metadata:n,timestamp:s.toISOString(),ip_address:a,user_agent:l});if(i){let o=`Error creating audit log: ${i.message}`;console.error(o,{userId:e,action:r,resource:t})}}else{let{error:r}=await o.from("audit_logs").insert({id:e.id,user_id:e.userId,action:e.action,resource_id:e.resource.id,resource_type:e.resource.type,metadata:e.metadata,timestamp:e.timestamp.toISOString()});if(r){let t=`Error creating audit log: ${r.message}`;console.error(t,{entry:e})}}}catch(e){console.error(`Exception in audit logging: ${e instanceof Error?e.message:String(e)}`)}}i&&s||console.error("CRITICAL: Missing Supabase credentials for audit logging in production"),i&&s?o=(0,n.createClient)(i,s):(console.warn("CRITICAL: Using mock Supabase client for audit logging in production. This should never happen."),o={from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})})},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7452:(e,r,t)=>{t.d(r,{hS:()=>f});var o=t(1708),n=t.n(o);let i=(0,t(8951).tZ)(),s={enabled:!0,localStorageEnabled:!0,remoteStorageEnabled:!0,remoteEndpoint:n().env.AUDIT_LOG_ENDPOINT,encryptLogs:!0,retentionDays:90,batchSize:100,debugMode:!1},a=[],l=null,d={...s};async function u(){if(0===a.length)return;let e=a.splice(0,d.batchSize);if(d.remoteStorageEnabled&&d.remoteEndpoint)try{await c(e)}catch(r){i.error("Failed to send audit logs to remote endpoint",r),a=[...e,...a]}}async function c(e){if(d.remoteEndpoint)try{let r=await fetch(d.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":n().env.AUDIT_API_KEY||""},body:JSON.stringify({logs:e,source:"therapy-chat-app",timestamp:new Date().toISOString()})});if(!r.ok)throw Error(`Remote logging failed: ${r.status} ${r.statusText}`);d.debugMode&&i.debug(`Sent ${e.length} audit logs to remote endpoint`)}catch(e){throw i.error("Error sending logs to remote endpoint",e),e}}d={...s},i.info("HIPAA Audit logging service initialized"),d.remoteStorageEnabled&&d.remoteEndpoint&&(l&&clearInterval(l),l=setInterval(()=>{a.length>0&&u()},6e4));class g extends Error{constructor(e,r="unknown_error",t,o){super(e),this.name="AIError",this.type=r,this.status=t||p[r]||500,this.details=o}}let p={validation_error:400,authentication_error:401,authorization_error:403,rate_limit_error:429,provider_error:502,model_error:404,input_error:400,system_error:500,invalid_response_error:500,unknown_error:500};function f(e){return e instanceof g?new Response(JSON.stringify({error:e?.type,message:e?.message,details:e?.details}),{status:e?.status,headers:{"Content-Type":"application/json"}}):e&&"object"==typeof e&&"type"in e&&e?.type==="rate_limit_exceeded"?new Response(JSON.stringify({error:"rate_limit_error",message:"Rate limit exceeded",details:{retryAfter:e.retryAfter}}),{status:429,headers:{"Content-Type":"application/json","Retry-After":String(e.retryAfter||60)}}):e instanceof TypeError?new Response(JSON.stringify({error:"system_error",message:"Network or system error",details:e?.message}),{status:500,headers:{"Content-Type":"application/json"}}):new Response(JSON.stringify({error:"unknown_error",message:e instanceof Error?e?.message:"An unknown error occurred"}),{status:500,headers:{"Content-Type":"application/json"}})}},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,r,t)=>{let o;t.d(r,{tZ:()=>a});var n=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let i=()=>process.env.LOG_LEVEL||"info";class s{constructor(e="info",r){this.debug=(e,r)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,r))},this.info=(e,r)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,r))},this.warn=(e,r)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,r))},this.error=(e,r)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,r))},this.logLevel=e,this.isDevelopment=!1,this.prefix=r}createLogEntry(e,r,t){return{message:this.prefix?`[${this.prefix}] ${r}`:r,level:e,timestamp:Date.now(),metadata:t}}formatLogEntry({message:e,level:r,timestamp:t,metadata:o}){let n=new Date(t).toISOString(),i=o?` ${JSON.stringify(o)}`:"";return`[${n}] [${r.toUpperCase()}] ${e}${i}`}writeLog(e){let r=this.formatLogEntry(e);switch(e.level){case"error":console.error(r);break;case"warn":case"info":case"debug":console.warn(r)}}shouldLog(e){let r=Object.values(n),t=r.indexOf(this.logLevel);return r.indexOf(e)>=t}}function a(e){return(o||(o=new s(i())),e?.prefix)?new s(i(),e.prefix):o}a()}};