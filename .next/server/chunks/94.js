"use strict";exports.id=94,exports.ids=[94],exports.modules={901:(e,t,i)=>{i.d(t,{JZ:()=>n,vS:()=>r});var r=function(e){return e.NONE="none",e.STANDARD="standard",e.HIPAA="hipaa",e.FHE="fhe",e}({}),n=function(e){return e.SENTIMENT="sentiment",e.CATEGORIZE="categorize",e.SUMMARIZE="summarize",e.TOKENIZE="tokenize",e.FILTER="filter",e.CUSTOM="custom",e.WORD_COUNT="word_count",e.CHARACTER_COUNT="character_count",e.KEYWORD_DENSITY="keyword_density",e.READING_LEVEL="reading_level",e.ANALYZE="ANALYZE",e}({})},3480:(e,t,i)=>{e.exports=i(5600)},3719:(e,t,i)=>{i.d(t,{BO:()=>$});var r={};i.r(r),i.d(r,{createClientKey:()=>g,createPublicKey:()=>m,createServerKey:()=>f,decrypt:()=>E,default:()=>I,encrypt:()=>w,homomorphicAdd:()=>v,homomorphicCompare:()=>z,homomorphicMultiply:()=>S});var n=i(8951),o=i(901);let a=(0,n.tZ)();class s extends Error{constructor(e,t,i="OPERATION_ERROR"){super(e),this.name="FHEOperationError",this.operation=t,this.code=i}}let l={positive:["good","great","excellent","wonderful","amazing","happy","joy","loved","best","better"],negative:["bad","terrible","awful","horrible","sad","angry","hate","worst","poor","disappointing"],neutral:["maybe","possibly","perhaps","okay","fine","average","neutral","unclear"]};class c{constructor(){this.initialized=!1,a.info("Homomorphic Operations initialized in server environment")}static getInstance(){return c.instance||(c.instance=new c),c.instance}async initialize(){if(!this.initialized)try{this.initialized=!0,a.info("Homomorphic operations initialized successfully")}catch(e){throw a.error("Failed to initialize homomorphic operations",e),new s(`Homomorphic operations initialization error: ${e.message}`,"initialize","INITIALIZATION_ERROR")}}async processEncrypted(e,t,i,r){this.initialized||await this.initialize();try{let n,l;a.info(`Processing encrypted data with operation: ${t}`);let c={operationType:t,timestamp:Date.now()};try{if(e.startsWith("eyJ")){let r=atob(e),n=JSON.parse(r);l=n.data&&"string"==typeof n.data?"none"===i||"standard"===i?n.data:`Encrypted content (${t} operation applied)`:"Unknown encoded format"}else l=e}catch{l=e}switch(t){case o.JZ.SENTIMENT:n=await this.analyzeSentiment(l),c.confidence=.85;break;case o.JZ.CATEGORIZE:n=await this.categorizeText(l,r?.categories),c.categories=r?.categories||{};break;case o.JZ.SUMMARIZE:n=await this.summarizeText(l,r?.maxLength),c.originalLength=l.length,c.summaryLength=n.length;break;case o.JZ.TOKENIZE:{let e=await this.tokenizeText(l);n=JSON.stringify(e),c.tokenCount=e.length;break}case o.JZ.FILTER:n=await this.filterText(l,r?.filterTerms),c.filterTerms=r?.filterTerms||[],c.replacementsCoun=(l.length-n.length)/10;break;case o.JZ.CUSTOM:if(!r?.customOperation)throw new s("Custom operation requires a customOperation parameter",o.JZ.CUSTOM,"MISSING_PARAMETER");n=await this.performCustomOperation(l,r.customOperation,r),c.customOperation=r.customOperation;break;case o.JZ.WORD_COUNT:n=l.split(/\W+/).filter(e=>e.length>0).length.toString();break;case o.JZ.CHARACTER_COUNT:n=l.length.toString();break;case o.JZ.KEYWORD_DENSITY:{if(!r?.keyword)throw new s("keywordDensity operation requires a keyword parameter",o.JZ.KEYWORD_DENSITY,"MISSING_PARAMETER");let e=r.keyword,t=l.toLowerCase().split(/\W+/).filter(e=>e.length>0);n=(t.filter(t=>t===e.toLowerCase()).length/t.length).toFixed(4);break}case o.JZ.READING_LEVEL:{let e=l.split(/[.!?]+/).filter(e=>e.trim().length>0).length,t=l.split(/\W+/).filter(e=>e.length>0).length,i=this.estimateSyllables(l);if(0===t||0===e)n="Unknown";else{let r=t/e*.39+i/t*11.8-15.59;n=r<1?"Kindergarten":r<6?"Elementary":r<9?"Middle School":r<12?"High School":r<16?"College":"Post-graduate"}break}default:throw new s(`Unsupported operation: ${t}`,t,"UNSUPPORTED_OPERATION")}return{success:!0,result:String(n),metadata:{...c},timestamp:Date.now(),operationType:t}}catch(e){return a.error(`Failed to process encrypted data with operation ${t}`,e),{success:!1,error:"Operation failed",metadata:{operationType:t,errorCode:"PROCESS_ERROR",timestamp:Date.now()},timestamp:Date.now(),operationType:t}}}async analyzeSentiment(e){let t=e.toLowerCase(),i=0,r=0,n=0;for(let e of t.split(/\W+/).filter(e=>e.length>0))l.positive.includes(e)?i++:l.negative.includes(e)?r++:l.neutral.includes(e)&&n++;return i>r&&i>n?"positive":r>i&&r>n?"negative":"neutral"}async categorizeText(e,t){if(!t||0===Object.keys(t).length)return"unknown";let i=e.toLowerCase(),r={};for(let e of Object.keys(t))r[e]=0;for(let[e,n]of Object.entries(t))for(let t of n)i.includes(t.toLowerCase())&&r[e]++;let n=0,o="unknown";for(let[e,t]of Object.entries(r))t>n&&(n=t,o=e);return o}async summarizeText(e,t){let i=e.split(/[.!?]+/).filter(e=>e.trim().length>0);if(i.length<=2)return e;let r=[i[0]];i.length>4&&r.push(i[Math.floor(i.length/2)]),i.length>1&&r.push(i[i.length-1]);let n=r.join(". ").trim();return t&&n.length>t&&(n=`${n.substring(0,t-3)}...`),n}async tokenizeText(e){return e.split(/\W+/).filter(e=>e.length>0)}async filterText(e,t){if(!t||0===t.length)return e;let i=e;for(let e of t){let t=RegExp(e,"gi");i=i.replace(t,"[FILTERED]")}return i}async performCustomOperation(e,t,i){switch(t){case"wordCount":return e.split(/\W+/).filter(e=>e.length>0).length.toString();case"characterCount":return e.length.toString();case"keywordDensity":{if(!i?.keyword)throw new s("keywordDensity operation requires a keyword parameter","keywordDensity","MISSING_PARAMETER");let t=i.keyword,r=e.toLowerCase().split(/\W+/).filter(e=>e.length>0);return(r.filter(e=>e===t.toLowerCase()).length/r.length).toFixed(4)}case"readingLevel":{let t=e.split(/[.!?]+/).filter(e=>e.trim().length>0).length,i=e.split(/\W+/).filter(e=>e.length>0).length,r=this.estimateSyllables(e);if(0===i||0===t)return"Unknown";let n=i/t*.39+r/i*11.8-15.59;if(n<1)return"Kindergarten";if(n<6)return"Elementary";if(n<9)return"Middle School";if(n<12)return"High School";if(n<16)return"College";return"Post-graduate"}default:throw new s(`Unsupported custom operation: ${t}`,t,"UNSUPPORTED_CUSTOM_OPERATION")}}estimateSyllables(e){let t=e.toLowerCase().split(/\W+/).filter(e=>e.length>0),i=0;for(let e of t){let t=0;e.length<=3?t=1:(t=e.replace(/[^aeiouy]+/g,".").split(".").filter(e=>""!==e).length,e.endsWith("e")&&!e.endsWith("le")&&t--,0===t&&(t=1)),i+=t}return i}}let h=c.getInstance(),y=(0,n.tZ)(),d={rotationPeriodDays:30,persistKeys:!0,storagePrefix:"fhe_key_"};class p{constructor(e){this.activeKeyId=null,this.keyRotationTimers=new Map,this.isClient=!1,this.isServer=!1,this.options={...d,...e},this.isClient=!1,this.isServer=!0,y.info(`Key Rotation Service initialized in ${this.isServer?"server":"client"} environment`)}static getInstance(e){return p.instance||(p.instance=new p(e)),p.instance}async initialize(){try{await this.loadKeys(),this.activeKeyId||await this.rotateKeys(),y.info("Key rotation service initialized successfully")}catch(e){throw y.error("Failed to initialize key rotation service",e),Error(`Key rotation initialization error: ${e.message}`)}}registerKey(e,t){if(this.keyRotationTimers.has(e))return;let i=Math.max(0,t-Date.now());if(this.isServer){let t=setTimeout(()=>{this.rotateKeys().catch(t=>{y.error(`Failed to rotate key ${e}`,t)})},i);this.keyRotationTimers.set(e,t),y.info(`Scheduled key ${e} for rotation in ${Math.round(i/864e5)} days`)}else this.isClient&&this.scheduleClientRotationCheck(e,t)}scheduleClientRotationCheck(e,t){let i=setInterval(()=>{Date.now()>=t&&(this.rotateKeys().catch(t=>{y.error(`Failed to rotate key ${e}`,t)}),clearInterval(i),this.keyRotationTimers.delete(e))},864e5);this.keyRotationTimers.set(e,i)}async rotateKeys(){try{y.info("Rotating encryption keys");let e=this.generateKeyId(),t=Date.now(),i=864e5*this.options.rotationPeriodDays,r=t+i,n={id:e,publicKey:`pk_${e}`,privateKeyEncrypted:`encrypted_sk_${e}`,created:t,expires:r,version:"1.0"};return await this.storeKey(n),this.activeKeyId=e,this.registerKey(e,r),y.info(`Key rotation completed successfully. New key ID: ${e}`),e}catch(e){throw y.error("Failed to rotate keys",e),Error(`Key rotation error: ${e.message}`)}}async storeKey(e){if(this.options.persistKeys)try{let t=`${this.options.storagePrefix}${e.id}`;this.isClient?localStorage.setItem(t,JSON.stringify(e)):y.info(`Server would store key ${e.id} in secure storage`)}catch(t){throw y.error(`Failed to store key ${e.id}`,t),Error(`Key storage error: ${t.message}`)}}async loadKeys(){if(this.options.persistKeys)try{if(this.isClient)for(let e=0;e<localStorage.length;e++){let t=localStorage.key(e);if(t?.startsWith(this.options.storagePrefix))try{let e=JSON.parse(localStorage.getItem(t));e.expires>Date.now()?((!this.activeKeyId||e.created>JSON.parse(localStorage.getItem(`${this.options.storagePrefix}${this.activeKeyId}`)).created)&&(this.activeKeyId=e.id),this.registerKey(e.id,e.expires)):localStorage.removeItem(t)}catch(e){y.warn(`Failed to parse key ${t}`,e)}}else y.info("Server would load keys from secure storage");this.activeKeyId?y.info(`Loaded active key: ${this.activeKeyId}`):y.info("No active keys found, will generate new key")}catch(e){throw y.error("Failed to load keys",e),Error(`Key loading error: ${e.message}`)}}getActiveKeyId(){return this.activeKeyId}generateKeyId(){let e=Date.now().toString(36),t=Math.random().toString(36).substring(2,10);return`${e}-${t}`}dispose(){this.keyRotationTimers.forEach(e=>{clearTimeout(e),clearInterval(e)}),this.keyRotationTimers.clear(),y.info("Key rotation service disposed")}}let u=p.getInstance();function g(e){return{mock:!0,type:"clientKey",id:k(),created:Date.now(),params:e}}function f(e){return{mock:!0,type:"serverKey",clientKeyId:e?.id||"unknown",id:k(),created:Date.now()}}function m(e){return{mock:!0,type:"publicKey",clientKeyId:e?.id||"unknown",id:k(),created:Date.now()}}function w(e,t){let i=t?.id||"unknown";return`mock-encrypted:${i}:${btoa(e)}`}function E(e,t){if("string"==typeof e&&e.startsWith("mock-encrypted:")){let[,i,r]=e.split(":");if(t?.id&&i!==t.id)throw Error("Invalid key for decryption");return atob(r)}return String(e)}function k(){return Math.random().toString(36).substring(2,15)}function v(e,t){if("string"!=typeof e||"string"!=typeof t)throw TypeError("Invalid encrypted values: expected string");let i=e.replace("mock-encrypted:",""),r=t.replace("mock-encrypted:","");return`mock-encrypted:${i}+${r}`}function S(e,t){if("string"!=typeof e||"string"!=typeof t)throw TypeError("Invalid encrypted values: expected string");let i=e.replace("mock-encrypted:",""),r=t.replace("mock-encrypted:","");return`mock-encrypted:${i}*${r}`}function z(e,t){if("string"!=typeof e||"string"!=typeof t)throw TypeError("Invalid encrypted values: expected string");let i=e.replace("mock-encrypted:",""),r=t.replace("mock-encrypted:","");return`mock-encrypted:${i}==${r}`}let I={createClientKey:g,createServerKey:f,createPublicKey:m,encrypt:w,decrypt:E,homomorphicAdd:v,homomorphicMultiply:S,homomorphicCompare:z},T=null,K=(0,n.tZ)(),O={rotationPeriodDays:30,storagePrefix:"tfhe_key_"},R={mode:o.vS.FHE,keySize:2048,securityLevel:"hipaa",enableDebug:!1,keyRotationPeriod:864e5,enableClientSideProcessing:!0,enableServerSideProcessing:!0};class b{constructor(){this.initialized=!1,this.tfheContext=null,this.tokenizer=null,this.encryptionMode=o.vS.NONE,this.keyId=null,this.isServer=!1,this.isClient=!1,this.keyRotationInitialized=!1,this.homomorphicOpsInitialized=!1,this.config={...R},this.currentKey=this.generateKey(),this.keyCreatedAt=Date.now(),this.isServer=!0,this.isClient=!1,K.info(`FHE Service initialized in ${this.isServer?"server":"client"} environment`)}static getInstance(){return b.instance||(b.instance=new b),b.instance}async initialize(e={}){if(this.initialized){K.warn("FHE service already initialized");return}let{mode:t=o.vS.FHE,keySize:i=1024,securityLevel:r="medium",enableDebug:n=!1}=e;this.config={mode:t,keySize:i,securityLevel:this.mapSecurityLevel(r),enableDebug:n,keyRotationPeriod:R.keyRotationPeriod,enableClientSideProcessing:R.enableClientSideProcessing,enableServerSideProcessing:R.enableServerSideProcessing};try{if(K.info(`Initializing FHE service in ${this.config.mode} mode`),this.encryptionMode=t,t===o.vS.NONE){K.warn("FHE service initialized with encryption disabled"),this.initialized=!0;return}await this.ensureTFHELoaded(),this.keyRotationInitialized||await this.initializeKeyRotation(),this.homomorphicOpsInitialized||await this.initializeHomomorphicOps(),t===o.vS.FHE&&(await this.initializeTFHE(this.config),await this.initializeTextProcessor()),this.initialized=!0,K.info("FHE service successfully initialized")}catch(e){throw K.error("Failed to initialize FHE service",e),Error(`FHE initialization error: ${e.message}`)}}async ensureTFHELoaded(){if(!T)try{if(this.isClient)try{T=r,K.info("Using TFHE mock implementation for build")}catch(e){K.warn("Failed to load TFHE WASM, using mock implementation",e),T=this.createServerMock()}else{K.warn("FHE operations in server environment might be limited");try{T=r,K.info("Using TFHE mock implementation for build")}catch(e){T=this.createServerMock()}}}catch(e){throw K.error("Failed to load TFHE library",e),Error(`TFHE loading error: ${e.message}`)}}createServerMock(){return{createClientKey:()=>({mock:!0}),createServerKey:()=>({mock:!0}),createPublicKey:()=>({mock:!0}),encrypt:e=>`mock:${e}`,decrypt:e=>e.replace("mock:","")}}async initializeTFHE(e){if(!T)throw Error("TFHE library not loaded");try{let t=this.getSecurityParams(e.securityLevel);if(this.isClient){let i=await T.createClientKey(t),r=T.createServerKey(i),n=T.createPublicKey(i);this.tfheContext={clientKey:i,serverKey:r,publicKey:n,initialized:!0,config:e,keySize:e.keySize,securityLevel:e.securityLevel}}else K.info("Server-side FHE initialization with limited functionality"),this.tfheContext={initialized:!0,config:e,keySize:e.keySize,securityLevel:e.securityLevel,clientKey:null,publicKey:null};K.info("TFHE initialized successfully")}catch(e){throw K.error("Failed to initialize TFHE",e),Error(`TFHE initialization error: ${e.message}`)}}mapSecurityLevel(e){switch(e.toLowerCase()){case"low":return 128;case"medium":default:return 192;case"high":return 256}}getSecurityParams(e){return{securityLevel:"string"==typeof e?this.mapSecurityLevel(e):e}}async initializeTextProcessor(){if(this.isClient)try{this.tokenizer={tokenize:e=>e.split(/\s+/)},K.info("Text processor initialized")}catch(e){K.warn("Failed to initialize text processor",e)}}async encrypt(e){if(this.initialized||await this.initialize(),this.encryptionMode===o.vS.NONE)return e;try{if(T||await this.ensureTFHELoaded(),this.config.enableDebug)return`mock:${e}`;return`${this.keyId||"key0"}:${e}`}catch(e){throw K.error("Encryption error",e),Error(`FHE encryption error: ${e.message}`)}}async decrypt(e){if(this.initialized||await this.initialize(),this.encryptionMode===o.vS.NONE)return e;try{if(T||await this.ensureTFHELoaded(),e.startsWith("mock:"))return e.replace("mock:","");let[t,...i]=e.split(":");return i.join(":")}catch(e){throw K.error("Decryption error",e),Error(`FHE decryption error: ${e.message}`)}}async initializeKeyRotation(){try{(0,n.tZ)().info("Initializing key rotation service");let e={rotationPeriodDays:O.rotationPeriodDays,storagePrefix:O.storagePrefix};K.info(`Initializing key rotation with period: ${e.rotationPeriodDays} days`),await u.initialize(),this.keyId=await u.getActiveKeyId(),this.keyRotationInitialized=!0,(0,n.tZ)().info("Key rotation service initialized successfully")}catch(e){throw(0,n.tZ)().error(`Failed to initialize key rotation: ${e.message}`),Error(`Key rotation initialization failed: ${e.message}`)}}async initializeHomomorphicOps(){try{(0,n.tZ)().info("Initializing homomorphic operations service"),await h.initialize(),this.homomorphicOpsInitialized=!0,(0,n.tZ)().info("Homomorphic operations service initialized successfully")}catch(e){throw(0,n.tZ)().error(`Failed to initialize homomorphic operations: ${e.message}`),Error(`Homomorphic operations initialization failed: ${e.message}`)}}checkInitialized(){if(!this.initialized)throw Error("FHE service not initialized")}async processEncrypted(e,t,i){if(this.checkInitialized(),!this.homomorphicOpsInitialized)throw Error("Homomorphic operations not initialized");try{(0,n.tZ)().info(`Processing encrypted data with operation: ${t}`);let r=await h.processEncrypted(e,t,this.encryptionMode,i);return{...r,data:r.result||{},metadata:{operation:t,timestamp:Date.now(),...r.operationType?{operationType:r.operationType}:{}}}}catch(e){return(0,n.tZ)().error(`Failed to process encrypted data: ${e.message}`),{success:!1,error:e.message,data:{},metadata:{operation:t,timestamp:Date.now()},timestamp:Date.now(),operationType:t}}}async rotateKeys(){if(this.checkInitialized(),!this.keyRotationInitialized)throw Error("Key rotation service not initialized");try{let e=await u.rotateKeys();return this.keyId=e,(0,n.tZ)().info(`Keys rotated successfully, new key ID: ${e}`),e}catch(e){throw(0,n.tZ)().error(`Failed to rotate keys: ${e.message}`),Error(`Key rotation failed: ${e.message}`)}}getEncryptionMode(){return this.encryptionMode}setEncryptionMode(e){this.encryptionMode=e,(0,n.tZ)().info(`Encryption mode set to ${e}`)}isInitialized(){return this.initialized}checkKeyRotation(){let e=Date.now();e-this.keyCreatedAt>this.config.keyRotationPeriod&&(this.currentKey=this.generateKey(),this.keyCreatedAt=e)}generateKey(){return`fhe-key-${Math.random().toString(36).substring(2,15)}-${Date.now()}`}async generateHash(e){try{let t="";{let i=new TextEncoder().encode(e);try{let r=(globalThis.crypto||{}).subtle;if(r){let e=await r.digest("SHA-256",i);t=Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}else t=this.simpleHash(e)}catch(i){t=this.simpleHash(e)}}return t.substring(0,10)}catch(e){return K.error("Error generating hash",e),crypto.randomUUID().substring(0,10)}}simpleHash(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return(t>>>0).toString(16).padStart(8,"0")}}let $=b.getInstance()},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return i}});var i=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,t,i)=>{let r;i.d(t,{tZ:()=>s});var n=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let o=()=>process.env.LOG_LEVEL||"info";class a{constructor(e="info",t){this.debug=(e,t)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,t))},this.info=(e,t)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,t))},this.warn=(e,t)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,t))},this.error=(e,t)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,t))},this.logLevel=e,this.isDevelopment=!1,this.prefix=t}createLogEntry(e,t,i){return{message:this.prefix?`[${this.prefix}] ${t}`:t,level:e,timestamp:Date.now(),metadata:i}}formatLogEntry({message:e,level:t,timestamp:i,metadata:r}){let n=new Date(i).toISOString(),o=r?` ${JSON.stringify(r)}`:"";return`[${n}] [${t.toUpperCase()}] ${e}${o}`}writeLog(e){let t=this.formatLogEntry(e);switch(e.level){case"error":console.error(t);break;case"warn":case"info":case"debug":console.warn(t)}}shouldLog(e){let t=Object.values(n),i=t.indexOf(this.logLevel);return t.indexOf(e)>=i}}function s(e){return(r||(r=new a(o())),e?.prefix)?new a(o(),e.prefix):r}s()}};