"use strict";(()=>{var e={};e.id=209,e.ids=[209],e.modules={325:(e,t,r)=>{r.a(e,async(e,n)=>{try{let a;r.d(t,{Ay:()=>E,_K:()=>u});var o=r(2971),s=e([o]);let l=(o=(s.then?(await s)():s)[0]).z.object({NODE_ENV:o.z.enum(["development","production","test"]).default("development"),VERCEL:o.z.string().optional(),VERCEL_ENV:o.z.enum(["development","preview","production"]).optional(),VERCEL_URL:o.z.string().optional(),VERCEL_TOKEN:o.z.string().optional(),VERCEL_ORG_ID:o.z.string().optional(),VERCEL_PROJECT_ID:o.z.string().optional(),PORT:o.z.string().transform(Number).default("3000"),LOG_LEVEL:o.z.enum(["error","warn","info","verbose","debug"]).default("info"),ENABLE_RATE_LIMITING:o.z.string().transform(e=>"true"===e).default("true"),POSTGRES_URL:o.z.string().optional(),POSTGRES_PRISMA_URL:o.z.string().optional(),POSTGRES_URL_NON_POOLING:o.z.string().optional(),SUPABASE_URL:o.z.string().url().optional(),SUPABASE_KEY:o.z.string().optional(),SUPABASE_ANON_KEY:o.z.string().optional(),SUPABASE_SERVICE_ROLE_KEY:o.z.string().optional(),SUPABASE_JWT_SECRET:o.z.string().optional(),OPENAI_API_KEY:o.z.string().optional(),OPENAI_BASE_URL:o.z.string().url().optional(),TOGETHER_API_KEY:o.z.string().optional(),GOOGLE_API_KEY:o.z.string().optional(),REPLICATE_API_TOKEN:o.z.string().optional(),SENTRY_DSN:o.z.string().url().optional(),AXIOM_DATASET:o.z.string().optional(),AXIOM_TOKEN:o.z.string().optional(),VITE_LITLYX_PROJECT_ID:o.z.string().optional(),VITE_LITLYX_API_KEY:o.z.string().optional(),EMAIL_FROM:o.z.string().email().optional(),RESEND_API_KEY:o.z.string().optional(),SECURITY_ENABLE_BRUTE_FORCE_PROTECTION:o.z.string().transform(e=>"true"===e).default("true"),SECURITY_MAX_LOGIN_ATTEMPTS:o.z.string().transform(Number).default("5"),SECURITY_ACCOUNT_LOCKOUT_DURATION:o.z.string().transform(Number).default("1800"),SECURITY_API_ABUSE_THRESHOLD:o.z.string().transform(Number).default("100"),SECURITY_ENABLE_ALERTS:o.z.string().transform(e=>"true"===e).default("true"),RATE_LIMIT_MAX_REQUESTS:o.z.string().transform(Number).default("100"),RATE_LIMIT_WINDOW_MS:o.z.string().transform(Number).default("900000"),LOG_CONSOLE:o.z.string().transform(e=>"true"===e).default("true"),LOG_AUDIT:o.z.string().transform(e=>"true"===e).default("true"),VITE_API_URL:o.z.string().url().optional(),VITE_SUPABASE_URL:o.z.string().url().optional(),VITE_SUPABASE_ANON_KEY:o.z.string().optional()});function i(){return a||(a=l.parse(process.env)),a}let u=i(),E={isDevelopment:()=>"development"===i().NODE_ENV,isProduction:()=>"production"===i().NODE_ENV,isTest:()=>"test"===i().NODE_ENV,server:{port:()=>i().PORT,logLevel:()=>i().LOG_LEVEL,enableRateLimiting:()=>i().ENABLE_RATE_LIMITING},database:{url:()=>i().POSTGRES_URL,prismaUrl:()=>i().POSTGRES_PRISMA_URL,nonPoolingUrl:()=>i().POSTGRES_URL_NON_POOLING},supabase:{url:()=>i().SUPABASE_URL,key:()=>i().SUPABASE_KEY,anonKey:()=>i().SUPABASE_ANON_KEY,serviceRoleKey:()=>i().SUPABASE_SERVICE_ROLE_KEY,jwtSecret:()=>i().SUPABASE_JWT_SECRET},ai:{openAiKey:()=>i().OPENAI_API_KEY,openAiBaseUrl:()=>i().OPENAI_BASE_URL,togetherApiKey:()=>i().TOGETHER_API_KEY,googleApiKey:()=>i().GOOGLE_API_KEY,replicateToken:()=>i().REPLICATE_API_TOKEN},monitoring:{sentryDsn:()=>i().SENTRY_DSN,axiomDataset:()=>i().AXIOM_DATASET,axiomToken:()=>i().AXIOM_TOKEN,litlyxProjectId:()=>i().VITE_LITLYX_PROJECT_ID,litlyxApiKey:()=>i().VITE_LITLYX_API_KEY},email:{from:()=>i().EMAIL_FROM,resendApiKey:()=>i().RESEND_API_KEY},deployment:{vercelEnv:()=>i().VERCEL_ENV,isVercel:()=>i().VERCEL,vercelUrl:()=>i().VERCEL_URL,vercelToken:()=>i().VERCEL_TOKEN,vercelOrgId:()=>i().VERCEL_ORG_ID,vercelProjectId:()=>i().VERCEL_PROJECT_ID},security:{enableBruteForceProtection:()=>i().SECURITY_ENABLE_BRUTE_FORCE_PROTECTION,maxLoginAttempts:()=>i().SECURITY_MAX_LOGIN_ATTEMPTS,accountLockoutDuration:()=>i().SECURITY_ACCOUNT_LOCKOUT_DURATION,apiAbuseThreshold:()=>i().SECURITY_API_ABUSE_THRESHOLD,enableAlerts:()=>i().SECURITY_ENABLE_ALERTS},rateLimiting:{maxRequests:()=>i().RATE_LIMIT_MAX_REQUESTS,windowMs:()=>i().RATE_LIMIT_WINDOW_MS},logging:{console:()=>i().LOG_CONSOLE,audit:()=>i().LOG_AUDIT},client:{apiUrl:()=>i().VITE_API_URL,supabaseUrl:()=>i().VITE_SUPABASE_URL,supabaseAnonKey:()=>i().VITE_SUPABASE_ANON_KEY}};n()}catch(e){n(e)}})},836:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{GET:()=>l});var o=r(7582),s=r(8951),i=e([o]);o=(i.then?(await i)():i)[0];let a=(0,s.tZ)(),l=async({cookies:e})=>{try{if(!await (0,o.wR)(e))return new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});let t={stats:{sessionsThisWeek:3,totalPracticeHours:12.5,progressScore:85},recentSessions:[{id:"session-1",type:"chat",timestamp:new Date,title:"Mental Health Chat"},{id:"session-2",type:"simulator",timestamp:new Date(Date.now()-864e5),title:"Practice Session: Anxiety Management"}],securityLevel:"hipaa"};return new Response(JSON.stringify(t),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return a.error("Dashboard API error:",{error:e instanceof Error?e.message:String(e)}),new Response(JSON.stringify({error:"Internal server error"}),{status:500,headers:{"Content-Type":"application/json"}})}};n()}catch(e){n(e)}})},2971:e=>{e.exports=import("zod")},3072:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>E,default:()=>u,routeModule:()=>_});var o=r(3480),s=r(8667),i=r(6435),a=r(836),l=e([a]);a=(l.then?(await l)():l)[0];let u=(0,i.M)(a,"default"),E=(0,i.M)(a,"config"),_=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/dashboard",pathname:"/api/dashboard",bundlePath:"",filename:""},userland:a});n()}catch(e){n(e)}})},3277:(e,t,r)=>{r.d(t,{fl:()=>n});let n={sessionDuration:604800,cookies:{accessToken:"sb-access-token",refreshToken:"sb-refresh-token",path:"/",secure:!0,httpOnly:!0,sameSite:"lax"},redirects:{afterLogin:"/dashboard",afterLogout:"/",authRequired:"/login",forbidden:"/access-denied"},roles:{default:"user",hierarchy:["admin","staff","therapist","user","guest"]},rateLimit:{maxLoginAttempts:5,lockoutDuration:900}}},3480:(e,t,r)=>{e.exports=r(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5754:(e,t,r)=>{let n;r.d(t,{iL:()=>a});var o=r(3939);let s=(void 0).PUBLIC_SUPABASE_URL,i=(void 0).PUBLIC_SUPABASE_ANON_KEY;async function a(e,t,r,o={},s){try{let i=new Date,a=null,l=null;if(s&&(a=s.headers.get("x-forwarded-for")||s.headers.get("x-real-ip"),l=s.headers.get("user-agent")),"string"==typeof e){let{error:s}=await n.from("audit_logs").insert({user_id:e,action:t,resource_id:r,resource_type:"unknown",metadata:o,timestamp:i.toISOString(),ip_address:a,user_agent:l});if(s){let n=`Error creating audit log: ${s.message}`;console.error(n,{userId:e,action:t,resource:r})}}else{let{error:t}=await n.from("audit_logs").insert({id:e.id,user_id:e.userId,action:e.action,resource_id:e.resource.id,resource_type:e.resource.type,metadata:e.metadata,timestamp:e.timestamp.toISOString()});if(t){let r=`Error creating audit log: ${t.message}`;console.error(r,{entry:e})}}}catch(e){console.error(`Exception in audit logging: ${e instanceof Error?e.message:String(e)}`)}}s&&i||console.error("CRITICAL: Missing Supabase credentials for audit logging in production"),s&&i?n=(0,o.createClient)(s,i):(console.warn("CRITICAL: Using mock Supabase client for audit logging in production. This should never happen."),n={from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})})},5934:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{ND:()=>S});var o=r(3939),s=r(325),i=e([s]);s=(i.then?(await i)():i)[0];let l="undefined"!=typeof process?process.env:{},u=l.NODE_ENV||"development",E="https://example.supabase.co",_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example",c="production"===u,d=s._K?.SUPABASE_URL||l.PUBLIC_SUPABASE_URL||(c?void 0:E),A=s._K?.SUPABASE_ANON_KEY||l.PUBLIC_SUPABASE_ANON_KEY||(c?void 0:_),p=s._K?.SUPABASE_SERVICE_ROLE_KEY;function a(){return console.warn(c?"CRITICAL: Using mock Supabase client in production. This should never happen.":"Using mock Supabase client for development. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:null}),signOut:()=>Promise.resolve({error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})}}!c||d&&A||console.error("CRITICAL: Missing Supabase credentials in production environment");let g=d&&d!==E&&A&&A!==_,S=g?(0,o.createClient)(d,A,{auth:{persistSession:!0,autoRefreshToken:!0}}):a();g&&p?(0,o.createClient)(d,p,{auth:{persistSession:!1,autoRefreshToken:!1}}):a(),n()}catch(e){n(e)}})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7582:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{HW:()=>a,wR:()=>l});var o=r(3277);r(5754);var s=r(5934),i=e([s]);async function a(e){let t=e.get(o.fl.cookies.accessToken)?.value,r=e.get(o.fl.cookies.refreshToken)?.value;if(!t||!r)return null;try{let{data:e,error:n}=await s.ND.auth.setSession({access_token:t,refresh_token:r});if(n||!e?.user)return console.error("Session error:",n),null;let{data:i}=await s.ND.from("profiles").select("*").eq("id",e.user.id).single();return{id:e.user.id,email:e.user.email||"",role:i?.role||o.fl.roles.default,fullName:i?.full_name||e.user.user_metadata?.full_name,avatarUrl:i?.avatar_url||e.user.user_metadata?.avatar_url,lastLogin:i?.last_login?new Date(i.last_login):null,metadata:{...e.user.user_metadata,...i?.metadata}}}catch(e){return console.error("Error getting current user:",e),null}}async function l(e){return!!await a(e)}s=(i.then?(await i)():i)[0];class u{async verifySession(e){let t=this.getCookiesFromRequest(e),r=await a(t);return r?{userId:r.id}:null}getCookiesFromRequest(e){let t=e.headers.get("cookie")||"";return{get:e=>{let r=t.match(RegExp(`${e}=([^;]+)`));return r?{value:r[1]}:void 0}}}}new u,n()}catch(e){n(e)}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,t,r)=>{let n;r.d(t,{tZ:()=>a});var o=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let s=()=>process.env.LOG_LEVEL||"info";class i{constructor(e="info",t){this.debug=(e,t)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,t))},this.info=(e,t)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,t))},this.warn=(e,t)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,t))},this.error=(e,t)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,t))},this.logLevel=e,this.isDevelopment=!1,this.prefix=t}createLogEntry(e,t,r){return{message:this.prefix?`[${this.prefix}] ${t}`:t,level:e,timestamp:Date.now(),metadata:r}}formatLogEntry({message:e,level:t,timestamp:r,metadata:n}){let o=new Date(r).toISOString(),s=n?` ${JSON.stringify(n)}`:"";return`[${o}] [${t.toUpperCase()}] ${e}${s}`}writeLog(e){let t=this.formatLogEntry(e);switch(e.level){case"error":console.error(t);break;case"warn":case"info":case"debug":console.warn(t)}}shouldLog(e){let t=Object.values(o),r=t.indexOf(this.logLevel);return t.indexOf(e)>=r}}function a(e){return(n||(n=new i(s())),e?.prefix)?new i(s(),e.prefix):n}a()}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=3072);module.exports=r})();