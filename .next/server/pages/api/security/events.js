"use strict";(()=>{var e={};e.id=199,e.ids=[199],e.modules={749:(e,t,r)=>{r.r(t),r.d(t,{config:()=>l,default:()=>d,routeModule:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c});var i=r(3480),o=r(8667),s=r(6435),a=r(8951);(function(){var e=Error("Cannot find module '../../../lib/auth.js'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '../../../lib/security/monitoring.js'");throw e.code="MODULE_NOT_FOUND",e}(),function(){var e=Error("Cannot find module '../../../lib/supabase.js'");throw e.code="MODULE_NOT_FOUND",e}();let u=(0,a.tZ)();async function c({request:e,cookies:t}){try{let r;let n=await Object(function(){var e=Error("Cannot find module '../../../lib/auth.js'");throw e.code="MODULE_NOT_FOUND",e}())(t);if(!n||"admin"!==n.role)return new Response(JSON.stringify({error:"Unauthorized access"}),{status:403,headers:{"Content-Type":"application/json"}});let i=new URL(e.url),o=i.searchParams.get("type"),s=i.searchParams.get("severity"),a=i.searchParams.get("timeRange"),c=Number.parseInt(i.searchParams.get("limit")||"100",10),d=Number.parseInt(i.searchParams.get("page")||"1",10),l=Object(function(){var e=Error("Cannot find module '../../../lib/supabase.js'");throw e.code="MODULE_NOT_FOUND",e}()).from("security_events").select("*");if(o&&"all"!==o&&Object.values(Object(function(){var e=Error("Cannot find module '../../../lib/security/monitoring.js'");throw e.code="MODULE_NOT_FOUND",e}())).includes(o)&&(l=l.eq("type",o)),s&&"all"!==s&&Object.values(Object(function(){var e=Error("Cannot find module '../../../lib/security/monitoring.js'");throw e.code="MODULE_NOT_FOUND",e}())).includes(s)&&(l=l.eq("severity",s)),a&&"all"!==a){r=new Date;let e=new Date;switch(a){case"day":r.setDate(e.getDate()-1);break;case"week":r.setDate(e.getDate()-7);break;case"month":r.setMonth(e.getMonth()-1)}l=l.gte("created_at",r.toISOString())}l=l.order("created_at",{ascending:!1}).range((d-1)*c,d*c-1);let{data:f,error:h}=await l;if(h)throw Error(h.message);let g=(f||[]).map(e=>({type:e.type,userId:e.user_id,ip:e.ip_address,userAgent:e.user_agent,metadata:e.metadata,severity:e.severity,timestamp:e.created_at}));return u.info("Security events fetched",{userId:n.id,filters:{type:o,severity:s,timeRange:a},resultCount:g.length}),new Response(JSON.stringify(g),{headers:{"Content-Type":"application/json"}})}catch(e){return u.error("Error fetching security events",{message:e instanceof Error?e.message:String(e)}),new Response(JSON.stringify({error:"Failed to fetch security events"}),{status:500,headers:{"Content-Type":"application/json"}})}}let d=(0,s.M)(n,"default"),l=(0,s.M)(n,"config"),f=new i.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/security/events",pathname:"/api/security/events",bundlePath:"",filename:""},userland:n})},3480:(e,t,r)=>{e.exports=r(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,t,r)=>{let n;r.d(t,{tZ:()=>a});var i=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let o=()=>process.env.LOG_LEVEL||"info";class s{constructor(e="info",t){this.debug=(e,t)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,t))},this.info=(e,t)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,t))},this.warn=(e,t)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,t))},this.error=(e,t)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,t))},this.logLevel=e,this.isDevelopment=!1,this.prefix=t}createLogEntry(e,t,r){return{message:this.prefix?`[${this.prefix}] ${t}`:t,level:e,timestamp:Date.now(),metadata:r}}formatLogEntry({message:e,level:t,timestamp:r,metadata:n}){let i=new Date(r).toISOString(),o=n?` ${JSON.stringify(n)}`:"";return`[${i}] [${t.toUpperCase()}] ${e}${o}`}writeLog(e){let t=this.formatLogEntry(e);switch(e.level){case"error":console.error(t);break;case"warn":case"info":case"debug":console.warn(t)}}shouldLog(e){let t=Object.values(i),r=t.indexOf(this.logLevel);return t.indexOf(e)>=r}}function a(e){return(n||(n=new s(o())),e?.prefix)?new s(o(),e.prefix):n}a()}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=749);module.exports=r})();