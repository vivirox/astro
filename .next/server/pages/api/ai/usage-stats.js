"use strict";(()=>{var e={};e.id=703,e.ids=[703],e.modules={325:(e,t,r)=>{r.a(e,async(e,s)=>{try{let i;r.d(t,{Ay:()=>d,_K:()=>u});var a=r(2971),o=e([a]);let l=(a=(o.then?(await o)():o)[0]).z.object({NODE_ENV:a.z.enum(["development","production","test"]).default("development"),VERCEL:a.z.string().optional(),VERCEL_ENV:a.z.enum(["development","preview","production"]).optional(),VERCEL_URL:a.z.string().optional(),VERCEL_TOKEN:a.z.string().optional(),VERCEL_ORG_ID:a.z.string().optional(),VERCEL_PROJECT_ID:a.z.string().optional(),PORT:a.z.string().transform(Number).default("3000"),LOG_LEVEL:a.z.enum(["error","warn","info","verbose","debug"]).default("info"),ENABLE_RATE_LIMITING:a.z.string().transform(e=>"true"===e).default("true"),POSTGRES_URL:a.z.string().optional(),POSTGRES_PRISMA_URL:a.z.string().optional(),POSTGRES_URL_NON_POOLING:a.z.string().optional(),SUPABASE_URL:a.z.string().url().optional(),SUPABASE_KEY:a.z.string().optional(),SUPABASE_ANON_KEY:a.z.string().optional(),SUPABASE_SERVICE_ROLE_KEY:a.z.string().optional(),SUPABASE_JWT_SECRET:a.z.string().optional(),OPENAI_API_KEY:a.z.string().optional(),OPENAI_BASE_URL:a.z.string().url().optional(),TOGETHER_API_KEY:a.z.string().optional(),GOOGLE_API_KEY:a.z.string().optional(),REPLICATE_API_TOKEN:a.z.string().optional(),SENTRY_DSN:a.z.string().url().optional(),AXIOM_DATASET:a.z.string().optional(),AXIOM_TOKEN:a.z.string().optional(),VITE_LITLYX_PROJECT_ID:a.z.string().optional(),VITE_LITLYX_API_KEY:a.z.string().optional(),EMAIL_FROM:a.z.string().email().optional(),RESEND_API_KEY:a.z.string().optional(),SECURITY_ENABLE_BRUTE_FORCE_PROTECTION:a.z.string().transform(e=>"true"===e).default("true"),SECURITY_MAX_LOGIN_ATTEMPTS:a.z.string().transform(Number).default("5"),SECURITY_ACCOUNT_LOCKOUT_DURATION:a.z.string().transform(Number).default("1800"),SECURITY_API_ABUSE_THRESHOLD:a.z.string().transform(Number).default("100"),SECURITY_ENABLE_ALERTS:a.z.string().transform(e=>"true"===e).default("true"),RATE_LIMIT_MAX_REQUESTS:a.z.string().transform(Number).default("100"),RATE_LIMIT_WINDOW_MS:a.z.string().transform(Number).default("900000"),LOG_CONSOLE:a.z.string().transform(e=>"true"===e).default("true"),LOG_AUDIT:a.z.string().transform(e=>"true"===e).default("true"),VITE_API_URL:a.z.string().url().optional(),VITE_SUPABASE_URL:a.z.string().url().optional(),VITE_SUPABASE_ANON_KEY:a.z.string().optional()});function n(){return i||(i=l.parse(process.env)),i}let u=n(),d={isDevelopment:()=>"development"===n().NODE_ENV,isProduction:()=>"production"===n().NODE_ENV,isTest:()=>"test"===n().NODE_ENV,server:{port:()=>n().PORT,logLevel:()=>n().LOG_LEVEL,enableRateLimiting:()=>n().ENABLE_RATE_LIMITING},database:{url:()=>n().POSTGRES_URL,prismaUrl:()=>n().POSTGRES_PRISMA_URL,nonPoolingUrl:()=>n().POSTGRES_URL_NON_POOLING},supabase:{url:()=>n().SUPABASE_URL,key:()=>n().SUPABASE_KEY,anonKey:()=>n().SUPABASE_ANON_KEY,serviceRoleKey:()=>n().SUPABASE_SERVICE_ROLE_KEY,jwtSecret:()=>n().SUPABASE_JWT_SECRET},ai:{openAiKey:()=>n().OPENAI_API_KEY,openAiBaseUrl:()=>n().OPENAI_BASE_URL,togetherApiKey:()=>n().TOGETHER_API_KEY,googleApiKey:()=>n().GOOGLE_API_KEY,replicateToken:()=>n().REPLICATE_API_TOKEN},monitoring:{sentryDsn:()=>n().SENTRY_DSN,axiomDataset:()=>n().AXIOM_DATASET,axiomToken:()=>n().AXIOM_TOKEN,litlyxProjectId:()=>n().VITE_LITLYX_PROJECT_ID,litlyxApiKey:()=>n().VITE_LITLYX_API_KEY},email:{from:()=>n().EMAIL_FROM,resendApiKey:()=>n().RESEND_API_KEY},deployment:{vercelEnv:()=>n().VERCEL_ENV,isVercel:()=>n().VERCEL,vercelUrl:()=>n().VERCEL_URL,vercelToken:()=>n().VERCEL_TOKEN,vercelOrgId:()=>n().VERCEL_ORG_ID,vercelProjectId:()=>n().VERCEL_PROJECT_ID},security:{enableBruteForceProtection:()=>n().SECURITY_ENABLE_BRUTE_FORCE_PROTECTION,maxLoginAttempts:()=>n().SECURITY_MAX_LOGIN_ATTEMPTS,accountLockoutDuration:()=>n().SECURITY_ACCOUNT_LOCKOUT_DURATION,apiAbuseThreshold:()=>n().SECURITY_API_ABUSE_THRESHOLD,enableAlerts:()=>n().SECURITY_ENABLE_ALERTS},rateLimiting:{maxRequests:()=>n().RATE_LIMIT_MAX_REQUESTS,windowMs:()=>n().RATE_LIMIT_WINDOW_MS},logging:{console:()=>n().LOG_CONSOLE,audit:()=>n().LOG_AUDIT},client:{apiUrl:()=>n().VITE_API_URL,supabaseUrl:()=>n().VITE_SUPABASE_URL,supabaseAnonKey:()=>n().VITE_SUPABASE_ANON_KEY}};s()}catch(e){s(e)}})},802:e=>{e.exports=import("clsx")},1623:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{b6:()=>l});var a=r(5754),o=r(5643),n=r(5275),i=e([n]);async function l(e){let{period:t="daily",userId:r,startDate:s=new Date(Date.now()-2592e6),endDate:i=new Date,limit:l=30}=e;try{await (0,a.iL)(r||"system","ai.analytics.request","analytics",{period:t,startDate:s.toISOString(),endDate:i.toISOString(),limit:l});let{data:e,error:u}=await o.N.from("ai_usage_logs").select("*").gte("created_at",s.toISOString()).lte("created_at",i.toISOString()).eq("user_id",r||"").order("created_at",{ascending:!1}).limit(100*l);if(u)throw u;let d={};for(let r of e||[]){let e=(0,n.w)(r.created_at,t);d[e]||(d[e]={date:e,totalRequests:0,totalTokens:0,totalCost:0,modelUsage:{}}),d[e].modelUsage[r.model]||(d[e].modelUsage[r.model]={requests:0,tokens:0,cost:0}),d[e].totalRequests++,d[e].totalTokens+=r.total_tokens,d[e].totalCost+=r.cost,d[e].modelUsage[r.model].requests++,d[e].modelUsage[r.model].tokens+=r.total_tokens,d[e].modelUsage[r.model].cost+=r.cost}return Object.values(d).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,l)}catch(e){throw console.error("Error retrieving AI usage statistics:",e),await (0,a.iL)(r||"system","ai.analytics.error","analytics",{error:e instanceof Error?e?.message:String(e),period:t,userId:r}),e}}n=(i.then?(await i)():i)[0],s()}catch(e){s(e)}})},1696:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>d,default:()=>u,routeModule:()=>c});var a=r(3480),o=r(8667),n=r(6435),i=r(8364),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,n.M)(i,"default"),d=(0,n.M)(i,"config"),c=new a.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/ai/usage-stats",pathname:"/api/ai/usage-stats",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},1708:e=>{e.exports=require("node:process")},2971:e=>{e.exports=import("zod")},3277:(e,t,r)=>{r.d(t,{fl:()=>s});let s={sessionDuration:604800,cookies:{accessToken:"sb-access-token",refreshToken:"sb-refresh-token",path:"/",secure:!0,httpOnly:!0,sameSite:"lax"},redirects:{afterLogin:"/dashboard",afterLogout:"/",authRequired:"/login",forbidden:"/access-denied"},roles:{default:"user",hierarchy:["admin","staff","therapist","user","guest"]},rateLimit:{maxLoginAttempts:5,lockoutDuration:900}}},3939:e=>{e.exports=require("@supabase/supabase-js")},5275:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{$:()=>i,w:()=>l});var a=r(802),o=r(5979),n=e([a,o]);function i(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function l(e,t){let r=new Date(e);switch(t){case"daily":default:return r.toISOString().split("T")[0];case"weekly":{let e=new Date(r),t=r.getDay();return e.setDate(r.getDate()-t),e.toISOString().split("T")[0]}case"monthly":return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`}}[a,o]=n.then?(await n)():n,s()}catch(e){s(e)}})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5643:(e,t,r)=>{r.d(t,{N:()=>n});var s=r(3939);let a=(void 0).PUBLIC_SUPABASE_URL,o=(void 0).PUBLIC_SUPABASE_ANON_KEY,n=a&&o?(0,s.createClient)(a,o):(console.warn("Using mock Supabase client in db module. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})})},5934:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{ND:()=>S});var a=r(3939),o=r(325),n=e([o]);o=(n.then?(await n)():n)[0];let l="undefined"!=typeof process?process.env:{},u=l.NODE_ENV||"development",d="https://example.supabase.co",c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example",E="production"===u,_=o._K?.SUPABASE_URL||l.PUBLIC_SUPABASE_URL||(E?void 0:d),g=o._K?.SUPABASE_ANON_KEY||l.PUBLIC_SUPABASE_ANON_KEY||(E?void 0:c),p=o._K?.SUPABASE_SERVICE_ROLE_KEY;function i(){return console.warn(E?"CRITICAL: Using mock Supabase client in production. This should never happen.":"Using mock Supabase client for development. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:null}),signOut:()=>Promise.resolve({error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})}}!E||_&&g||console.error("CRITICAL: Missing Supabase credentials in production environment");let m=_&&_!==d&&g&&g!==c,S=m?(0,a.createClient)(_,g,{auth:{persistSession:!0,autoRefreshToken:!0}}):i();m&&p?(0,a.createClient)(_,p,{auth:{persistSession:!1,autoRefreshToken:!1}}):i(),s()}catch(e){s(e)}})},5979:e=>{e.exports=import("tailwind-merge")},6186:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{PS:()=>i});var a=r(5754),o=r(7582),n=e([o]);o=(n.then?(await n)():n)[0];let l={USER:"user",STAFF:"staff",ADMIN:"admin"},u={[l.USER]:["create:conversations","read:conversations","update:conversations","delete:conversations","list:conversations","create:messages","read:messages","update:messages","read:users","update:users","read:settings","update:settings"],[l.STAFF]:["create:conversations","read:conversations","update:conversations","delete:conversations","list:conversations","create:messages","read:messages","update:messages","read:users","update:users","read:settings","update:settings","list:users","read:admin"],[l.ADMIN]:["create:conversations","read:conversations","update:conversations","delete:conversations","list:conversations","create:messages","read:messages","update:messages","delete:messages","read:users","update:users","delete:users","list:users","read:settings","update:settings","read:admin","manage:admin"]};function i(e){return async({cookies:t,redirect:r})=>{var s,n;let i=await (0,o.HW)(t);if(!i)return r(`/signin?error=${encodeURIComponent("You must be signed in to access this page")}`);let l=(s=i.role,n=e,u[s]?.includes(n)||!1);return(await (0,a.iL)({userId:i.id,action:"permission_check",resource:"access_control",resourceId:null,metadata:{permission:e,granted:l}}),l)?null:r(`/dashboard?error=${encodeURIComponent("You do not have permission to access this page")}`)}}s()}catch(e){s(e)}})},7582:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{HW:()=>i,wR:()=>l});var a=r(3277);r(5754);var o=r(5934),n=e([o]);async function i(e){let t=e.get(a.fl.cookies.accessToken)?.value,r=e.get(a.fl.cookies.refreshToken)?.value;if(!t||!r)return null;try{let{data:e,error:s}=await o.ND.auth.setSession({access_token:t,refresh_token:r});if(s||!e?.user)return console.error("Session error:",s),null;let{data:n}=await o.ND.from("profiles").select("*").eq("id",e.user.id).single();return{id:e.user.id,email:e.user.email||"",role:n?.role||a.fl.roles.default,fullName:n?.full_name||e.user.user_metadata?.full_name,avatarUrl:n?.avatar_url||e.user.user_metadata?.avatar_url,lastLogin:n?.last_login?new Date(n.last_login):null,metadata:{...e.user.user_metadata,...n?.metadata}}}catch(e){return console.error("Error getting current user:",e),null}}async function l(e){return!!await i(e)}o=(n.then?(await n)():n)[0];class u{async verifySession(e){let t=this.getCookiesFromRequest(e),r=await i(t);return r?{userId:r.id}:null}getCookiesFromRequest(e){let t=e.headers.get("cookie")||"";return{get:e=>{let r=t.match(RegExp(`${e}=([^;]+)`));return r?{value:r[1]}:void 0}}}}new u,s()}catch(e){s(e)}})},8364:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{GET:()=>d});var a=r(6186),o=r(1623),n=r(7452),i=r(5754),l=r(339),u=e([a,o]);[a,o]=u.then?(await u)():u;let d=async({request:e,cookies:t,url:r})=>{let s;try{if(!(s=await (0,l.Ht)(e)))return new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});let n=(0,a.PS)("read:admin");if(await n({cookies:t,redirect:()=>new Response(null,{status:401})}))return new Response(JSON.stringify({error:"Forbidden"}),{status:403,headers:{"Content-Type":"application/json"}});let u=r.searchParams.get("period")||"daily",d="true"===r.searchParams.get("allUsers"),c=d?void 0:s?.user?.id;await (0,i.iL)({userId:s?.user?.id||"anonymous",action:"ai.stats.request",resource:"ai",resourceId:void 0,metadata:{period:u,allUsers:d,status:"success"}});let E=await (0,o.b6)({period:u,userId:c});return await (0,i.iL)({userId:s?.user?.id||"anonymous",action:"ai.stats.response",resource:"ai",resourceId:void 0,metadata:{period:u,allUsers:d,statsCount:E.length,status:"success"}}),new Response(JSON.stringify({stats:E}),{status:200,headers:{"Content-Type":"application/json","Cache-Control":"private, max-age=60"}})}catch(e){return console.error("Error in AI usage stats API:",e),await (0,i.iL)({userId:s?.user?.id||"anonymous",action:"ai.stats.error",resource:"ai",resourceId:void 0,metadata:{error:e instanceof Error?e?.message:String(e),stack:e instanceof Error?e?.stack:void 0,status:"error"}}),(0,n.hS)(e)}};s()}catch(e){s(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[798],()=>r(1696));module.exports=s})();