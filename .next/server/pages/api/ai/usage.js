"use strict";(()=>{var e={};e.id=621,e.ids=[621],e.modules={802:e=>{e.exports=import("clsx")},1524:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{B7:()=>l,lv:()=>i});var s=a(2971),n=e([s]);let o=(s=(n.then?(await n)():n)[0]).default.object({role:s.default.enum(["system","user","assistant"]),content:s.default.string().min(1).max(32768),name:s.default.string().optional()}),i=s.default.object({model:s.default.string().min(1).default("togethercomputer/llama-3-8b-instruct"),messages:s.default.array(o).min(1).max(100),temperature:s.default.number().min(0).max(2).default(.7),max_tokens:s.default.number().min(1).max(4096).default(1024),stream:s.default.boolean().default(!1),presence_penalty:s.default.number().min(-2).max(2).default(0).optional(),frequency_penalty:s.default.number().min(-2).max(2).default(0).optional(),top_p:s.default.number().min(0).max(1).default(1).optional()}),l=s.default.object({period:s.default.enum(["daily","weekly","monthly"]).default("daily"),allUsers:s.default.boolean().default(!1),startDate:s.default.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional(),endDate:s.default.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional()});s.default.object({text:s.default.string().min(1).max(5e3),model:s.default.string().default("togethercomputer/llama-3-8b-instruct").optional(),includeReasoning:s.default.boolean().default(!1).optional()}),s.default.object({text:s.default.string().min(1).max(5e3),userId:s.default.string().optional(),threshold:s.default.number().min(0).max(1).default(.7).optional(),categories:s.default.array(s.default.string()).optional()}),s.default.object({messages:s.default.array(o).min(1).max(100),userId:s.default.string().optional(),model:s.default.string().default("togethercomputer/llama-3-8b-instruct").optional(),includeAnalysis:s.default.boolean().default(!1).optional(),safety:s.default.object({enabled:s.default.boolean().default(!0),threshold:s.default.number().min(0).max(1).default(.7)}).optional()}),s.default.object({messages:s.default.array(o).min(2).max(100),userId:s.default.string().optional(),interventionTypes:s.default.array(s.default.string()).optional(),includeTextAnalysis:s.default.boolean().default(!1).optional()}),r()}catch(e){r(e)}})},1623:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{b6:()=>l});var s=a(5754),n=a(5643),o=a(5275),i=e([o]);async function l(e){let{period:t="daily",userId:a,startDate:r=new Date(Date.now()-2592e6),endDate:i=new Date,limit:l=30}=e;try{await (0,s.iL)(a||"system","ai.analytics.request","analytics",{period:t,startDate:r.toISOString(),endDate:i.toISOString(),limit:l});let{data:e,error:u}=await n.N.from("ai_usage_logs").select("*").gte("created_at",r.toISOString()).lte("created_at",i.toISOString()).eq("user_id",a||"").order("created_at",{ascending:!1}).limit(100*l);if(u)throw u;let d={};for(let a of e||[]){let e=(0,o.w)(a.created_at,t);d[e]||(d[e]={date:e,totalRequests:0,totalTokens:0,totalCost:0,modelUsage:{}}),d[e].modelUsage[a.model]||(d[e].modelUsage[a.model]={requests:0,tokens:0,cost:0}),d[e].totalRequests++,d[e].totalTokens+=a.total_tokens,d[e].totalCost+=a.cost,d[e].modelUsage[a.model].requests++,d[e].modelUsage[a.model].tokens+=a.total_tokens,d[e].modelUsage[a.model].cost+=a.cost}return Object.values(d).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()).slice(0,l)}catch(e){throw console.error("Error retrieving AI usage statistics:",e),await (0,s.iL)(a||"system","ai.analytics.error","analytics",{error:e instanceof Error?e?.message:String(e),period:t,userId:a}),e}}o=(i.then?(await i)():i)[0],r()}catch(e){r(e)}})},1708:e=>{e.exports=require("node:process")},2824:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>d,default:()=>u,routeModule:()=>c});var s=a(3480),n=a(8667),o=a(6435),i=a(2854),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,o.M)(i,"default"),d=(0,o.M)(i,"config"),c=new s.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/ai/usage",pathname:"/api/ai/usage",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},2854:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{GET:()=>c});var s=a(5754),n=a(1623),o=a(7452),i=a(339),l=a(7544),u=a(1524),d=e([n,l,u]);[n,l,u]=d.then?(await d)():d;let c=async({request:e})=>{let t;try{if(t=await (0,i.Ht)(e),!t?.user)return new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}});let a=t?.user?.role==="admin",[r,o]=(0,l.fe)(new URL(e.url),u.B7);if(o)return await (0,s.iL)({userId:t?.user?.id||"anonymous",action:"ai.usage.validation_error",resource:"ai",resourceId:void 0,metadata:{error:o.error,details:JSON.stringify(o.details),status:"error"}}),new Response(JSON.stringify(o),{status:o.status,headers:{"Content-Type":"application/json"}});if(r.allUsers&&!a)return new Response(JSON.stringify({error:"Forbidden",message:"You do not have permission to view all users data"}),{status:403,headers:{"Content-Type":"application/json"}});await (0,s.iL)({userId:t?.user?.id||"anonymous",action:"ai.usage.request",resource:"ai",resourceId:void 0,metadata:{period:r.period,allUsers:r.allUsers,startDate:r.startDate,endDate:r.endDate,status:"success"}});let d=await (0,n.b6)({period:r.period,userId:r.allUsers?void 0:t?.user?.id,startDate:r.startDate?new Date(r.startDate):void 0,endDate:r.endDate?new Date(r.endDate):void 0});return new Response(JSON.stringify(d),{status:200,headers:{"Content-Type":"application/json","Cache-Control":"private, max-age=60"}})}catch(e){return console.error("Error in AI usage API:",e),await (0,s.iL)({userId:t?.user?.id||"anonymous",action:"ai.usage.error",resource:"ai",resourceId:void 0,metadata:{error:e instanceof Error?e.message:String(e),stack:e instanceof Error?e.stack:void 0,status:"error"}}),(0,o.hS)(e)}};r()}catch(e){r(e)}})},2971:e=>{e.exports=import("zod")},3939:e=>{e.exports=require("@supabase/supabase-js")},5275:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{$:()=>i,w:()=>l});var s=a(802),n=a(5979),o=e([s,n]);function i(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function l(e,t){let a=new Date(e);switch(t){case"daily":default:return a.toISOString().split("T")[0];case"weekly":{let e=new Date(a),t=a.getDay();return e.setDate(a.getDate()-t),e.toISOString().split("T")[0]}case"monthly":return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`}}[s,n]=o.then?(await o)():o,r()}catch(e){r(e)}})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5643:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(3939);let s=(void 0).PUBLIC_SUPABASE_URL,n=(void 0).PUBLIC_SUPABASE_ANON_KEY,o=s&&n?(0,r.createClient)(s,n):(console.warn("Using mock Supabase client in db module. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})})},5979:e=>{e.exports=import("tailwind-merge")},7544:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.d(t,{fe:()=>i,sv:()=>o});var s=a(2971),n=e([s]);async function o(e,t){try{let a=await e.json(),r=t.safeParse(a);if(!r?.success)return[null,{status:400,error:"Invalid request parameters",details:r?.error.format()}];return[r?.data,null]}catch(e){return[null,{status:400,error:"Invalid JSON in request body",details:e instanceof Error?e?.message:String(e)}]}}function i(e,t){try{let a={};e.searchParams.forEach((e,t)=>{a[t]=e});let r=t.safeParse(a);if(!r.success)return[null,{status:400,error:"Invalid query parameters",details:r?.error.format()}];return[r?.data,null]}catch(e){return[null,{status:400,error:"Error parsing query parameters",details:e instanceof Error?e?.message:String(e)}]}}(s=(n.then?(await n)():n)[0]).z.string().uuid().or(s.z.string().regex(/^[\w-]{21}$/)),r()}catch(e){r(e)}})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[798],()=>a(2824));module.exports=r})();