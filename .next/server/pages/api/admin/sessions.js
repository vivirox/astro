"use strict";(()=>{var e={};e.id=904,e.ids=[904],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},4028:(e,r,t)=>{t.d(r,{b:()=>i});var n=t(9848);async function s(e,r){try{let{request:t,cookies:s}=e,i=t.headers.get("Authorization"),a=i?i.replace("Bearer ",""):s.get("admin_token")?.value;if(!a)return null;let o=n.zQ.getInstance(),c=await o.verifyAdminToken(a);if(!c)return null;let u=!0;return r&&(u=await o.hasPermission(c.userId,r)),{userId:c.userId,isAdmin:!0,hasPermission:u}}catch{return null}}function i(e){return async r=>{let t=await s(r,e);return t?e&&!t.hasPermission?new Response(JSON.stringify({error:"Insufficient permissions"}),{status:403,headers:{"Content-Type":"application/json"}}):(r.locals.admin=t,null):new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}})}}},4420:(e,r,t)=>{t.d(r,{H:()=>s,n:()=>i});let n=(0,t(8951).tZ)();function s(e){try{let r=Date.now(),t={...JSON.parse(JSON.stringify(e)),iat:r,exp:r+36e5},n=JSON.stringify(t);return btoa(n)}catch(e){throw n.error("Failed to create verification token",{error:e}),Error("Verification token creation failed")}}function i(e){try{let r=JSON.parse(atob(e));if(r.exp<Date.now())return n.warn("Token expired",{token:e}),null;return r}catch(r){return n.error("Error verifying token",{error:r,token:e}),null}}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},7097:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>m,routeModule:()=>h});var n={};t.r(n),t.d(n,{GET:()=>l,POST:()=>d});var s=t(3480),i=t(8667),a=t(6435),o=t(9848),c=t(4028);let u=(0,t(8951).tZ)(),l=async e=>{let r=await (0,c.b)(o.pl.MANAGE_SESSIONS)(e);if(r)return r;try{let{userId:r}=e.locals.admin,t=new URL(e.request.url),n=Number.parseInt(t.searchParams.get("limit")||"10",10),s=Number.parseInt(t.searchParams.get("offset")||"0",10),i=t.searchParams.get("therapistId")||void 0,a=t.searchParams.get("clientId")||void 0,c=t.searchParams.get("startDate")||void 0,l=t.searchParams.get("endDate")||void 0,d=o.zQ.getInstance(),m=await d.getSessions({limit:n,offset:s,therapistId:i,clientId:a,startDate:c?new Date(c):void 0,endDate:l?new Date(l):void 0});return u.info(`Admin user ${r} accessed sessions list`),new Response(JSON.stringify({success:!0,sessions:m.sessions,pagination:{total:m?.total??0,limit:n,offset:s,hasMore:s+n<m.total}}),{status:200,headers:{"Content-Type":"application/json"}})}catch{return u.error("Error fetching sessions"),new Response(JSON.stringify({error:"Failed to fetch sessions"}),{status:500,headers:{"Content-Type":"application/json"}})}},d=async e=>{let r=await (0,c.b)(o.pl.MANAGE_SESSIONS)(e);if(r)return r;try{let r;let{userId:t}=e.locals.admin,{sessionId:n,action:s}=await e.request.json();if(!n||!s)return new Response(JSON.stringify({error:"Missing required fields"}),{status:400,headers:{"Content-Type":"application/json"}});let i=o.zQ.getInstance();switch(s){case"lock":r=await i.lockSession(n);break;case"unlock":r=await i.unlockSession(n);break;case"archive":r=await i.archiveSession(n);break;default:return new Response(JSON.stringify({error:"Invalid action"}),{status:400,headers:{"Content-Type":"application/json"}})}return u.info(`Admin user ${t} performed action "${s}" on session ${n}`),new Response(JSON.stringify({success:!0,result:r}),{status:200,headers:{"Content-Type":"application/json"}})}catch{return u.error("Error managing session"),new Response(JSON.stringify({error:"Failed to manage session"}),{status:500,headers:{"Content-Type":"application/json"}})}},m=(0,a.M)(n,"default"),p=(0,a.M)(n,"config"),h=new s.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/admin/sessions",pathname:"/api/admin/sessions",bundlePath:"",filename:""},userland:n})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,r,t)=>{let n;t.d(r,{tZ:()=>o});var s=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let i=()=>process.env.LOG_LEVEL||"info";class a{constructor(e="info",r){this.debug=(e,r)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,r))},this.info=(e,r)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,r))},this.warn=(e,r)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,r))},this.error=(e,r)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,r))},this.logLevel=e,this.isDevelopment=!1,this.prefix=r}createLogEntry(e,r,t){return{message:this.prefix?`[${this.prefix}] ${r}`:r,level:e,timestamp:Date.now(),metadata:t}}formatLogEntry({message:e,level:r,timestamp:t,metadata:n}){let s=new Date(t).toISOString(),i=n?` ${JSON.stringify(n)}`:"";return`[${s}] [${r.toUpperCase()}] ${e}${i}`}writeLog(e){let r=this.formatLogEntry(e);switch(e.level){case"error":console.error(r);break;case"warn":case"info":case"debug":console.warn(r)}}shouldLog(e){let r=Object.values(s),t=r.indexOf(this.logLevel);return r.indexOf(e)>=t}}function o(e){return(n||(n=new a(i())),e?.prefix)?new a(i(),e.prefix):n}o()},9848:(e,r,t)=>{t.d(r,{pl:()=>a,zQ:()=>c});var n=t(8951),s=t(4420);let i=(0,n.tZ)();var a=function(e){return e.VIEW_USERS="view_users",e.CREATE_USER="create_user",e.UPDATE_USER="update_user",e.DELETE_USER="delete_user",e.VIEW_SESSIONS="view_sessions",e.MANAGE_SESSIONS="manage_sessions",e.VIEW_AUDIT_LOGS="view_audit_logs",e.MANAGE_SECURITY="manage_security",e.ROTATE_KEYS="rotate_keys",e.VIEW_METRICS="view_metrics",e.CONFIGURE_SYSTEM="configure_system",e}({});let o={super_admin:Object.values(a),clinical_admin:["view_users","create_user","update_user","view_sessions","manage_sessions","view_metrics"],security_admin:["view_audit_logs","manage_security","rotate_keys","view_metrics"],support_admin:["view_users","view_sessions","view_metrics"]};class c{constructor(){}static getInstance(){return c.instance||(c.instance=new c),c.instance}async getSessions(e){return{sessions:[],total:0}}lockSession(e){throw Error("Method not implemented.")}unlockSession(e){throw Error("Method not implemented.")}archiveSession(e){throw Error("Method not implemented.")}async isAdmin(e){try{return!!await this.getAdminUser(e)}catch(e){return i.error("Error checking admin status:",e),!1}}async getAdminUser(e){try{return this.getMockAdminUser(e)}catch(e){return i.error("Error getting admin user:",e),null}}async hasPermission(e,r){try{let t=await this.getAdminUser(e);if(!t)return!1;if(t.permissions&&t.permissions.includes(r))return!0;return o[t.role].includes(r)}catch(e){return i.error("Error checking permission:",e),!1}}async verifyAdminToken(e){try{let r=await (0,s.n)(e);if(!r||!r.userId)return null;let t=await this.getAdminUser(r.userId);if(!t)return null;return{userId:t.id,role:t.role}}catch(e){return i.error("Error verifying admin token:",e),null}}async getAllAdmins(){try{return[this.getMockAdminUser("admin1"),this.getMockAdminUser("admin2"),this.getMockAdminUser("admin3"),this.getMockAdminUser("admin4")].filter(Boolean)}catch(e){return i.error("Error getting all admins:",e),[]}}async getSystemMetrics(){try{return{activeUsers:128,activeTherapists:42,activeSessions:35,messagesLast24Hours:1250,averageResponseTime:850,serverLoad:.42,encryptionOperations:9876,securityLevel:{standard:15,hipaa:65,maximum:20}}}catch(e){return i.error("Error getting system metrics:",e),{}}}getMockAdminUser(e){return({admin1:{id:"admin1",name:"Super Admin",email:"super@example.com",role:"super_admin"},admin2:{id:"admin2",name:"Clinical Director",email:"clinical@example.com",role:"clinical_admin"},admin3:{id:"admin3",name:"Security Officer",email:"security@example.com",role:"security_admin"},admin4:{id:"admin4",name:"Support Specialist",email:"support@example.com",role:"support_admin"}})[e]||null}async isAdminRequest(e){try{let r;let t=e.cookies.get("token")?.value;e.locals.headers?.authorization?r=e.locals.headers.authorization.replace("Bearer ",""):(void 0).SSR&&e.request.headers&&(r=e.request.headers.get("Authorization")?.replace("Bearer ",""));let n=t||r;if(!n)return!1;return!!await this.verifyAdminToken(n)}catch(e){return i.error("Error checking admin request:",e),!1}}}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=7097);module.exports=t})();