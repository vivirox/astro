"use strict";(()=>{var e={};e.id=61,e.ids=[61],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},4028:(e,r,t)=>{t.d(r,{b:()=>s});var n=t(9848);async function i(e,r){try{let{request:t,cookies:i}=e,s=t.headers.get("Authorization"),a=s?s.replace("Bearer ",""):i.get("admin_token")?.value;if(!a)return null;let o=n.zQ.getInstance(),u=await o.verifyAdminToken(a);if(!u)return null;let c=!0;return r&&(c=await o.hasPermission(u.userId,r)),{userId:u.userId,isAdmin:!0,hasPermission:c}}catch{return null}}function s(e){return async r=>{let t=await i(r,e);return t?e&&!t.hasPermission?new Response(JSON.stringify({error:"Insufficient permissions"}),{status:403,headers:{"Content-Type":"application/json"}}):(r.locals.admin=t,null):new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}})}}},4420:(e,r,t)=>{t.d(r,{H:()=>i,n:()=>s});let n=(0,t(8951).tZ)();function i(e){try{let r=Date.now(),t={...JSON.parse(JSON.stringify(e)),iat:r,exp:r+36e5},n=JSON.stringify(t);return btoa(n)}catch(e){throw n.error("Failed to create verification token",{error:e}),Error("Verification token creation failed")}}function s(e){try{let r=JSON.parse(atob(e));if(r.exp<Date.now())return n.warn("Token expired",{token:e}),null;return r}catch(r){return n.error("Error verifying token",{error:r,token:e}),null}}},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,r,t)=>{let n;t.d(r,{tZ:()=>o});var i=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let s=()=>process.env.LOG_LEVEL||"info";class a{constructor(e="info",r){this.debug=(e,r)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,r))},this.info=(e,r)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,r))},this.warn=(e,r)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,r))},this.error=(e,r)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,r))},this.logLevel=e,this.isDevelopment=!1,this.prefix=r}createLogEntry(e,r,t){return{message:this.prefix?`[${this.prefix}] ${r}`:r,level:e,timestamp:Date.now(),metadata:t}}formatLogEntry({message:e,level:r,timestamp:t,metadata:n}){let i=new Date(t).toISOString(),s=n?` ${JSON.stringify(n)}`:"";return`[${i}] [${r.toUpperCase()}] ${e}${s}`}writeLog(e){let r=this.formatLogEntry(e);switch(e.level){case"error":console.error(r);break;case"warn":case"info":case"debug":console.warn(r)}}shouldLog(e){let r=Object.values(i),t=r.indexOf(this.logLevel);return r.indexOf(e)>=t}}function o(e){return(n||(n=new a(s())),e?.prefix)?new a(s(),e.prefix):n}o()},9612:(e,r,t)=>{t.r(r),t.d(r,{config:()=>p,default:()=>m,routeModule:()=>g});var n={};t.r(n),t.d(n,{GET:()=>l,PATCH:()=>d});var i=t(3480),s=t(8667),a=t(6435),o=t(9848),u=t(4028);let c=(0,t(8951).tZ)(),l=async e=>{let r=await (0,u.b)(o.pl.VIEW_USERS)(e);if(r)return r;try{let{userId:r}=e.locals.admin,t=new URL(e.request.url),n=Number.parseInt(t.searchParams.get("limit")||"10",10),i=Number.parseInt(t.searchParams.get("offset")||"0",10),s=t.searchParams.get("role")||void 0,a=o.zQ.getInstance(),u=await a.getAllAdmins(),l=s?u.filter(e=>e.role===s):u,d=l.length,m=l.slice(i,i+n);return c.info(`Admin user ${r} accessed user list`),new Response(JSON.stringify({success:!0,users:m,pagination:{total:d,limit:n,offset:i,hasMore:i+n<d}}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return c.error("Error fetching users:",{error:e instanceof Error?e.message:String(e)}),new Response(JSON.stringify({error:"Failed to fetch users"}),{status:500,headers:{"Content-Type":"application/json"}})}},d=async e=>{let r=await (0,u.b)(o.pl.UPDATE_USER)(e);if(r)return r;try{let{userId:r}=e.locals.admin,{userId:t,updates:n}=await e.request.json();if(!t||!n)return new Response(JSON.stringify({error:"Missing required fields"}),{status:400,headers:{"Content-Type":"application/json"}});let i=o.zQ.getInstance(),s=await i.getAdminUser(t);if(!s)return new Response(JSON.stringify({error:"User not found"}),{status:404,headers:{"Content-Type":"application/json"}});let a={...s,...n};return c.info(`Admin user ${r} updated user ${t}`),new Response(JSON.stringify({success:!0,user:a}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return c.error("Error updating user:",{error:e instanceof Error?e.message:String(e)}),new Response(JSON.stringify({error:"Failed to update user"}),{status:500,headers:{"Content-Type":"application/json"}})}},m=(0,a.M)(n,"default"),p=(0,a.M)(n,"config"),g=new i.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/admin/users",pathname:"/api/admin/users",bundlePath:"",filename:""},userland:n})},9848:(e,r,t)=>{t.d(r,{pl:()=>a,zQ:()=>u});var n=t(8951),i=t(4420);let s=(0,n.tZ)();var a=function(e){return e.VIEW_USERS="view_users",e.CREATE_USER="create_user",e.UPDATE_USER="update_user",e.DELETE_USER="delete_user",e.VIEW_SESSIONS="view_sessions",e.MANAGE_SESSIONS="manage_sessions",e.VIEW_AUDIT_LOGS="view_audit_logs",e.MANAGE_SECURITY="manage_security",e.ROTATE_KEYS="rotate_keys",e.VIEW_METRICS="view_metrics",e.CONFIGURE_SYSTEM="configure_system",e}({});let o={super_admin:Object.values(a),clinical_admin:["view_users","create_user","update_user","view_sessions","manage_sessions","view_metrics"],security_admin:["view_audit_logs","manage_security","rotate_keys","view_metrics"],support_admin:["view_users","view_sessions","view_metrics"]};class u{constructor(){}static getInstance(){return u.instance||(u.instance=new u),u.instance}async getSessions(e){return{sessions:[],total:0}}lockSession(e){throw Error("Method not implemented.")}unlockSession(e){throw Error("Method not implemented.")}archiveSession(e){throw Error("Method not implemented.")}async isAdmin(e){try{return!!await this.getAdminUser(e)}catch(e){return s.error("Error checking admin status:",e),!1}}async getAdminUser(e){try{return this.getMockAdminUser(e)}catch(e){return s.error("Error getting admin user:",e),null}}async hasPermission(e,r){try{let t=await this.getAdminUser(e);if(!t)return!1;if(t.permissions&&t.permissions.includes(r))return!0;return o[t.role].includes(r)}catch(e){return s.error("Error checking permission:",e),!1}}async verifyAdminToken(e){try{let r=await (0,i.n)(e);if(!r||!r.userId)return null;let t=await this.getAdminUser(r.userId);if(!t)return null;return{userId:t.id,role:t.role}}catch(e){return s.error("Error verifying admin token:",e),null}}async getAllAdmins(){try{return[this.getMockAdminUser("admin1"),this.getMockAdminUser("admin2"),this.getMockAdminUser("admin3"),this.getMockAdminUser("admin4")].filter(Boolean)}catch(e){return s.error("Error getting all admins:",e),[]}}async getSystemMetrics(){try{return{activeUsers:128,activeTherapists:42,activeSessions:35,messagesLast24Hours:1250,averageResponseTime:850,serverLoad:.42,encryptionOperations:9876,securityLevel:{standard:15,hipaa:65,maximum:20}}}catch(e){return s.error("Error getting system metrics:",e),{}}}getMockAdminUser(e){return({admin1:{id:"admin1",name:"Super Admin",email:"super@example.com",role:"super_admin"},admin2:{id:"admin2",name:"Clinical Director",email:"clinical@example.com",role:"clinical_admin"},admin3:{id:"admin3",name:"Security Officer",email:"security@example.com",role:"security_admin"},admin4:{id:"admin4",name:"Support Specialist",email:"support@example.com",role:"support_admin"}})[e]||null}async isAdminRequest(e){try{let r;let t=e.cookies.get("token")?.value;e.locals.headers?.authorization?r=e.locals.headers.authorization.replace("Bearer ",""):(void 0).SSR&&e.request.headers&&(r=e.request.headers.get("Authorization")?.replace("Bearer ",""));let n=t||r;if(!n)return!1;return!!await this.verifyAdminToken(n)}catch(e){return s.error("Error checking admin request:",e),!1}}}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=9612);module.exports=t})();