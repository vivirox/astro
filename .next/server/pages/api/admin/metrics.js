"use strict";(()=>{var e={};e.id=750,e.ids=[750],e.modules={3480:(e,r,t)=>{e.exports=t(5600)},4028:(e,r,t)=>{t.d(r,{b:()=>s});var i=t(9848);async function n(e,r){try{let{request:t,cookies:n}=e,s=t.headers.get("Authorization"),a=s?s.replace("Bearer ",""):n.get("admin_token")?.value;if(!a)return null;let o=i.zQ.getInstance(),c=await o.verifyAdminToken(a);if(!c)return null;let u=!0;return r&&(u=await o.hasPermission(c.userId,r)),{userId:c.userId,isAdmin:!0,hasPermission:u}}catch{return null}}function s(e){return async r=>{let t=await n(r,e);return t?e&&!t.hasPermission?new Response(JSON.stringify({error:"Insufficient permissions"}),{status:403,headers:{"Content-Type":"application/json"}}):(r.locals.admin=t,null):new Response(JSON.stringify({error:"Unauthorized"}),{status:401,headers:{"Content-Type":"application/json"}})}}},4420:(e,r,t)=>{t.d(r,{H:()=>n,n:()=>s});let i=(0,t(8951).tZ)();function n(e){try{let r=Date.now(),t={...JSON.parse(JSON.stringify(e)),iat:r,exp:r+36e5},i=JSON.stringify(t);return btoa(i)}catch(e){throw i.error("Failed to create verification token",{error:e}),Error("Verification token creation failed")}}function s(e){try{let r=JSON.parse(atob(e));if(r.exp<Date.now())return i.warn("Token expired",{token:e}),null;return r}catch(r){return i.error("Error verifying token",{error:r,token:e}),null}}},4708:(e,r,t)=>{t.r(r),t.d(r,{config:()=>m,default:()=>d,routeModule:()=>h});var i={};t.r(i),t.d(i,{GET:()=>l});var n=t(3480),s=t(8667),a=t(6435),o=t(9848),c=t(4028);let u=(0,t(8951).tZ)(),l=async e=>{let r=await (0,c.b)(o.pl.VIEW_METRICS)(e);if(r)return r;try{let{userId:r}=e.locals.admin,t=o.zQ.getInstance(),i=await t.getSystemMetrics();return u.info(`Admin user ${r} accessed system metrics`),new Response(JSON.stringify({success:!0,metrics:i}),{status:200,headers:{"Content-Type":"application/json"}})}catch{return u.error("Error fetching admin metrics"),new Response(JSON.stringify({error:"Failed to fetch metrics"}),{status:500,headers:{"Content-Type":"application/json"}})}},d=(0,a.M)(i,"default"),m=(0,a.M)(i,"config"),h=new n.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/admin/metrics",pathname:"/api/admin/metrics",bundlePath:"",filename:""},userland:i})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},8951:(e,r,t)=>{let i;t.d(r,{tZ:()=>o});var n=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({});let s=()=>process.env.LOG_LEVEL||"info";class a{constructor(e="info",r){this.debug=(e,r)=>{this.isDevelopment&&this.shouldLog("debug")&&this.writeLog(this.createLogEntry("debug",e,r))},this.info=(e,r)=>{this.isDevelopment&&this.shouldLog("info")&&this.writeLog(this.createLogEntry("info",e,r))},this.warn=(e,r)=>{this.shouldLog("warn")&&this.writeLog(this.createLogEntry("warn",e,r))},this.error=(e,r)=>{this.shouldLog("error")&&this.writeLog(this.createLogEntry("error",e,r))},this.logLevel=e,this.isDevelopment=!1,this.prefix=r}createLogEntry(e,r,t){return{message:this.prefix?`[${this.prefix}] ${r}`:r,level:e,timestamp:Date.now(),metadata:t}}formatLogEntry({message:e,level:r,timestamp:t,metadata:i}){let n=new Date(t).toISOString(),s=i?` ${JSON.stringify(i)}`:"";return`[${n}] [${r.toUpperCase()}] ${e}${s}`}writeLog(e){let r=this.formatLogEntry(e);switch(e.level){case"error":console.error(r);break;case"warn":case"info":case"debug":console.warn(r)}}shouldLog(e){let r=Object.values(n),t=r.indexOf(this.logLevel);return r.indexOf(e)>=t}}function o(e){return(i||(i=new a(s())),e?.prefix)?new a(s(),e.prefix):i}o()},9848:(e,r,t)=>{t.d(r,{pl:()=>a,zQ:()=>c});var i=t(8951),n=t(4420);let s=(0,i.tZ)();var a=function(e){return e.VIEW_USERS="view_users",e.CREATE_USER="create_user",e.UPDATE_USER="update_user",e.DELETE_USER="delete_user",e.VIEW_SESSIONS="view_sessions",e.MANAGE_SESSIONS="manage_sessions",e.VIEW_AUDIT_LOGS="view_audit_logs",e.MANAGE_SECURITY="manage_security",e.ROTATE_KEYS="rotate_keys",e.VIEW_METRICS="view_metrics",e.CONFIGURE_SYSTEM="configure_system",e}({});let o={super_admin:Object.values(a),clinical_admin:["view_users","create_user","update_user","view_sessions","manage_sessions","view_metrics"],security_admin:["view_audit_logs","manage_security","rotate_keys","view_metrics"],support_admin:["view_users","view_sessions","view_metrics"]};class c{constructor(){}static getInstance(){return c.instance||(c.instance=new c),c.instance}async getSessions(e){return{sessions:[],total:0}}lockSession(e){throw Error("Method not implemented.")}unlockSession(e){throw Error("Method not implemented.")}archiveSession(e){throw Error("Method not implemented.")}async isAdmin(e){try{return!!await this.getAdminUser(e)}catch(e){return s.error("Error checking admin status:",e),!1}}async getAdminUser(e){try{return this.getMockAdminUser(e)}catch(e){return s.error("Error getting admin user:",e),null}}async hasPermission(e,r){try{let t=await this.getAdminUser(e);if(!t)return!1;if(t.permissions&&t.permissions.includes(r))return!0;return o[t.role].includes(r)}catch(e){return s.error("Error checking permission:",e),!1}}async verifyAdminToken(e){try{let r=await (0,n.n)(e);if(!r||!r.userId)return null;let t=await this.getAdminUser(r.userId);if(!t)return null;return{userId:t.id,role:t.role}}catch(e){return s.error("Error verifying admin token:",e),null}}async getAllAdmins(){try{return[this.getMockAdminUser("admin1"),this.getMockAdminUser("admin2"),this.getMockAdminUser("admin3"),this.getMockAdminUser("admin4")].filter(Boolean)}catch(e){return s.error("Error getting all admins:",e),[]}}async getSystemMetrics(){try{return{activeUsers:128,activeTherapists:42,activeSessions:35,messagesLast24Hours:1250,averageResponseTime:850,serverLoad:.42,encryptionOperations:9876,securityLevel:{standard:15,hipaa:65,maximum:20}}}catch(e){return s.error("Error getting system metrics:",e),{}}}getMockAdminUser(e){return({admin1:{id:"admin1",name:"Super Admin",email:"super@example.com",role:"super_admin"},admin2:{id:"admin2",name:"Clinical Director",email:"clinical@example.com",role:"clinical_admin"},admin3:{id:"admin3",name:"Security Officer",email:"security@example.com",role:"security_admin"},admin4:{id:"admin4",name:"Support Specialist",email:"support@example.com",role:"support_admin"}})[e]||null}async isAdminRequest(e){try{let r;let t=e.cookies.get("token")?.value;e.locals.headers?.authorization?r=e.locals.headers.authorization.replace("Bearer ",""):(void 0).SSR&&e.request.headers&&(r=e.request.headers.get("Authorization")?.replace("Bearer ",""));let i=t||r;if(!i)return!1;return!!await this.verifyAdminToken(i)}catch(e){return s.error("Error checking admin request:",e),!1}}}}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=4708);module.exports=t})();