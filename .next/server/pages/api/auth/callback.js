"use strict";(()=>{var e={};e.id=745,e.ids=[745],e.modules={325:(e,r,t)=>{t.a(e,async(e,o)=>{try{let s;t.d(r,{Ay:()=>_,_K:()=>l});var n=t(2971),a=e([n]);let E=(n=(a.then?(await a)():a)[0]).z.object({NODE_ENV:n.z.enum(["development","production","test"]).default("development"),VERCEL:n.z.string().optional(),VERCEL_ENV:n.z.enum(["development","preview","production"]).optional(),VERCEL_URL:n.z.string().optional(),VERCEL_TOKEN:n.z.string().optional(),VERCEL_ORG_ID:n.z.string().optional(),VERCEL_PROJECT_ID:n.z.string().optional(),PORT:n.z.string().transform(Number).default("3000"),LOG_LEVEL:n.z.enum(["error","warn","info","verbose","debug"]).default("info"),ENABLE_RATE_LIMITING:n.z.string().transform(e=>"true"===e).default("true"),POSTGRES_URL:n.z.string().optional(),POSTGRES_PRISMA_URL:n.z.string().optional(),POSTGRES_URL_NON_POOLING:n.z.string().optional(),SUPABASE_URL:n.z.string().url().optional(),SUPABASE_KEY:n.z.string().optional(),SUPABASE_ANON_KEY:n.z.string().optional(),SUPABASE_SERVICE_ROLE_KEY:n.z.string().optional(),SUPABASE_JWT_SECRET:n.z.string().optional(),OPENAI_API_KEY:n.z.string().optional(),OPENAI_BASE_URL:n.z.string().url().optional(),TOGETHER_API_KEY:n.z.string().optional(),GOOGLE_API_KEY:n.z.string().optional(),REPLICATE_API_TOKEN:n.z.string().optional(),SENTRY_DSN:n.z.string().url().optional(),AXIOM_DATASET:n.z.string().optional(),AXIOM_TOKEN:n.z.string().optional(),VITE_LITLYX_PROJECT_ID:n.z.string().optional(),VITE_LITLYX_API_KEY:n.z.string().optional(),EMAIL_FROM:n.z.string().email().optional(),RESEND_API_KEY:n.z.string().optional(),SECURITY_ENABLE_BRUTE_FORCE_PROTECTION:n.z.string().transform(e=>"true"===e).default("true"),SECURITY_MAX_LOGIN_ATTEMPTS:n.z.string().transform(Number).default("5"),SECURITY_ACCOUNT_LOCKOUT_DURATION:n.z.string().transform(Number).default("1800"),SECURITY_API_ABUSE_THRESHOLD:n.z.string().transform(Number).default("100"),SECURITY_ENABLE_ALERTS:n.z.string().transform(e=>"true"===e).default("true"),RATE_LIMIT_MAX_REQUESTS:n.z.string().transform(Number).default("100"),RATE_LIMIT_WINDOW_MS:n.z.string().transform(Number).default("900000"),LOG_CONSOLE:n.z.string().transform(e=>"true"===e).default("true"),LOG_AUDIT:n.z.string().transform(e=>"true"===e).default("true"),VITE_API_URL:n.z.string().url().optional(),VITE_SUPABASE_URL:n.z.string().url().optional(),VITE_SUPABASE_ANON_KEY:n.z.string().optional()});function i(){return s||(s=E.parse(process.env)),s}let l=i(),_={isDevelopment:()=>"development"===i().NODE_ENV,isProduction:()=>"production"===i().NODE_ENV,isTest:()=>"test"===i().NODE_ENV,server:{port:()=>i().PORT,logLevel:()=>i().LOG_LEVEL,enableRateLimiting:()=>i().ENABLE_RATE_LIMITING},database:{url:()=>i().POSTGRES_URL,prismaUrl:()=>i().POSTGRES_PRISMA_URL,nonPoolingUrl:()=>i().POSTGRES_URL_NON_POOLING},supabase:{url:()=>i().SUPABASE_URL,key:()=>i().SUPABASE_KEY,anonKey:()=>i().SUPABASE_ANON_KEY,serviceRoleKey:()=>i().SUPABASE_SERVICE_ROLE_KEY,jwtSecret:()=>i().SUPABASE_JWT_SECRET},ai:{openAiKey:()=>i().OPENAI_API_KEY,openAiBaseUrl:()=>i().OPENAI_BASE_URL,togetherApiKey:()=>i().TOGETHER_API_KEY,googleApiKey:()=>i().GOOGLE_API_KEY,replicateToken:()=>i().REPLICATE_API_TOKEN},monitoring:{sentryDsn:()=>i().SENTRY_DSN,axiomDataset:()=>i().AXIOM_DATASET,axiomToken:()=>i().AXIOM_TOKEN,litlyxProjectId:()=>i().VITE_LITLYX_PROJECT_ID,litlyxApiKey:()=>i().VITE_LITLYX_API_KEY},email:{from:()=>i().EMAIL_FROM,resendApiKey:()=>i().RESEND_API_KEY},deployment:{vercelEnv:()=>i().VERCEL_ENV,isVercel:()=>i().VERCEL,vercelUrl:()=>i().VERCEL_URL,vercelToken:()=>i().VERCEL_TOKEN,vercelOrgId:()=>i().VERCEL_ORG_ID,vercelProjectId:()=>i().VERCEL_PROJECT_ID},security:{enableBruteForceProtection:()=>i().SECURITY_ENABLE_BRUTE_FORCE_PROTECTION,maxLoginAttempts:()=>i().SECURITY_MAX_LOGIN_ATTEMPTS,accountLockoutDuration:()=>i().SECURITY_ACCOUNT_LOCKOUT_DURATION,apiAbuseThreshold:()=>i().SECURITY_API_ABUSE_THRESHOLD,enableAlerts:()=>i().SECURITY_ENABLE_ALERTS},rateLimiting:{maxRequests:()=>i().RATE_LIMIT_MAX_REQUESTS,windowMs:()=>i().RATE_LIMIT_WINDOW_MS},logging:{console:()=>i().LOG_CONSOLE,audit:()=>i().LOG_AUDIT},client:{apiUrl:()=>i().VITE_API_URL,supabaseUrl:()=>i().VITE_SUPABASE_URL,supabaseAnonKey:()=>i().VITE_SUPABASE_ANON_KEY}};o()}catch(e){o(e)}})},1952:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{GET:()=>i}),function(){var e=Error("Cannot find module '../../../lib/audit/log.js'");throw e.code="MODULE_NOT_FOUND",e}();var n=t(5934),a=e([n]);n=(a.then?(await a)():a)[0];let i=async({url:e,cookies:r,redirect:t})=>{let o=e.searchParams.get("code");if(!o)return new Response("No code provided",{status:400});try{let{data:e,error:a}=await n.ND.auth.exchangeCodeForSession(o);if(a)return console.error("Auth callback error:",a),new Response(a?.message,{status:500});let{access_token:i,refresh_token:s}=e?.session,{user:E}=e;if(r.set("sb-access-token",i,{path:"/",httpOnly:!0,secure:(void 0).PROD,sameSite:"lax",maxAge:3600}),r.set("sb-refresh-token",s,{path:"/",httpOnly:!0,secure:(void 0).PROD,sameSite:"lax",maxAge:604800}),E){let{data:e,error:r}=await n.ND.from("profiles").select("*").eq("id",E.id).single();if(r&&"PGRST116"!==r.code&&console.error("Profile fetch error:",r),!e){let{error:e}=await n.ND.from("profiles").insert({id:E.id,full_name:E.user_metadata.full_name||null,avatar_url:E.user_metadata.avatar_url||null,role:"user"});e&&console.error("Profile creation error:",e)}await Object(function(){var e=Error("Cannot find module '../../../lib/audit/log.js'");throw e.code="MODULE_NOT_FOUND",e}())({userId:E.id,action:"auth.signin.oauth",resource:"auth",metadata:{email:E.email,provider:E.app_metadata.provider}})}return t("/dashboard")}catch(e){return console.error("Auth callback error:",e),new Response("An unexpected error occurred",{status:500})}};o()}catch(e){o(e)}})},2971:e=>{e.exports=import("zod")},3480:(e,r,t)=>{e.exports=t(5600)},3939:e=>{e.exports=require("@supabase/supabase-js")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5934:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.d(r,{ND:()=>S});var n=t(3939),a=t(325),i=e([a]);a=(i.then?(await i)():i)[0];let E="undefined"!=typeof process?process.env:{},l=E.NODE_ENV||"development",_="https://example.supabase.co",u="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.example",A="production"===l,p=a._K?.SUPABASE_URL||E.PUBLIC_SUPABASE_URL||(A?void 0:_),T=a._K?.SUPABASE_ANON_KEY||E.PUBLIC_SUPABASE_ANON_KEY||(A?void 0:u),I=a._K?.SUPABASE_SERVICE_ROLE_KEY;function s(){return console.warn(A?"CRITICAL: Using mock Supabase client in production. This should never happen.":"Using mock Supabase client for development. This should not be used in production."),{auth:{getUser:()=>Promise.resolve({data:{user:null},error:null}),getSession:()=>Promise.resolve({data:{session:null},error:null}),signInWithPassword:()=>Promise.resolve({data:{user:null,session:null},error:null}),signOut:()=>Promise.resolve({error:null})},from:()=>({insert:()=>Promise.resolve({error:null}),select:()=>({eq:()=>({order:()=>({range:()=>Promise.resolve({data:[],error:null})})})})})}}!A||p&&T||console.error("CRITICAL: Missing Supabase credentials in production environment");let R=p&&p!==_&&T&&T!==u,S=R?(0,n.createClient)(p,T,{auth:{persistSession:!0,autoRefreshToken:!0}}):s();R&&I?(0,n.createClient)(p,I,{auth:{persistSession:!1,autoRefreshToken:!1}}):s(),o()}catch(e){o(e)}})},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8252:(e,r,t)=>{t.a(e,async(e,o)=>{try{t.r(r),t.d(r,{config:()=>_,default:()=>l,routeModule:()=>u});var n=t(3480),a=t(8667),i=t(6435),s=t(1952),E=e([s]);s=(E.then?(await E)():E)[0];let l=(0,i.M)(s,"default"),_=(0,i.M)(s,"config"),u=new n.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/auth/callback",pathname:"/api/auth/callback",bundlePath:"",filename:""},userland:s});o()}catch(e){o(e)}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8252);module.exports=t})();