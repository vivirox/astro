<!-- Generated by SpecStory -->

# Fixing Shell Script Exit Code Check (2025-03-18 16:54:15)

_**User**_

For the code present, we get this error:
```
Check exit code directly with e.g. 'if mycmd;', not indirectly with $?. (Trunk)
```
How can I resolve this? If you propose a fix, please make it concise.

---

_**Assistant**_

I'll help you fix the shellcheck warning. The issue is with using `$?` to check the exit status. The more idiomatic way in shell scripting is to check the command status directly.

Let me edit the file to fix this:

---

```diff
  echo -e "${BLUE}Starting rollback process...${NC}"
  if [[ -z "${DEPLOYMENT_ID}" ]]; then
- 	pnpm tsx src/scripts/rollback.ts
- else
- 	pnpm tsx src/scripts/rollback.ts --deployment="${DEPLOYMENT_ID}"
- fi
- 
- # Check result
- if [[ $? -eq 0 ]]; then
- 	echo -e "${GREEN}Rollback completed successfully!${NC}"
- 	echo -e "${YELLOW}Next steps:${NC}"
- 	echo "1. Verify application functionality"
- 	echo "2. Check logs for any errors"
- 	echo "3. Notify team that rollback is complete"
- 	exit 0
- else
- 	echo -e "${RED}Rollback failed. Please check logs for details.${NC}"
- 	echo -e "${YELLOW}Possible recovery actions:${NC}"
- 	echo "1. Check application logs for errors"
- 	echo "2. Verify database connectivity"
- 	echo "3. Contact infrastructure team for assistance"
- 	exit 1
+ 	if pnpm tsx src/scripts/rollback.ts; then
+ 		echo -e "${GREEN}Rollback completed successfully!${NC}"
+ 		echo -e "${YELLOW}Next steps:${NC}"
+ 		echo "1. Verify application functionality"
+ 		echo "2. Check logs for any errors"
+ 		echo "3. Notify team that rollback is complete"
+ 		exit 0
+ 	else
+ 		echo -e "${RED}Rollback failed. Please check logs for details.${NC}"
+ 		echo -e "${YELLOW}Possible recovery actions:${NC}"
+ 		echo "1. Check application logs for errors"
+ 		echo "2. Verify database connectivity"
+ 		echo "3. Contact infrastructure team for assistance"
+ 		exit 1
+ 	fi
+ else
+ 	if pnpm tsx src/scripts/rollback.ts --deployment="${DEPLOYMENT_ID}"; then
+ 		echo -e "${GREEN}Rollback completed successfully!${NC}"
+ 		echo -e "${YELLOW}Next steps:${NC}"
+ 		echo "1. Verify application functionality"
+ 		echo "2. Check logs for any errors"
+ 		echo "3. Notify team that rollback is complete"
+ 		exit 0
+ 	else
+ 		echo -e "${RED}Rollback failed. Please check logs for details.${NC}"
+ 		echo -e "${YELLOW}Possible recovery actions:${NC}"
+ 		echo "1. Check application logs for errors"
+ 		echo "2. Verify database connectivity"
+ 		echo "3. Contact infrastructure team for assistance"
+ 		exit 1
+ 	fi
  fi
  
```

---

I've fixed the shellcheck warning by replacing the `$?` check with direct command status checks using `if` statements. Instead of running the command and then checking `$?`, we now use the command directly in the `if` condition. This is considered better shell scripting practice and resolves the Trunk linter warning.

The change maintains the exact same functionality but follows shell best practices. The script will still exit with status 0 on success and status 1 on failure, with the same output messages.

---



---

