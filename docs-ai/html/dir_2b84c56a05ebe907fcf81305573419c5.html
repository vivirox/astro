<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/@flydotio/dockerfile Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_2b84c56a05ebe907fcf81305573419c5.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">dockerfile Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_755986259131ffbae0da3ad12e8d2995.html">node_modules</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Provides a Node.js generator to produce Dockerfiles and related files. It is intended to support any framework that lists its dependencies, includes a <code>start</code> script in <code>package.json</code>, and optionally includes a <code>build</code> script.</p>
<p>See <a href="./test">test</a> for a list of frameworks and examples of Dockerfiles produced based on the associated <code>package.json</code> and lock files.</p>
<p>See <a href="https://fly.io/blog/flydotio-heart-js/">blog post</a> for more information.</p>
<h1><a class="anchor" id="autotoc_md3379"></a>
Usage</h1>
<p>To run once:</p>
<div class="fragment"><div class="line">npx --yes @flydotio/dockerfile@latest</div>
<div class="line">bunx --bun @flydotio/dockerfile@latest</div>
</div><!-- fragment --><p>Or install it with your favorite package manager:</p>
<div class="fragment"><div class="line">bun add -d @flydotio/dockerfile</div>
<div class="line">npm install @flydotio/dockerfile --save-dev</div>
<div class="line">pnpm add -D @flydotio/dockerfile</div>
<div class="line">yarn add @flydotio/dockerfile --dev</div>
</div><!-- fragment --><p>Once installed, you can run and re-run using <code>npx dockerfile</code> for Node.js applications or <code>bunx --bun dockerfile</code> for Bun applications.</p>
<p>Options are saved between runs into <code>package.json</code>. To invert a boolean options, add or remove a no- prefix from the option name.</p>
<h2><a class="anchor" id="autotoc_md3380"></a>
Options:</h2>
<ul>
<li><code>--alpine</code> - use <a href="https://www.alpinelinux.org/">alpine</a> as base image</li>
<li><code>--build=CMD</code> - command to be used to build your application.</li>
<li><code>--cache</code> - use build caching to speed up builds</li>
<li><code>--cmd=CMD</code> - CMD to use in Dockerfile</li>
<li><code>--defer-build</code> - may be needed when your build step requires access to secrets that are not available at image build time. Results in larger images and slower deployments.</li>
<li><code>--dev</code> - include <code>devDependencies</code> in the production image.</li>
<li><code>--distroless</code> - use <a href="https://github.com/GoogleContainerTools/distroless">distroless</a> base image to reduce image size</li>
<li><code>--entrypoint</code> - ENTRYPOINT to use in Dockerfile</li>
<li><code>--ignore-scripts</code> - do not execute any scripts defined in the project <code>package.json</code> and its dependencies.</li>
<li><code>--force</code> - overwrite existing files</li>
<li><code>--legacy-peer-deps</code> - <a href="https://docs.npmjs.com/cli/v7/using-npm/config#legacy-peer-deps">ignore peer dependencies</a>.</li>
<li><code>--litefs</code> - configure and enable <a href="https://fly.io/docs/litefs/">litefs</a>.</li>
<li><code>--litestream</code> - configure and enable <a href="https://litestream.io/">litestream</a>.</li>
<li><code>--nginxRoot=DIR</code> - serve static files from given directory via <a href="https://www.nginx.com/">nginx</a>.</li>
<li><code>--link</code> - Add <a href="https://docs.docker.com/engine/reference/builder/#copy---link">&ndash;link</a> to COPY statements. Some tools, including <a href="https://www.redhat.com/en/topics/containers/what-is-buildah">buildah</a>) or <a href="https://docs.docker.com/build/buildkit/">Buildkit</a> don't properly support this feature.</li>
<li><code>--port=n</code> - expose port (default may vary based on framework, but otherwise is <code>3000</code>)</li>
<li><code>--swap=n</code> - allocate swap space. See <a href="https://man7.org/linux/man-pages/man1/fallocate.1.html#OPTIONS">falloc options</a> for suffixes</li>
<li><code>--windows</code> - make Dockerfile work for Windows users that may have set <code>git config --global core.autocrlf true</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3381"></a>
Add a package/environment variable/build argument:</h2>
<p>Not all of your needs can be determined by scanning your application. For example, I like to add <a href="https://www.vim.org/">vim</a> and <a href="https://packages.debian.org/bullseye/procps">procps</a>.</p>
<ul>
<li><code>--add package...</code> - add one or more debian packages</li>
<li><code>--arg=name:value</code> - add a <a href="https://docs.docker.com/engine/reference/builder/#arg">build argument</a></li>
<li><code>--env=name:value</code> - add an environment variable</li>
<li><code>--remove package...</code> - remove package from "to be added" list</li>
</ul>
<p>Args and environment variables can be tailored to a specific build phase by adding <code>-base</code>, <code>-build</code>, or <code>-deploy</code> after the flag name (e.g <code>--add-build freetds-dev --add-deploy freetds-bin</code>). If no such suffix is found, the default for arg is <code>-base</code>, and the default for env is <code>-deploy</code>. Removal of an arg or environment variable is done by leaving the value blank (e.g <code>--env-build=PORT:</code>).</p>
<h1><a class="anchor" id="autotoc_md3382"></a>
Build secrets</h1>
<p>Techniques such as static site generation using databases may require access to secrets at build time. To enable this you will need to <em>mount</em> the secret:</p>
<ul>
<li><code>--mount-secret=name</code> - add <em>name</em> to the list of secrets to mount when running the build script</li>
<li><code>--unmount-secret-name</code> - remove <em>name</em> from the list of secrets to mount when running the build script</li>
</ul>
<p>See <a href="https://docs.docker.com/engine/reference/commandline/buildx_build/#secret">Secret to expose to the build</a> for examples on how to pass secrets to a docker build.</p>
<h1><a class="anchor" id="autotoc_md3383"></a>
Advanced customization</h1>
<p>There may be times where feature detection plus flags just aren't enough. As an example, you may wish to configure and run multiple processes.</p>
<ul>
<li><code>--instructions=path</code> - a dockerfile fragment to be inserted into the final document.</li>
</ul>
<p>Like with environment variables, packages, and build args, <code>--instructions</code> can be tailored to a specific build phase by adding <code>-base</code>, <code>-build</code>, or <code>-deploy</code> after the flag name, with the default being <code>-deploy</code>.</p>
<h1><a class="anchor" id="autotoc_md3384"></a>
Platform specific processing</h1>
<p>In addition to creating Dockerfiles and associated artifacts, <code>dockerfile-node</code> can run platform specific processing. At the present time the first and only platform taking advantage of this is naturally fly.io.</p>
<p>If, and only if, <code>flyctl</code> is installed, part of the path, and there exists a valid <code>fly.toml</code> file in the current directory, dockerfile-node will:</p>
<ul>
<li>configure and create volume(s) for sqlite3</li>
<li>set swapfile size if that option is selected</li>
<li>attach consul for litefs</li>
<li>set secrets for remix and adonis apps</li>
<li>initialize git</li>
<li>define a staging app if one is mentioned in <code>.github/workflows/deploy.yml</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md3385"></a>
Testing</h1>
<p>A single invocation of <code>npm test</code> will run all of the tests defined. Additionally <code>npm run eslint</code> will run eslint.</p>
<p>The current integration testing strategy is to run the dockerfile generator against various configurations and compare the generated artifacts with expected results. <code>ARG</code> values in <code>Dockerfiles</code> are masked before comparison.</p>
<p>To assist with this process, outputs of tests can be captured automatically. This is useful when adding new tests and when making a change that affects many tests. Be sure to inspect the output (e.g., by using <code>git diff</code>) before committing.</p>
<div class="fragment"><div class="line">npm run test:capture</div>
</div><!-- fragment --><p>To run a single test (or tests maching a pattern), run mocha directly with the <code>grep</code> option.</p>
<div class="fragment"><div class="line">npx mocha --grep swap</div>
</div><!-- fragment --><p>Additionally, each the outputs in each test directory can be directly tested to ensure that they can be successfully built by running docker buildx directory passing in the necessary build arguments. For example:</p>
<div class="fragment"><div class="line">docker buildx build . --build-arg NODE_VERSION=18</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_8ef9539a87167d0e988761f0cb7d76e1.html">@flydotio</a></li><li class="navelem"><a class="el" href="dir_2b84c56a05ebe907fcf81305573419c5.html">dockerfile</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
