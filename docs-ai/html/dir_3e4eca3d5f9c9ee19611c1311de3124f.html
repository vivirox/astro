<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/tinypool Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_3e4eca3d5f9c9ee19611c1311de3124f.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">tinypool Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<blockquote class="doxtable">
<p>Piscina: A fast, efficient Node.js Worker Thread Pool implementation </p>
</blockquote>
<p>Tinypool is a fork of piscina. What we try to achieve in this library, is to eliminate some dependencies and features that our target users don't need (currently, our main user will be Vitest). Tinypool's install size (38KB) can then be smaller than Piscina's install size (6MB). If you need features like <a href="https://github.com/piscinajs/piscina#property-utilization-readonly">utilization</a> or <a href="https://github.com/piscinajs/piscina#thread-priority-on-linux-systems">NAPI</a>, <a href="https://github.com/piscinajs/piscina">Piscina</a> is a better choice for you. We think that Piscina is an amazing library, and we may try to upstream some of the dependencies optimization in this fork.</p>
<ul>
<li>✅ Smaller install size, 38KB</li>
<li>✅ Minimal</li>
<li>✅ No dependencies</li>
<li>✅ Physical cores instead of Logical cores with <a href="https://www.npmjs.com/package/physical-cpu-count">physical-cpu-count</a></li>
<li>✅ Supports <code>worker_threads</code> and <code>child_process</code></li>
<li>❌ No utilization</li>
<li>❌ No NAPI</li>
<li>Written in TypeScript, and ESM support only. For Node.js 18.x and higher.</li>
</ul>
<p><em>In case you need more tiny libraries like tinypool or tinyspy, please consider submitting an <a href="https://github.com/tinylibs/rfcs">RFC</a></em></p>
<h1><a class="anchor" id="autotoc_md32868"></a>
Example</h1>
<h2><a class="anchor" id="autotoc_md32869"></a>
Using <code>node:worker_threads</code></h2>
<h3><a class="anchor" id="autotoc_md32870"></a>
Basic usage</h3>
<div class="fragment"><div class="line">// main.mjs</div>
<div class="line">import Tinypool from &#39;tinypool&#39;</div>
<div class="line"> </div>
<div class="line">const pool = new Tinypool({</div>
<div class="line">  filename: new URL(&#39;./worker.mjs&#39;, import.meta.url).href,</div>
<div class="line">})</div>
<div class="line">const result = await pool.run({ a: 4, b: 6 })</div>
<div class="line">console.log(result) // Prints 10</div>
<div class="line"> </div>
<div class="line">// Make sure to destroy pool once it&#39;s not needed anymore</div>
<div class="line">// This terminates all pool&#39;s idle workers</div>
<div class="line">await pool.destroy()</div>
</div><!-- fragment --><div class="fragment"><div class="line">// worker.mjs</div>
<div class="line">export default ({ a, b }) =&gt; {</div>
<div class="line">  return a + b</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md32871"></a>
Main thread &lt;-&gt; worker thread communication</h3>
<details >
<summary >
See code</summary>
<p></p>
<div class="fragment"><div class="line">// main.mjs</div>
<div class="line">import Tinypool from &#39;tinypool&#39;</div>
<div class="line">import { MessageChannel } from &#39;node:worker_threads&#39;</div>
<div class="line"> </div>
<div class="line">const pool = new Tinypool({</div>
<div class="line">  filename: new URL(&#39;./worker.mjs&#39;, import.meta.url).href,</div>
<div class="line">})</div>
<div class="line">const { port1, port2 } = new MessageChannel()</div>
<div class="line">const promise = pool.run({ port: port1 }, { transferList: [port1] })</div>
<div class="line"> </div>
<div class="line">port2.on(&#39;message&#39;, (message) =&gt; console.log(&#39;Main thread received:&#39;, message))</div>
<div class="line">setTimeout(() =&gt; port2.postMessage(&#39;Hello from main thread!&#39;), 1000)</div>
<div class="line"> </div>
<div class="line">await promise</div>
<div class="line"> </div>
<div class="line">port1.close()</div>
<div class="line">port2.close()</div>
</div><!-- fragment --><div class="fragment"><div class="line">// worker.mjs</div>
<div class="line">export default ({ port }) =&gt; {</div>
<div class="line">  return new Promise((resolve) =&gt; {</div>
<div class="line">    port.on(&#39;message&#39;, (message) =&gt; {</div>
<div class="line">      console.log(&#39;Worker received:&#39;, message)</div>
<div class="line"> </div>
<div class="line">      port.postMessage(&#39;Hello from worker thread!&#39;)</div>
<div class="line">      resolve()</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line">}</div>
</div><!-- fragment --><p></p>
</details>
<h2><a class="anchor" id="autotoc_md32872"></a>
Using <code>node:child_process</code></h2>
<h3><a class="anchor" id="autotoc_md32873"></a>
Basic usage</h3>
<details >
<summary >
See code</summary>
<p></p>
<div class="fragment"><div class="line">// main.mjs</div>
<div class="line">import Tinypool from &#39;tinypool&#39;</div>
<div class="line"> </div>
<div class="line">const pool = new Tinypool({</div>
<div class="line">  runtime: &#39;child_process&#39;,</div>
<div class="line">  filename: new URL(&#39;./worker.mjs&#39;, import.meta.url).href,</div>
<div class="line">})</div>
<div class="line">const result = await pool.run({ a: 4, b: 6 })</div>
<div class="line">console.log(result) // Prints 10</div>
</div><!-- fragment --><div class="fragment"><div class="line">// worker.mjs</div>
<div class="line">export default ({ a, b }) =&gt; {</div>
<div class="line">  return a + b</div>
<div class="line">}</div>
</div><!-- fragment --><p></p>
</details>
<h3><a class="anchor" id="autotoc_md32874"></a>
Main process &lt;-&gt; worker process communication</h3>
<details >
<summary >
See code</summary>
<p></p>
<div class="fragment"><div class="line">// main.mjs</div>
<div class="line">import Tinypool from &#39;tinypool&#39;</div>
<div class="line"> </div>
<div class="line">const pool = new Tinypool({</div>
<div class="line">  runtime: &#39;child_process&#39;,</div>
<div class="line">  filename: new URL(&#39;./worker.mjs&#39;, import.meta.url).href,</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">const messages = []</div>
<div class="line">const listeners = []</div>
<div class="line">const channel = {</div>
<div class="line">  onMessage: (listener) =&gt; listeners.push(listener),</div>
<div class="line">  postMessage: (message) =&gt; messages.push(message),</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const promise = pool.run({}, { channel })</div>
<div class="line"> </div>
<div class="line">// Send message to worker</div>
<div class="line">setTimeout(</div>
<div class="line">  () =&gt; listeners.forEach((listener) =&gt; listener(&#39;Hello from main process&#39;)),</div>
<div class="line">  1000</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">// Wait for task to finish</div>
<div class="line">await promise</div>
<div class="line"> </div>
<div class="line">console.log(messages)</div>
<div class="line">// [{ received: &#39;Hello from main process&#39;, response: &#39;Hello from worker&#39; }]</div>
</div><!-- fragment --><div class="fragment"><div class="line">// worker.mjs</div>
<div class="line">export default async function run() {</div>
<div class="line">  return new Promise((resolve) =&gt; {</div>
<div class="line">    process.on(&#39;message&#39;, (message) =&gt; {</div>
<div class="line">      // Ignore Tinypool&#39;s internal messages</div>
<div class="line">      if (message?.__tinypool_worker_message__) return</div>
<div class="line"> </div>
<div class="line">      process.send({ received: message, response: &#39;Hello from worker&#39; })</div>
<div class="line">      resolve()</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line">}</div>
</div><!-- fragment --><p></p>
</details>
<h1><a class="anchor" id="autotoc_md32875"></a>
API</h1>
<p>We have a similar API to Piscina, so for more information, you can read Piscina's detailed <a href="https://github.com/piscinajs/piscina#piscina---the-nodejs-worker-pool">documentation</a> and apply the same techniques here.</p>
<h2><a class="anchor" id="autotoc_md32876"></a>
Tinypool specific APIs</h2>
<h3><a class="anchor" id="autotoc_md32877"></a>
Pool constructor options</h3>
<ul>
<li><code>isolateWorkers</code>: Disabled by default. Always starts with a fresh worker when running tasks to isolate the environment.</li>
<li><code>terminateTimeout</code>: Disabled by default. If terminating a worker takes <code>terminateTimeout</code> amount of milliseconds to execute, an error is raised.</li>
<li><code>maxMemoryLimitBeforeRecycle</code>: Disabled by default. When defined, the worker's heap memory usage is compared against this value after task has been finished. If the current memory usage exceeds this limit, worker is terminated and a new one is started to take its place. This option is useful when your tasks leak memory and you don't want to enable <code>isolateWorkers</code> option.</li>
<li><code>runtime</code>: Used to pick worker runtime. Default value is <code>worker_threads</code>.<ul>
<li><code>worker_threads</code>: Runs workers in <a href="https://nodejs.org/api/worker_threads.html"><code>node:worker_threads</code></a>. For <code>main thread &lt;-&gt; worker thread</code> communication you can use <a href="https://nodejs.org/api/worker_threads.html#class-messageport"><code>MessagePort</code></a> in the <code>pool.run()</code> method's <a href="https://nodejs.org/api/worker_threads.html#portpostmessagevalue-transferlist"><code>transferList</code> option</a>. See example.</li>
<li><code>child_process</code>: Runs workers in <a href="https://nodejs.org/api/child_process.html"><code>node:child_process</code></a>. For <code>main thread &lt;-&gt; worker process</code> communication you can use <code>TinypoolChannel</code> in the <code>pool.run()</code> method's <code>channel</code> option. For filtering out the Tinypool's internal messages see <code>TinypoolWorkerMessage</code>. See example.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md32878"></a>
Pool methods</h3>
<ul>
<li><code>cancelPendingTasks()</code>: Gracefully cancels all pending tasks without stopping or interfering with on-going tasks. This method is useful when your tasks may have side effects and should not be terminated forcefully during task execution. If your tasks don't have any side effects you may want to use <a href="https://github.com/piscinajs/piscina#cancelable-tasks"><code>{ signal }</code></a> option for forcefully terminating all tasks, including the on-going ones, instead.</li>
<li><code>recycleWorkers(options)</code>: Waits for all current tasks to finish and re-creates all workers. Can be used to force isolation imperatively even when <code>isolateWorkers</code> is disabled. Accepts <code>{ runtime }</code> option as argument.</li>
</ul>
<h3><a class="anchor" id="autotoc_md32879"></a>
Exports</h3>
<ul>
<li><code>workerId</code>: Each worker now has an id ( &lt;= <code>maxThreads</code>) that can be imported from <code>tinypool</code> in the worker itself (or <code>process.__tinypool_state__.workerId</code>).</li>
</ul>
<h1><a class="anchor" id="autotoc_md32880"></a>
Authors</h1>
<p>| <a href="https://github.com/Aslemammad"><img src="https://avatars.githubusercontent.com/u/37929992?v=4" alt="" width="150" class="inline"/><br  />
 Mohammad Bagher </a> | | ---------------------------------------------------------------------------------------------------------------------------------------------&mdash; |</p>
<h1><a class="anchor" id="autotoc_md32881"></a>
Sponsors</h1>
<p>Your sponsorship can make a huge difference in continuing our work in open source!</p>
<p><a href="https://cdn.jsdelivr.net/gh/aslemammad/static/sponsors.svg"><img src="https://cdn.jsdelivr.net/gh/aslemammad/static/sponsors.svg" alt="" style="pointer-events: none;" class="inline"/> </a> </p>
<h1><a class="anchor" id="autotoc_md32882"></a>
Credits</h1>
<p><a href="https://vitest.dev/">The Vitest team</a> for giving me the chance of creating and maintaing this project for vitest.</p>
<p><a href="https://github.com/piscinajs/piscina">Piscina</a>, because Tinypool is not more than a friendly fork of piscina. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_3e4eca3d5f9c9ee19611c1311de3124f.html">tinypool</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
