<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: Test Patterns Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_src_2docs_2api_2test-patterns.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Test Patterns Documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md37041"></a></p>
<p>This document provides comprehensive documentation for test patterns used in the Gradiant platform, including mocking strategies, test fixtures, test organization patterns, integration tests, and performance testing approaches.</p>
<h1><a class="anchor" id="autotoc_md37042"></a>
Table of Contents</h1>
<ul>
<li><a class="el" href="md_node__modules_2safer-buffer_2_porting-_buffer.html#overview">Overview</a></li>
<li>Test Organization</li>
<li>Mocking Strategies</li>
<li>Test Fixtures</li>
<li>Integration Tests</li>
<li>Performance Testing</li>
<li>Best Practices</li>
<li>Troubleshooting</li>
</ul>
<h1><a class="anchor" id="autotoc_md37043"></a>
Overview</h1>
<p>The Gradiant platform uses Vitest as its primary testing framework, replacing the previous Jest implementation. This document outlines the patterns and strategies used for testing different components of the platform.</p>
<h1><a class="anchor" id="autotoc_md37044"></a>
Test Organization</h1>
<h2><a class="anchor" id="autotoc_md37045"></a>
Directory Structure</h2>
<p>Tests are organized in a way that mirrors the source code structure:</p>
<div class="fragment"><div class="line">src/</div>
<div class="line">  components/</div>
<div class="line">    Button/</div>
<div class="line">      Button.tsx</div>
<div class="line">      Button.test.tsx</div>
<div class="line">  services/</div>
<div class="line">    NotificationService.ts</div>
<div class="line">    NotificationService.test.ts</div>
<div class="line">  utils/</div>
<div class="line">    formatters.ts</div>
<div class="line">    formatters.test.ts</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37046"></a>
Test File Naming</h2>
<ul>
<li>Unit tests: <code>*.test.ts</code> or <code>*.test.tsx</code></li>
<li>Integration tests: <code>*.integration.test.ts</code> or <code>*.integration.test.tsx</code></li>
<li>End-to-end tests: <code>*.e2e.test.ts</code> or <code>*.e2e.test.tsx</code></li>
<li>Performance tests: <code>*.perf.test.ts</code> or <code>*.perf.test.tsx</code></li>
</ul>
<h2><a class="anchor" id="autotoc_md37047"></a>
Test Suite Organization</h2>
<p>Tests are organized using the <code>describe</code> and <code>it</code> functions:</p>
<div class="fragment"><div class="line">import { describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { Button } from &#39;./Button&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;Button&#39;, () =&gt; {</div>
<div class="line">  describe(&#39;rendering&#39;, () =&gt; {</div>
<div class="line">    it(&#39;renders correctly with default props&#39;, () =&gt; {</div>
<div class="line">      // Test implementation</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    it(&#39;renders correctly with custom props&#39;, () =&gt; {</div>
<div class="line">      // Test implementation</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  describe(&#39;interactions&#39;, () =&gt; {</div>
<div class="line">    it(&#39;calls onClick when clicked&#39;, () =&gt; {</div>
<div class="line">      // Test implementation</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37048"></a>
Test Categories</h2>
<ol type="1">
<li><b>Unit Tests</b>: Test individual functions, components, or classes in isolation</li>
<li><b>Integration Tests</b>: Test interactions between multiple units</li>
<li><b>End-to-End Tests</b>: Test complete user flows</li>
<li><b>Performance Tests</b>: Test performance characteristics of the application</li>
<li><b>Snapshot Tests</b>: Test UI components for visual regressions</li>
</ol>
<h1><a class="anchor" id="autotoc_md37049"></a>
Mocking Strategies</h1>
<h2><a class="anchor" id="autotoc_md37050"></a>
Function Mocks</h2>
<p>Use Vitest's <code>vi.fn()</code> to create function mocks:</p>
<div class="fragment"><div class="line">import { describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;useUser&#39;, () =&gt; {</div>
<div class="line">  it(&#39;fetches user data&#39;, async () =&gt; {</div>
<div class="line">    const mockFetch = vi.fn().mockResolvedValue({</div>
<div class="line">      json: vi.fn().mockResolvedValue({ id: 1, name: &#39;John Doe&#39; }),</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    global.fetch = mockFetch</div>
<div class="line"> </div>
<div class="line">    const { result } = renderHook(() =&gt; useUser(1))</div>
<div class="line"> </div>
<div class="line">    await waitFor(() =&gt; {</div>
<div class="line">      expect(result.current.data).toEqual({ id: 1, name: &#39;John Doe&#39; })</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    expect(mockFetch).toHaveBeenCalledWith(&#39;/api/users/1&#39;)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37051"></a>
Module Mocks</h2>
<p>Use Vitest's <code>vi.mock()</code> to mock entire modules:</p>
<div class="fragment"><div class="line">import { describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line">import { getUser } from &#39;./userService&#39;</div>
<div class="line"> </div>
<div class="line">vi.mock(&#39;./api&#39;, () =&gt; ({</div>
<div class="line">  fetchUser: vi.fn().mockResolvedValue({ id: 1, name: &#39;John Doe&#39; }),</div>
<div class="line">}))</div>
<div class="line"> </div>
<div class="line">describe(&#39;userService&#39;, () =&gt; {</div>
<div class="line">  it(&#39;returns user data&#39;, async () =&gt; {</div>
<div class="line">    const user = await getUser(1)</div>
<div class="line">    expect(user).toEqual({ id: 1, name: &#39;John Doe&#39; })</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37052"></a>
Partial Mocks</h2>
<p>Use Vitest's <code>vi.mock()</code> with <code>vi.importActual()</code> to partially mock modules:</p>
<div class="fragment"><div class="line">import { describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">vi.mock(&#39;./utils&#39;, async (importOriginal) =&gt; {</div>
<div class="line">  const actual = await importOriginal()</div>
<div class="line">  return {</div>
<div class="line">    ...actual,</div>
<div class="line">    formatDate: vi.fn().mockReturnValue(&#39;2023-01-01&#39;),</div>
<div class="line">  }</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37053"></a>
Timer Mocks</h2>
<p>Use Vitest's <code>vi.useFakeTimers()</code> to mock timers:</p>
<div class="fragment"><div class="line">import { afterEach, beforeEach, describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line">import { debounce } from &#39;./utils&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;debounce&#39;, () =&gt; {</div>
<div class="line">  beforeEach(() =&gt; {</div>
<div class="line">    vi.useFakeTimers()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  afterEach(() =&gt; {</div>
<div class="line">    vi.restoreAllMocks()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;debounces function calls&#39;, () =&gt; {</div>
<div class="line">    const fn = vi.fn()</div>
<div class="line">    const debouncedFn = debounce(fn, 1000)</div>
<div class="line"> </div>
<div class="line">    debouncedFn()</div>
<div class="line">    debouncedFn()</div>
<div class="line">    debouncedFn()</div>
<div class="line"> </div>
<div class="line">    expect(fn).not.toHaveBeenCalled()</div>
<div class="line"> </div>
<div class="line">    vi.advanceTimersByTime(1000)</div>
<div class="line"> </div>
<div class="line">    expect(fn).toHaveBeenCalledTimes(1)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37054"></a>
Mock Implementations</h2>
<p>Use <code>mockImplementation()</code> to provide custom mock implementations:</p>
<div class="fragment"><div class="line">import { describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;useAuth&#39;, () =&gt; {</div>
<div class="line">  it(&#39;handles login success&#39;, async () =&gt; {</div>
<div class="line">    const mockLogin = vi.fn().mockImplementation((email, password) =&gt; {</div>
<div class="line">      if (email === &#39;test@example.com&#39; &amp;&amp; password === &#39;password&#39;) {</div>
<div class="line">        return Promise.resolve({ token: &#39;abc123&#39; })</div>
<div class="line">      }</div>
<div class="line">      return Promise.reject(new Error(&#39;Invalid credentials&#39;))</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    // Test implementation</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37055"></a>
Test Fixtures</h1>
<h2><a class="anchor" id="autotoc_md37056"></a>
Factory Functions</h2>
<p>Use factory functions to create test fixtures:</p>
<div class="fragment"><div class="line">// factories/user.ts</div>
<div class="line">// user.test.ts</div>
<div class="line">import { createUser } from &#39;./factories/user&#39;</div>
<div class="line"> </div>
<div class="line">export function createUser(overrides = {}) {</div>
<div class="line">  return {</div>
<div class="line">    id: 1,</div>
<div class="line">    name: &#39;John Doe&#39;,</div>
<div class="line">    email: &#39;john@example.com&#39;,</div>
<div class="line">    role: &#39;user&#39;,</div>
<div class="line">    ...overrides,</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">describe(&#39;User&#39;, () =&gt; {</div>
<div class="line">  it(&#39;renders user information&#39;, () =&gt; {</div>
<div class="line">    const user = createUser({ name: &#39;Jane Doe&#39; })</div>
<div class="line">    // Test implementation using the user fixture</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37057"></a>
Test Data Files</h2>
<p>Store complex test data in separate files:</p>
<div class="fragment"><div class="line">// fixtures/users.json</div>
<div class="line">// users.test.ts</div>
<div class="line">import users from &#39;./fixtures/users.json&#39;;</div>
<div class="line"> </div>
<div class="line">[</div>
<div class="line">  {</div>
<div class="line">    id: 1,</div>
<div class="line">    name: &#39;John Doe&#39;,</div>
<div class="line">    email: &#39;john@example.com&#39;,</div>
<div class="line">    role: &#39;user&#39;,</div>
<div class="line">  },</div>
<div class="line">  {</div>
<div class="line">    id: 2,</div>
<div class="line">    name: &#39;Jane Doe&#39;,</div>
<div class="line">    email: &#39;jane@example.com&#39;,</div>
<div class="line">    role: &#39;admin&#39;,</div>
<div class="line">  },</div>
<div class="line">]</div>
<div class="line"> </div>
<div class="line">describe(&#39;UserList&#39;, () =&gt; {</div>
<div class="line">  it(&#39;renders a list of users&#39;, () =&gt; {</div>
<div class="line">    // Test implementation using the users fixture</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37058"></a>
Setup and Teardown</h2>
<p>Use <code>beforeEach</code> and <code>afterEach</code> for setup and teardown:</p>
<div class="fragment"><div class="line">import { afterEach, beforeEach, describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { createTestDatabase } from &#39;./testUtils&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;UserRepository&#39;, () =&gt; {</div>
<div class="line">  let db</div>
<div class="line"> </div>
<div class="line">  beforeEach(async () =&gt; {</div>
<div class="line">    db = await createTestDatabase()</div>
<div class="line">    await db.migrate()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  afterEach(async () =&gt; {</div>
<div class="line">    await db.destroy()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;creates a user&#39;, async () =&gt; {</div>
<div class="line">    // Test implementation using the database</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37059"></a>
Shared Fixtures</h2>
<p>Use shared fixtures for common test data:</p>
<div class="fragment"><div class="line">// fixtures/shared.ts</div>
<div class="line">import { vi } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">// service.test.ts</div>
<div class="line">import { mockConfig, mockLogger } from &#39;./fixtures/shared&#39;</div>
<div class="line"> </div>
<div class="line">export const mockLogger = {</div>
<div class="line">  info: vi.fn(),</div>
<div class="line">  warn: vi.fn(),</div>
<div class="line">  error: vi.fn(),</div>
<div class="line">  debug: vi.fn(),</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">export const mockConfig = {</div>
<div class="line">  apiUrl: &#39;https://api.example.com&#39;,</div>
<div class="line">  timeout: 5000,</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">describe(&#39;Service&#39;, () =&gt; {</div>
<div class="line">  it(&#39;logs information&#39;, () =&gt; {</div>
<div class="line">    const service = new Service(mockLogger, mockConfig)</div>
<div class="line">    service.doSomething()</div>
<div class="line">    expect(mockLogger.info).toHaveBeenCalled()</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37060"></a>
Integration Tests</h1>
<h2><a class="anchor" id="autotoc_md37061"></a>
API Integration Tests</h2>
<p>Test API endpoints with mock servers:</p>
<div class="fragment"><div class="line">import { afterAll, beforeAll, describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { createServer } from &#39;./testUtils&#39;</div>
<div class="line">import { getUser } from &#39;./userService&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;userService&#39;, () =&gt; {</div>
<div class="line">  let server</div>
<div class="line"> </div>
<div class="line">  beforeAll(() =&gt; {</div>
<div class="line">    server = createServer()</div>
<div class="line">    server.get(&#39;/api/users/:id&#39;, (req, rest) =&gt; {</div>
<div class="line">      rest.json({ id: req.params.id, name: &#39;John Doe&#39; })</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  afterAll(() =&gt; {</div>
<div class="line">    server.close()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;fetches user data from the API&#39;, async () =&gt; {</div>
<div class="line">    const user = await getUser(1)</div>
<div class="line">    expect(user).toEqual({ id: &#39;1&#39;, name: &#39;John Doe&#39; })</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37062"></a>
Component Integration Tests</h2>
<p>Test component interactions:</p>
<div class="fragment"><div class="line">import { describe, it, expect } from &#39;vitest&#39;;</div>
<div class="line">import { render, screen, fireEvent } from &#39;@testing-library/react&#39;;</div>
<div class="line">import { UserForm } from &#39;./UserForm&#39;;</div>
<div class="line">import { UserContext } from &#39;./UserContext&#39;;</div>
<div class="line"> </div>
<div class="line">describe(&#39;UserForm&#39;, () =&gt; {</div>
<div class="line">  it(&#39;submits user data to the context&#39;, () =&gt; {</div>
<div class="line">    const createUser = vi.fn();</div>
<div class="line"> </div>
<div class="line">    render(</div>
<div class="line">      &lt;UserContext.Provider value={{ createUser }}&gt;</div>
<div class="line">        &lt;UserForm /&gt;</div>
<div class="line">      &lt;/UserContext.Provider&gt;</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    fireEvent.change(screen.getByLabelText(&#39;Name&#39;), {</div>
<div class="line">      target: { value: &#39;John Doe&#39; },</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    fireEvent.change(screen.getByLabelText(&#39;Email&#39;), {</div>
<div class="line">      target: { value: &#39;john@example.com&#39; },</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line">    fireEvent.click(screen.getByText(&#39;Submit&#39;));</div>
<div class="line"> </div>
<div class="line">    expect(createUser).toHaveBeenCalledWith({</div>
<div class="line">      name: &#39;John Doe&#39;,</div>
<div class="line">      email: &#39;john@example.com&#39;,</div>
<div class="line">    });</div>
<div class="line">  });</div>
<div class="line">});</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37063"></a>
Database Integration Tests</h2>
<p>Test database interactions:</p>
<div class="fragment"><div class="line">import { afterEach, beforeEach, describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { createTestDatabase } from &#39;./testUtils&#39;</div>
<div class="line">import { UserRepository } from &#39;./UserRepository&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;UserRepository&#39;, () =&gt; {</div>
<div class="line">  let db</div>
<div class="line">  let repository</div>
<div class="line"> </div>
<div class="line">  beforeEach(async () =&gt; {</div>
<div class="line">    db = await createTestDatabase()</div>
<div class="line">    await db.migrate()</div>
<div class="line">    repository = new UserRepository(db)</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  afterEach(async () =&gt; {</div>
<div class="line">    await db.destroy()</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;creates and retrieves a user&#39;, async () =&gt; {</div>
<div class="line">    const user = { name: &#39;John Doe&#39;, email: &#39;john@example.com&#39; }</div>
<div class="line">    const id = await repository.create(user)</div>
<div class="line">    const retrievedUser = await repository.getById(id)</div>
<div class="line"> </div>
<div class="line">    expect(retrievedUser).toEqual({ id, ...user })</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37064"></a>
Performance Testing</h1>
<h2><a class="anchor" id="autotoc_md37065"></a>
Benchmarking</h2>
<p>Use Vitest's <code>bench</code> function for benchmarking:</p>
<div class="fragment"><div class="line">import { bench, describe } from &#39;vitest&#39;</div>
<div class="line">import { mergeSort, quickSort, sortArray } from &#39;./sorting&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;Sorting Algorithms&#39;, () =&gt; {</div>
<div class="line">  const array = Array.from({ length: 1000 }, () =&gt; Math.random() * 1000)</div>
<div class="line"> </div>
<div class="line">  bench(&#39;Native sort&#39;, () =&gt; {</div>
<div class="line">    sortArray(array)</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  bench(&#39;Quick sort&#39;, () =&gt; {</div>
<div class="line">    quickSort(array)</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  bench(&#39;Merge sort&#39;, () =&gt; {</div>
<div class="line">    mergeSort(array)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37066"></a>
Memory Usage Testing</h2>
<p>Test memory usage with the <code>memoryUsage</code> utility:</p>
<div class="fragment"><div class="line">import { describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { processLargeData } from &#39;./dataProcessor&#39;</div>
<div class="line">import { memoryUsage } from &#39;./testUtils&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;dataProcessor&#39;, () =&gt; {</div>
<div class="line">  it(&#39;processes data efficiently&#39;, async () =&gt; {</div>
<div class="line">    const data = Array.from({ length: 10000 }, (_, i) =&gt; ({ id: i, value: `Value ${i}` }))</div>
<div class="line"> </div>
<div class="line">    const { heapUsed } = await memoryUsage(() =&gt; {</div>
<div class="line">      processLargeData(data)</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    expect(heapUsed).toBeLessThan(10 * 1024 * 1024) // Less than 10MB</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37067"></a>
Load Testing</h2>
<p>Test performance under load:</p>
<div class="fragment"><div class="line">import { describe, expect, it } from &#39;vitest&#39;</div>
<div class="line">import { CacheService } from &#39;./CacheService&#39;</div>
<div class="line">import { createLoadTest } from &#39;./testUtils&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;CacheService&#39;, () =&gt; {</div>
<div class="line">  it(&#39;handles concurrent requests efficiently&#39;, async () =&gt; {</div>
<div class="line">    const cache = new CacheService()</div>
<div class="line"> </div>
<div class="line">    const results = await createLoadTest({</div>
<div class="line">      concurrency: 100,</div>
<div class="line">      iterations: 1000,</div>
<div class="line">      fn: async (i) =&gt; {</div>
<div class="line">        const key = `key-${i % 10}`</div>
<div class="line">        const value = `value-${i}`</div>
<div class="line"> </div>
<div class="line">        await cache.set(key, value)</div>
<div class="line">        return await cache.get(key)</div>
<div class="line">      },</div>
<div class="line">    })</div>
<div class="line"> </div>
<div class="line">    expect(results.successRate).toBeGreaterThan(0.99) // 99% success rate</div>
<div class="line">    expect(results.averageResponseTime).toBeLessThan(5) // Less than 5ms</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md37068"></a>
Circuit Breaker Testing</h2>
<p>Test circuit breaker behavior:</p>
<div class="fragment"><div class="line">import { beforeEach, describe, expect, it, vi } from &#39;vitest&#39;</div>
<div class="line">import { CircuitBreaker } from &#39;./CircuitBreaker&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;CircuitBreaker&#39;, () =&gt; {</div>
<div class="line">  let circuitBreaker</div>
<div class="line">  let mockFn</div>
<div class="line"> </div>
<div class="line">  beforeEach(() =&gt; {</div>
<div class="line">    mockFn = vi.fn()</div>
<div class="line">    circuitBreaker = new CircuitBreaker({</div>
<div class="line">      failureThreshold: 3,</div>
<div class="line">      resetTimeout: 1000,</div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;opens the circuit after consecutive failures&#39;, async () =&gt; {</div>
<div class="line">    mockFn</div>
<div class="line">      .mockRejectedValueOnce(new Error(&#39;Failure 1&#39;))</div>
<div class="line">      .mockRejectedValueOnce(new Error(&#39;Failure 2&#39;))</div>
<div class="line">      .mockRejectedValueOnce(new Error(&#39;Failure 3&#39;))</div>
<div class="line"> </div>
<div class="line">    try {</div>
<div class="line">      await circuitBreaker.execute(mockFn)</div>
<div class="line">    }</div>
<div class="line">    catch (e) {}</div>
<div class="line">    try {</div>
<div class="line">      await circuitBreaker.execute(mockFn)</div>
<div class="line">    }</div>
<div class="line">    catch (e) {}</div>
<div class="line">    try {</div>
<div class="line">      await circuitBreaker.execute(mockFn)</div>
<div class="line">    }</div>
<div class="line">    catch (e) {}</div>
<div class="line"> </div>
<div class="line">    expect(circuitBreaker.isOpen()).toBe(true)</div>
<div class="line"> </div>
<div class="line">    mockFn.mockResolvedValueOnce(&#39;Success&#39;)</div>
<div class="line"> </div>
<div class="line">    await expect(circuitBreaker.execute(mockFn)).rejects.toThrow(&#39;Circuit is open&#39;)</div>
<div class="line">    expect(mockFn).toHaveBeenCalledTimes(3)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md37069"></a>
Best Practices</h1>
<h2><a class="anchor" id="autotoc_md37070"></a>
Test Isolation</h2>
<p>Ensure tests are isolated from each other:</p>
<ul>
<li>Reset mocks between tests</li>
<li>Use fresh fixtures for each test</li>
<li>Avoid shared state between tests</li>
</ul>
<h2><a class="anchor" id="autotoc_md37071"></a>
Test Coverage</h2>
<p>Aim for high test coverage:</p>
<ul>
<li>100% coverage for critical paths</li>
<li>80% coverage for business logic</li>
<li>60% coverage for UI components</li>
</ul>
<h2><a class="anchor" id="autotoc_md37072"></a>
Test Readability</h2>
<p>Write readable tests:</p>
<ul>
<li>Use descriptive test names</li>
<li>Follow the Arrange-Act-Assert pattern</li>
<li>Keep tests small and focused</li>
</ul>
<h2><a class="anchor" id="autotoc_md37073"></a>
Test Maintainability</h2>
<p>Write maintainable tests:</p>
<ul>
<li>Avoid testing implementation details</li>
<li>Use abstractions for complex setup</li>
<li>Keep test code DRY (Don't Repeat Yourself)</li>
</ul>
<h2><a class="anchor" id="autotoc_md37074"></a>
Test Performance</h2>
<p>Optimize test performance:</p>
<ul>
<li>Mock external dependencies</li>
<li>Use fast test runners</li>
<li>Parallelize tests when possible</li>
</ul>
<h1><a class="anchor" id="autotoc_md37075"></a>
Troubleshooting</h1>
<h2><a class="anchor" id="autotoc_md37076"></a>
Common Issues</h2>
<h3><a class="anchor" id="autotoc_md37077"></a>
Tests Failing Intermittently</h3>
<ul>
<li>Check for race conditions</li>
<li>Ensure proper cleanup between tests</li>
<li>Verify that mocks are reset properly</li>
</ul>
<h3><a class="anchor" id="autotoc_md37078"></a>
Slow Tests</h3>
<ul>
<li>Identify slow tests with <code>--slowTestThreshold</code></li>
<li>Mock expensive operations</li>
<li>Use faster alternatives for test setup</li>
</ul>
<h3><a class="anchor" id="autotoc_md37079"></a>
Memory Leaks</h3>
<ul>
<li>Check for unclosed connections</li>
<li>Verify that event listeners are removed</li>
<li>Use memory profiling tools</li>
</ul>
<h2><a class="anchor" id="autotoc_md37080"></a>
Debugging Tests</h2>
<h3><a class="anchor" id="autotoc_md37081"></a>
Using the Debugger</h3>
<div class="fragment"><div class="line">import { describe, expect, it } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;debugging&#39;, () =&gt; {</div>
<div class="line">  it(&#39;can be debugged&#39;, () =&gt; {</div>
<div class="line">    const value = 1 + 1</div>
<div class="line">    debugger // This will pause execution in the debugger</div>
<div class="line">    expect(value).toBe(2)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md37082"></a>
Using Console Logs</h3>
<div class="fragment"><div class="line">import { describe, expect, it } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;debugging&#39;, () =&gt; {</div>
<div class="line">  it(&#39;can be debugged with console.log&#39;, () =&gt; {</div>
<div class="line">    const value = complexCalculation()</div>
<div class="line">    console.log(&#39;Value:&#39;, value)</div>
<div class="line">    expect(value).toBe(42)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md37083"></a>
Using Test Hooks</h3>
<div class="fragment"><div class="line">import { beforeEach, describe, expect, it } from &#39;vitest&#39;</div>
<div class="line"> </div>
<div class="line">describe(&#39;debugging&#39;, () =&gt; {</div>
<div class="line">  beforeEach(() =&gt; {</div>
<div class="line">    console.log(&#39;Test starting&#39;)</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">  it(&#39;logs before and after&#39;, () =&gt; {</div>
<div class="line">    console.log(&#39;Test running&#39;)</div>
<div class="line">    expect(1 + 1).toBe(2)</div>
<div class="line">    console.log(&#39;Test completed&#39;)</div>
<div class="line">  })</div>
<div class="line">})</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
