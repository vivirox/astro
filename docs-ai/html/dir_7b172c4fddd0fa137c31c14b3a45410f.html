<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/resolve-pkg-maps Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_7b172c4fddd0fa137c31c14b3a45410f.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">resolve-pkg-maps Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Utils to resolve <code>package.json</code> subpath &amp; conditional <a href="https://nodejs.org/api/packages.html#exports"><code>exports</code></a>/<a href="https://nodejs.org/api/packages.html#imports"><code>imports</code></a> in resolvers.</p>
<p>Implements the <a href="https://nodejs.org/api/esm.html#resolver-algorithm-specification">ESM resolution algorithm</a>. Tested <a href="/tests/">against Node.js</a> for accuracy.</p>
<p><sub>Support this project by ⭐️ starring and sharing it. <a href="https://github.com/privatenumber">Follow me</a> to see what other cool projects I'm working on! ❤️</sub></p>
<h1><a class="anchor" id="autotoc_md29389"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md29390"></a>
Resolving <code>exports</code></h2>
<p><em>utils/package.json</em> </p><div class="fragment"><div class="line">{</div>
<div class="line">    // ...</div>
<div class="line">    &quot;exports&quot;: {</div>
<div class="line">        &quot;./reverse&quot;: {</div>
<div class="line">            &quot;require&quot;: &quot;./file.cjs&quot;,</div>
<div class="line">            &quot;default&quot;: &quot;./file.mjs&quot;</div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">    // ...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">import { resolveExports } from &#39;resolve-pkg-maps&#39;</div>
<div class="line"> </div>
<div class="line">const [packageName, packageSubpath] = parseRequest(&#39;utils/reverse&#39;)</div>
<div class="line"> </div>
<div class="line">const resolvedPaths: string[] = resolveExports(</div>
<div class="line">    getPackageJson(packageName).exports,</div>
<div class="line">    packageSubpath,</div>
<div class="line">    [&#39;import&#39;, ...otherConditions]</div>
<div class="line">)</div>
<div class="line">// =&gt; [&#39;./file.mjs&#39;]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29391"></a>
Resolving <code>imports</code></h2>
<p><em>package.json</em> </p><div class="fragment"><div class="line">{</div>
<div class="line">    // ...</div>
<div class="line">    &quot;imports&quot;: {</div>
<div class="line">        &quot;#supports-color&quot;: {</div>
<div class="line">            &quot;node&quot;: &quot;./index.js&quot;,</div>
<div class="line">            &quot;default&quot;: &quot;./browser.js&quot;</div>
<div class="line">        }</div>
<div class="line">    },</div>
<div class="line">    // ...</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line">import { resolveImports } from &#39;resolve-pkg-maps&#39;</div>
<div class="line"> </div>
<div class="line">const resolvedPaths: string[] = resolveImports(</div>
<div class="line">    getPackageJson(&#39;.&#39;).imports,</div>
<div class="line">    &#39;#supports-color&#39;,</div>
<div class="line">    [&#39;node&#39;, ...otherConditions]</div>
<div class="line">)</div>
<div class="line">// =&gt; [&#39;./index.js&#39;]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md29392"></a>
API</h1>
<h2><a class="anchor" id="autotoc_md29393"></a>
resolveExports(exports, request, conditions)</h2>
<p>Returns: <code>string[]</code></p>
<p>Resolves the <code>request</code> based on <code>exports</code> and <code>conditions</code>. Returns an array of paths (e.g. in case a fallback array is matched).</p>
<h3><a class="anchor" id="autotoc_md29394"></a>
exports</h3>
<p>Type: </p><div class="fragment"><div class="line">type Exports = PathOrMap | readonly PathOrMap[]</div>
<div class="line"> </div>
<div class="line">type PathOrMap = string | PathConditionsMap</div>
<div class="line"> </div>
<div class="line">type PathConditionsMap = {</div>
<div class="line">    [condition: string]: PathConditions | null</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <a href="https://nodejs.org/api/packages.html#exports"><code>exports</code> property</a> value in <code>package.json</code>.</p>
<h3><a class="anchor" id="autotoc_md29395"></a>
request</h3>
<p>Type: <code>string</code></p>
<p>The package subpath to resolve. Assumes a normalized path is passed in (eg. <a href="https://github.com/nodejs/node/issues/44316">repeating slashes <code>//</code></a>).</p>
<p>It <em>should not</em> start with <code>/</code> or <code>./</code>.</p>
<p>Example: if the full import path is <code>some-package/subpath/file</code>, the request is <code>subpath/file</code>.</p>
<h3><a class="anchor" id="autotoc_md29396"></a>
conditions</h3>
<p>Type: <code>readonly string[]</code></p>
<p>An array of conditions to use when resolving the request. For reference, Node.js's default conditions are <a href="https://nodejs.org/api/esm.html#:~:text=defaultConditions%20is%20the%20conditional%20environment%20name%20array%2C%20%5B%22node%22%2C%20%22import%22%5D.">&lsquo;['node&rsquo;, 'import']`</a>.</p>
<p>The order of this array does not matter; the order of condition keys in the export map is what matters instead.</p>
<p>Not all conditions in the array need to be met to resolve the request. It just needs enough to resolve to a path.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md29398"></a>
resolveImports(imports, request, conditions)</h2>
<p>Returns: <code>string[]</code></p>
<p>Resolves the <code>request</code> based on <code>imports</code> and <code>conditions</code>. Returns an array of paths (e.g. in case a fallback array is matched).</p>
<h3><a class="anchor" id="autotoc_md29399"></a>
imports</h3>
<p>Type: </p><div class="fragment"><div class="line">type Imports = {</div>
<div class="line">    [condition: string]: PathOrMap | readonly PathOrMap[] | null</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">type PathOrMap = string | Imports</div>
</div><!-- fragment --><p>The <a href="https://nodejs.org/api/packages.html#imports"><code>imports</code> property</a> value in <code>package.json</code>.</p>
<h3><a class="anchor" id="autotoc_md29400"></a>
request</h3>
<p>Type: <code>string</code></p>
<p>The request resolve. Assumes a normalized path is passed in (eg. <a href="https://github.com/nodejs/node/issues/44316">repeating slashes <code>//</code></a>).</p>
<blockquote class="doxtable">
<p><b>Note:</b> In Node.js, imports resolutions are limited to requests prefixed with <code>#</code>. However, this package does not enforce that requirement in case you want to add custom support for non-prefixed entries. </p>
</blockquote>
<h3><a class="anchor" id="autotoc_md29401"></a>
conditions</h3>
<p>Type: <code>readonly string[]</code></p>
<p>An array of conditions to use when resolving the request. For reference, Node.js's default conditions are <a href="https://nodejs.org/api/esm.html#:~:text=defaultConditions%20is%20the%20conditional%20environment%20name%20array%2C%20%5B%22node%22%2C%20%22import%22%5D.">&lsquo;['node&rsquo;, 'import']`</a>.</p>
<p>The order of this array does not matter; the order of condition keys in the import map is what matters instead.</p>
<p>Not all conditions in the array need to be met to resolve the request. It just needs enough to resolve to a path.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md29403"></a>
Errors</h2>
<h3><a class="anchor" id="autotoc_md29404"></a>
<code>ERR_PACKAGE_PATH_NOT_EXPORTED</code></h3>
<ul>
<li>If the request is not exported by the export map</li>
</ul>
<h3><a class="anchor" id="autotoc_md29405"></a>
<code>ERR_PACKAGE_IMPORT_NOT_DEFINED</code></h3>
<ul>
<li>If the request is not defined by the import map</li>
</ul>
<h3><a class="anchor" id="autotoc_md29406"></a>
<code>ERR_INVALID_PACKAGE_CONFIG</code></h3>
<ul>
<li>If an object contains properties that are both paths and conditions (e.g. start with and without <code>.</code>)</li>
<li>If an object contains numeric properties</li>
</ul>
<h3><a class="anchor" id="autotoc_md29407"></a>
<code>ERR_INVALID_PACKAGE_TARGET</code></h3>
<ul>
<li>If a resolved exports path is not a valid path (e.g. not relative or has protocol)</li>
<li>If a resolved path includes <code>..</code> or <code>node_modules</code></li>
<li>If a resolved path is a type that cannot be parsed</li>
</ul>
<h1><a class="anchor" id="autotoc_md29408"></a>
FAQ</h1>
<h2><a class="anchor" id="autotoc_md29409"></a>
Why do the APIs return an array of paths?</h2>
<p><code>exports</code>/<code>imports</code> supports passing in a <a href="https://github.com/jkrems/proposal-pkg-exports/#:~:text=Whenever%20there%20is,to%20new%20cases.">fallback array</a> to provide fallback paths if the previous one is invalid:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;exports&quot;: {</div>
<div class="line">        &quot;./feature&quot;: [</div>
<div class="line">            &quot;./file.js&quot;,</div>
<div class="line">            &quot;./fallback.js&quot;</div>
<div class="line">        ]</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Node.js's implementation <a href="https://github.com/nodejs/node/issues/44282#issuecomment-1220151715">picks the first valid path (without attempting to resolve it)</a> and throws an error if it can't be resolved. Node.js's fallback array is designed for <a href="https://github.com/jkrems/proposal-pkg-exports/#:~:text=providing%20forwards%20compatiblitiy%20for%20new%20features">forward compatibility with features</a> (e.g. protocols) that can be immediately/inexpensively validated:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;exports&quot;: {</div>
<div class="line">        &quot;./core-polyfill&quot;: [&quot;std:core-module&quot;, &quot;./core-polyfill.js&quot;]</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>However, <a href="https://webpack.js.org/guides/package-exports/#alternatives">Webpack</a> and <a href="https://github.com/microsoft/TypeScript/blob/71e852922888337ef51a0e48416034a94a6c34d9/src/compiler/moduleSpecifiers.ts#L695">TypeScript</a> have deviated from this behavior and attempts to resolve the next path if a path cannot be resolved.</p>
<p>By returning an array of matched paths instead of just the first one, the user can decide which behavior to adopt.</p>
<h2><a class="anchor" id="autotoc_md29410"></a>
How is it different from <a href="https://github.com/lukeed/resolve.exports"><code>resolve.exports</code></a>?</h2>
<p><code>resolve.exports</code> only resolves <code>exports</code>, whereas this package resolves both <code>exports</code> &amp; <code>imports</code>. This comparison will only cover resolving <code>exports</code>.</p>
<ul>
<li>Despite it's name, <code>resolve.exports</code> handles more than just <code>exports</code>. It takes in the entire <code>package.json</code> object to handle resolving <code>.</code> and <a href="https://nodejs.org/api/packages.html#self-referencing-a-package-using-its-name">self-references</a>. This package only accepts <code>exports</code>/<code>imports</code> maps from <code>package.json</code> and is scoped to only resolving what's defined in the maps.</li>
<li><code>resolve.exports</code> accepts the full request (e.g. <code>foo/bar</code>), whereas this package only accepts the requested subpath (e.g. <code>bar</code>).</li>
<li><code>resolve.exports</code> only returns the first result in a fallback array. This package returns an array of results for the user to decide how to handle it.</li>
<li><code>resolve.exports</code> supports <a href="https://nodejs.org/docs/latest-v16.x/api/packages.html#subpath-folder-mappings">subpath folder mapping</a> (deprecated in Node.js v16 &amp; removed in v17) but seems to <a href="https://github.com/lukeed/resolve.exports/issues/7">have a bug</a>. This package does not support subpath folder mapping because Node.js has removed it in favor of using subpath patterns.</li>
<li>Neither resolvers rely on a file-system</li>
</ul>
<p>This package also addresses many of the bugs in <code>resolve.exports</code>, demonstrated in <a href="/tests/exports/compare-resolve.exports.ts">this test</a>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_7b172c4fddd0fa137c31c14b3a45410f.html">resolve-pkg-maps</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
