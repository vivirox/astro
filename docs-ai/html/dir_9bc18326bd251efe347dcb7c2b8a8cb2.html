<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/file-entry-cache Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_9bc18326bd251efe347dcb7c2b8a8cb2.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">file-entry-cache Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<blockquote class="doxtable">
<p>Super simple cache for file metadata, useful for process that work on a given series of files and that only need to repeat the job on the changed ones since the previous run of the process â€” Edit </p>
</blockquote>
<p><a href="https://npmjs.org/package/file-entry-cache"><img src="https://img.shields.io/npm/v/file-entry-cache.svg?style=flat" alt="NPM Version" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/jaredwray/file-entry-cache/actions/workflows/tests.yaml"><img src="https://github.com/jaredwray/file-entry-cache/actions/workflows/tests.yaml/badge.svg?branch=master" alt="tests" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/github/jaredwray/file-entry-cache"><img src="https://codecov.io/github/jaredwray/file-entry-cache/graph/badge.svg?token=37tZMQE0Sy" alt="codecov" style="pointer-events: none;" class="inline"/></a> <a href="https://npmjs.com/package/file-entry-cache"><img src="https://img.shields.io/npm/dm/file-entry-cache" alt="npm" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md15437"></a>
install</h1>
<div class="fragment"><div class="line">npm i --save file-entry-cache</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15438"></a>
Usage</h1>
<p>The module exposes two functions <code>create</code> and <code>createFromFile</code>.</p>
<h1><a class="anchor" id="autotoc_md15439"></a>
<code>create(cacheName, [directory, useCheckSum])</code></h1>
<ul>
<li><b>cacheName</b>: the name of the cache to be created</li>
<li><b>directory</b>: Optional the directory to load the cache from</li>
<li><b>usecheckSum</b>: Whether to use md5 checksum to verify if file changed. If false the default will be to use the mtime and size of the file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md15440"></a>
<code>createFromFile(pathToCache, [useCheckSum])</code></h1>
<ul>
<li><b>pathToCache</b>: the path to the cache file (this combines the cache name and directory)</li>
<li><b>useCheckSum</b>: Whether to use md5 checksum to verify if file changed. If false the default will be to use the mtime and size of the file.</li>
</ul>
<div class="fragment"><div class="line">// loads the cache, if one does not exists for the given</div>
<div class="line">// Id a new one will be prepared to be created</div>
<div class="line">var fileEntryCache = require(&#39;file-entry-cache&#39;);</div>
<div class="line"> </div>
<div class="line">var cache = fileEntryCache.create(&#39;testCache&#39;);</div>
<div class="line"> </div>
<div class="line">var files = expand(&#39;../fixtures/*.txt&#39;);</div>
<div class="line"> </div>
<div class="line">// the first time this method is called, will return all the files</div>
<div class="line">var oFiles = cache.getUpdatedFiles(files);</div>
<div class="line"> </div>
<div class="line">// this will persist this to disk checking each file stats and</div>
<div class="line">// updating the meta attributes `size` and `mtime`.</div>
<div class="line">// custom fields could also be added to the meta object and will be persisted</div>
<div class="line">// in order to retrieve them later</div>
<div class="line">cache.reconcile();</div>
<div class="line"> </div>
<div class="line">// use this if you want the non visited file entries to be kept in the cache</div>
<div class="line">// for more than one execution</div>
<div class="line">//</div>
<div class="line">// cache.reconcile( true /* noPrune */)</div>
<div class="line"> </div>
<div class="line">// on a second run</div>
<div class="line">var cache2 = fileEntryCache.create(&#39;testCache&#39;);</div>
<div class="line"> </div>
<div class="line">// will return now only the files that were modified or none</div>
<div class="line">// if no files were modified previous to the execution of this function</div>
<div class="line">var oFiles = cache.getUpdatedFiles(files);</div>
<div class="line"> </div>
<div class="line">// if you want to prevent a file from being considered non modified</div>
<div class="line">// something useful if a file failed some sort of validation</div>
<div class="line">// you can then remove the entry from the cache doing</div>
<div class="line">cache.removeEntry(&#39;path/to/file&#39;); // path to file should be the same path of the file received on `getUpdatedFiles`</div>
<div class="line">// that will effectively make the file to appear again as modified until the validation is passed. In that</div>
<div class="line">// case you should not remove it from the cache</div>
<div class="line"> </div>
<div class="line">// if you need all the files, so you can determine what to do with the changed ones</div>
<div class="line">// you can call</div>
<div class="line">var oFiles = cache.normalizeEntries(files);</div>
<div class="line"> </div>
<div class="line">// oFiles will be an array of objects like the following</div>
<div class="line">entry = {</div>
<div class="line">  key: &#39;some/name/file&#39;, the path to the file</div>
<div class="line">  changed: true, // if the file was changed since previous run</div>
<div class="line">  meta: {</div>
<div class="line">    size: 3242, // the size of the file</div>
<div class="line">    mtime: 231231231, // the modification time of the file</div>
<div class="line">    data: {} // some extra field stored for this file (useful to save the result of a transformation on the file</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15441"></a>
Motivation for this module</h1>
<p>I needed a super simple and dumb <b>in-memory cache</b> with optional disk persistence (write-back cache) in order to make a script that will beautify files with <code>esformatter</code> to execute only on the files that were changed since the last run.</p>
<p>In doing so the process of beautifying files was reduced from several seconds to a small fraction of a second.</p>
<p>This module uses <a href="https://www.npmjs.com/package/flat-cache">flat-cache</a> a super simple <code>key/value</code> cache storage with optional file persistance.</p>
<p>The main idea is to read the files when the task begins, apply the transforms required, and if the process succeed, then store the new state of the files. The next time this module request for <code>getChangedFiles</code> will return only the files that were modified. Making the process to end faster.</p>
<p>This module could also be used by processes that modify the files applying a transform, in that case the result of the transform could be stored in the <code>meta</code> field, of the entries. Anything added to the meta field will be persisted. Those processes won't need to call <code>getChangedFiles</code> they will instead call <code>normalizeEntries</code> that will return the entries with a <code>changed</code> field that can be used to determine if the file was changed or not. If it was not changed the transformed stored data could be used instead of actually applying the transformation, saving time in case of only a few files changed.</p>
<p>In the worst case scenario all the files will be processed. In the best case scenario only a few of them will be processed.</p>
<h1><a class="anchor" id="autotoc_md15442"></a>
Important notes</h1>
<ul>
<li>The values set on the meta attribute of the entries should be <code>stringify-able</code> ones if possible, flat-cache uses <code>circular-json</code> to try to persist circular structures, but this should be considered experimental. The best results are always obtained with non circular values</li>
<li>All the changes to the cache state are done to memory first and only persisted after reconcile.</li>
</ul>
<h1><a class="anchor" id="autotoc_md15443"></a>
License</h1>
<p>MIT </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_9bc18326bd251efe347dcb7c2b8a8cb2.html">file-entry-cache</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
