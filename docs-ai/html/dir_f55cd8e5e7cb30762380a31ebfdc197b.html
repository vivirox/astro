<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/rehype-sanitize Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_f55cd8e5e7cb30762380a31ebfdc197b.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">rehype-sanitize Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p><a href="https://github.com/rehypejs/rehype-sanitize/actions"><img src="https://github.com/rehypejs/rehype-sanitize/workflows/main/badge.svg" alt="Build" style="pointer-events: none;" class="inline"/></a> <a href="https://codecov.io/github/rehypejs/rehype-sanitize"><img src="https://img.shields.io/codecov/c/github/rehypejs/rehype-sanitize.svg" alt="Coverage" style="pointer-events: none;" class="inline"/></a> <a href="https://www.npmjs.com/package/rehype-sanitize"><img src="https://img.shields.io/npm/dm/rehype-sanitize.svg" alt="Downloads" style="pointer-events: none;" class="inline"/></a> <a href="https://bundlejs.com/?q=rehype-sanitize"><img src="https://img.shields.io/bundlejs/size/rehype-sanitize" alt="Size" class="inline"/></a> <a href="https://opencollective.com/unified"><img src="https://opencollective.com/unified/sponsors/badge.svg" alt="Sponsors" style="pointer-events: none;" class="inline"/></a> <a href="https://opencollective.com/unified"><img src="https://opencollective.com/unified/backers/badge.svg" alt="Backers" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rehypejs/rehype/discussions"><img src="https://img.shields.io/badge/chat-discussions-success.svg" alt="Chat" style="pointer-events: none;" class="inline"/></a></p>
<p><b><a href="https://github.com/rehypejs/rehype">rehype</a></b> plugin to sanitize HTML.</p>
<h1><a class="anchor" id="autotoc_md28927"></a>
Contents</h1>
<ul>
<li>What is this?</li>
<li>When should I use this?</li>
<li>Install</li>
<li>Use</li>
<li><a class="el" href="/Users/vivi/astro/node_modules/flexsearch/README.md#api">API</a><ul>
<li>`defaultSchema`</li>
<li>`unified().use(rehypeSanitize[, schema])`</li>
<li><a class="el" href="/Users/vivi/astro/node_modules/flexsearch/README.md#options">`Options`</a></li>
</ul>
</li>
<li>Example<ul>
<li>Example: headings (DOM clobbering)</li>
<li>Example: math</li>
<li>Example: syntax highlighting</li>
</ul>
</li>
<li><a class="el" href="/Users/vivi/astro/node_modules/@sinclair/typebox/readme.md#types">Types</a></li>
<li>Compatibility</li>
<li>Security</li>
<li>Related</li>
<li><a class="el" href="/Users/vivi/astro/node_modules/@sinclair/typebox/readme.md#contribute">Contribute</a></li>
<li><a class="el" href="/Users/vivi/astro/node_modules/bl/README.md#license">License</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md28928"></a>
What is this?</h1>
<p>This package is a <a href="https://github.com/unifiedjs/unified">unified</a> (<a href="https://github.com/rehypejs/rehype">rehype</a>) plugin to make sure HTML is safe. It drops anything that isn’t explicitly allowed by a schema (defaulting to how <code>github.com</code> works).</p>
<p><b>unified</b> is a project that transforms content with abstract syntax trees (ASTs). <b>rehype</b> adds support for HTML to unified. <b>hast</b> is the HTML AST that rehype uses. This is a rehype plugin that transforms hast.</p>
<h1><a class="anchor" id="autotoc_md28929"></a>
When should I use this?</h1>
<p>It’s recommended to sanitize your HTML any time you do not completely trust authors or the plugins being used.</p>
<p>This plugin is built on <a href="https://github.com/syntax-tree/hast-util-sanitize"><code>hast-util-sanitize</code></a>, which cleans <a href="https://github.com/syntax-tree/hast">hast</a> syntax trees. rehype focusses on making it easier to transform content by abstracting such internals away.</p>
<h1><a class="anchor" id="autotoc_md28930"></a>
Install</h1>
<p>This package is <a href="https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c">ESM only</a>. In Node.js (version 16+), install with <a href="https://docs.npmjs.com/cli/install">npm</a>:</p>
<div class="fragment"><div class="line">npm install rehype-sanitize</div>
</div><!-- fragment --><p>In Deno with <a href="https://esm.sh"><code>esm.sh</code></a>:</p>
<div class="fragment"><div class="line">import rehypeSanitize from &#39;https://esm.sh/rehype-sanitize@6&#39;</div>
</div><!-- fragment --><p>In browsers with <a href="https://esm.sh"><code>esm.sh</code></a>:</p>
<div class="fragment"><div class="line">&lt;script type=&quot;module&quot;&gt;</div>
<div class="line">  import rehypeSanitize from &#39;https://esm.sh/rehype-sanitize@6?bundle&#39;</div>
<div class="line">&lt;/script&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28931"></a>
Use</h1>
<p>Say we have the following file <code>index.html</code>:</p>
<div class="fragment"><div class="line">&lt;div onmouseover=&quot;alert(&#39;alpha&#39;)&quot;&gt;</div>
<div class="line">  &lt;a href=&quot;jAva script:alert(&#39;bravo&#39;)&quot;&gt;delta&lt;/a&gt;</div>
<div class="line">  &lt;img src=&quot;x&quot; onerror=&quot;alert(&#39;charlie&#39;)&quot;&gt;</div>
<div class="line">  &lt;iframe src=&quot;javascript:alert(&#39;delta&#39;)&quot;&gt;&lt;/iframe&gt;</div>
<div class="line">  &lt;math&gt;</div>
<div class="line">    &lt;mi xlink:href=&quot;data:x,&lt;script&gt;alert(&#39;echo&#39;)&lt;/script&gt;&quot;&gt;&lt;/mi&gt;</div>
<div class="line">  &lt;/math&gt;</div>
<div class="line">&lt;/div&gt;</div>
<div class="line">&lt;script&gt;</div>
<div class="line">require(&#39;child_process&#39;).spawn(&#39;echo&#39;, [&#39;hack!&#39;]);</div>
<div class="line">&lt;/script&gt;</div>
</div><!-- fragment --><p>…and our module <code>example.js</code> looks as follows:</p>
<div class="fragment"><div class="line">import rehypeParse from &#39;rehype-parse&#39;</div>
<div class="line">import rehypeSanitize from &#39;rehype-sanitize&#39;</div>
<div class="line">import rehypeStringify from &#39;rehype-stringify&#39;</div>
<div class="line">import {read} from &#39;to-vfile&#39;</div>
<div class="line">import {unified} from &#39;unified&#39;</div>
<div class="line"> </div>
<div class="line">const file = await unified()</div>
<div class="line">  .use(rehypeParse, {fragment: true})</div>
<div class="line">  .use(rehypeSanitize)</div>
<div class="line">  .use(rehypeStringify)</div>
<div class="line">  .process(await read(&#39;index.html&#39;))</div>
<div class="line"> </div>
<div class="line">console.log(String(file))</div>
</div><!-- fragment --><p>Now running <code>node example.js</code> yields:</p>
<div class="fragment"><div class="line">&lt;div&gt;</div>
<div class="line">  &lt;a&gt;delta&lt;/a&gt;</div>
<div class="line">  &lt;img src=&quot;x&quot;&gt;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">&lt;/div&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28932"></a>
API</h1>
<p>This package exports the identifier `defaultSchema`. The default export is `rehypeSanitize`.</p>
<h2><a class="anchor" id="autotoc_md28933"></a>
<code>defaultSchema</code></h2>
<p>Default schema (<a class="el" href="/Users/vivi/astro/node_modules/flexsearch/README.md#options">`Options`</a>).</p>
<p>Follows GitHub style sanitation.</p>
<h2><a class="anchor" id="autotoc_md28934"></a>
<code>unified().use(rehypeSanitize[, schema])</code></h2>
<p>Sanitize HTML.</p>
<h5><a class="anchor" id="autotoc_md28935"></a>
Parameters</h5>
<ul>
<li><code>options</code> (<a class="el" href="/Users/vivi/astro/node_modules/flexsearch/README.md#options">`Options`</a>, optional) — configuration</li>
</ul>
<h5><a class="anchor" id="autotoc_md28936"></a>
Returns</h5>
<p>Transform (<a href="https://github.com/unifiedjs/unified?tab=readme-ov-file#transformer"><code>Transformer</code></a>).</p>
<h2><a class="anchor" id="autotoc_md28937"></a>
<code>Options</code></h2>
<p>Schema that defines what nodes and properties are allowed (TypeScript type).</p>
<p>This option is a bit advanced as it requires knowledge of syntax trees, so see the docs for <a href="https://github.com/syntax-tree/hast-util-sanitize#schema"><code>Schema</code> in <code>hast-util-sanitize</code></a>.</p>
<h1><a class="anchor" id="autotoc_md28938"></a>
Example</h1>
<h2><a class="anchor" id="autotoc_md28939"></a>
Example: headings (DOM clobbering)</h2>
<p>DOM clobbering is an attack in which malicious HTML confuses an application by naming elements, through <code>id</code> or <code>name</code> attributes, such that they overshadow presumed properties in <code>window</code> (the global scope in browsers). DOM clobbering often occurs when user content is used to generate heading IDs. To illustrate, say we have this <code>browser.js</code> file:</p>
<div class="fragment"><div class="line">console.log(current)</div>
</div><!-- fragment --><p>And our module <code>example.js</code> contains:</p>
<div class="fragment"><div class="line">/**</div>
<div class="line"> * @typedef {import(&#39;hast&#39;).Root} Root</div>
<div class="line"> */</div>
<div class="line"> </div>
<div class="line">import fs from &#39;node:fs/promises&#39;</div>
<div class="line">import rehypeParse from &#39;rehype-parse&#39;</div>
<div class="line">import rehypeStringify from &#39;rehype-stringify&#39;</div>
<div class="line">import {unified} from &#39;unified&#39;</div>
<div class="line"> </div>
<div class="line">const browser = String(await fs.readFile(&#39;browser.js&#39;))</div>
<div class="line">const document = `&lt;a name=&quot;old&quot;&gt;&lt;/a&gt;</div>
<div class="line">&lt;h1 id=&quot;current&quot;&gt;Current&lt;/h1&gt;</div>
<div class="line">${`&lt;p&gt;${&#39;Lorem ipsum dolor sit amet. &#39;.repeat(20)}&lt;/p&gt;\n`.repeat(20)}</div>
<div class="line">&lt;p&gt;Link to &lt;a href=&quot;#current&quot;&gt;current&lt;/a&gt;, link to &lt;a href=&quot;#old&quot;&gt;old&lt;/a&gt;.`</div>
<div class="line"> </div>
<div class="line">const file = await unified()</div>
<div class="line">  .use(rehypeParse, {fragment: true})</div>
<div class="line">  .use(function () {</div>
<div class="line">    /**</div>
<div class="line">     * @param {Root} tree</div>
<div class="line">     */</div>
<div class="line">    return function (tree) {</div>
<div class="line">      tree.children.push({</div>
<div class="line">        type: &#39;element&#39;,</div>
<div class="line">        tagName: &#39;script&#39;,</div>
<div class="line">        properties: {type: &#39;module&#39;},</div>
<div class="line">        children: [{type: &#39;text&#39;, value: browser}]</div>
<div class="line">      })</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .use(rehypeStringify)</div>
<div class="line">  .process(document)</div>
<div class="line"> </div>
<div class="line">await fs.writeFile(&#39;output.html&#39;, String(file))</div>
</div><!-- fragment --><p>This code processes HTML, inlines our browser script into it, and writes it out. The input HTML models how markdown often looks on platforms like GitHub, which allow heading IDs to be generated from their text and embedded HTML (including <code>&lt;a name="old"&gt;&lt;/a&gt;</code>, which can be used to create anchors for renamed headings to prevent links from breaking). The generated HTML looks like:</p>
<div class="fragment"><div class="line">&lt;a name=&quot;old&quot;&gt;&lt;/a&gt;</div>
<div class="line">&lt;h1 id=&quot;current&quot;&gt;Current&lt;/h1&gt;</div>
<div class="line">&lt;p&gt;Lorem ipsum dolor sit amet.&lt;!--…--&gt;&lt;/p&gt;</div>
<div class="line">&lt;p&gt;Link to &lt;a href=&quot;#current&quot;&gt;current&lt;/a&gt;, link to &lt;a href=&quot;#old&quot;&gt;old&lt;/a&gt;.&lt;/p&gt;</div>
<div class="line">&lt;script type=&quot;module&quot;&gt;console.log(current)&lt;/script&gt;</div>
</div><!-- fragment --><p>When you run this code locally and open the generated <code>output.html</code>, you can observe that the links at the bottom work, but also that the <code>&lt;h1&gt;</code> element is printed to the console (the clobbering).</p>
<p><code>rehype-sanitize</code> solves the clobbering by prefixing every <code>id</code> and <code>name</code> attribute with &lsquo;'user-content-&rsquo;<code>. Changing</code>example.js`:</p>
<div class="fragment"><div class="line">@@ -15,6 +15,7 @@ ${`&lt;p&gt;${&#39;Lorem ipsum dolor sit amet. &#39;.repeat(20)}&lt;/p&gt;\n`.repeat(20)}</div>
<div class="line"> </div>
<div class="line">   const file = await unified()</div>
<div class="line">     .use(rehypeParse, {fragment: true})</div>
<div class="line">+    .use(rehypeSanitize)</div>
<div class="line">     .use(function () {</div>
<div class="line">       /**</div>
<div class="line">        * @param {Root} tree</div>
</div><!-- fragment --><p>Now yields:</p>
<div class="fragment"><div class="line">-&lt;a name=&quot;old&quot;&gt;&lt;/a&gt;</div>
<div class="line">-&lt;h1 id=&quot;current&quot;&gt;Current&lt;/h1&gt;</div>
<div class="line">+&lt;a name=&quot;user-content-old&quot;&gt;&lt;/a&gt;</div>
<div class="line">+&lt;h1 id=&quot;user-content-current&quot;&gt;Current&lt;/h1&gt;</div>
</div><!-- fragment --><p>This introduces another problem as the links are now broken. It could perhaps be solved by changing all links, but that would make the links rather ugly, and we’d need to track what IDs we have outside of the user content on our pages too. Alternatively, and what arguably looks better, we could rewrite pretty links to their safe but ugly prefixed elements. This is what GitHub does. Replace <code>browser.js</code> with the following:</p>
<div class="fragment"><div class="line">/// &lt;reference lib=&quot;dom&quot; /&gt;</div>
<div class="line">/* eslint-env browser */</div>
<div class="line"> </div>
<div class="line">// Page load (you could wrap this in a DOM ready if the script is loaded early).</div>
<div class="line">hashchange()</div>
<div class="line"> </div>
<div class="line">// When URL changes.</div>
<div class="line">window.addEventListener(&#39;hashchange&#39;, hashchange)</div>
<div class="line"> </div>
<div class="line">// When on the URL already, perhaps after scrolling, and clicking again, which</div>
<div class="line">// doesn’t emit `hashchange`.</div>
<div class="line">document.addEventListener(</div>
<div class="line">  &#39;click&#39;,</div>
<div class="line">  function (event) {</div>
<div class="line">    if (</div>
<div class="line">      event.target &amp;&amp;</div>
<div class="line">      event.target instanceof HTMLAnchorElement &amp;&amp;</div>
<div class="line">      event.target.href === location.href &amp;&amp;</div>
<div class="line">      location.hash.length &gt; 1</div>
<div class="line">    ) {</div>
<div class="line">      setImmediate(function () {</div>
<div class="line">        if (!event.defaultPrevented) {</div>
<div class="line">          hashchange()</div>
<div class="line">        }</div>
<div class="line">      })</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  false</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">function hashchange() {</div>
<div class="line">  /** @type {string | undefined} */</div>
<div class="line">  let hash</div>
<div class="line"> </div>
<div class="line">  try {</div>
<div class="line">    hash = decodeURIComponent(location.hash.slice(1)).toLowerCase()</div>
<div class="line">  } catch {</div>
<div class="line">    return</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  const name = &#39;user-content-&#39; + hash</div>
<div class="line">  const target =</div>
<div class="line">    document.getElementById(name) || document.getElementsByName(name)[0]</div>
<div class="line"> </div>
<div class="line">  if (target) {</div>
<div class="line">    setImmediate(function () {</div>
<div class="line">      target.scrollIntoView()</div>
<div class="line">    })</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28940"></a>
Example: math</h2>
<p>Math can be enabled in rehype by using the plugins <a href="https://github.com/remarkjs/remark-math/tree/main/packages/rehype-katex"><code>rehype-katex</code></a> or <a href="https://github.com/remarkjs/remark-math/tree/main/packages/rehype-mathjax"><code>rehype-mathjax</code></a>. The operate on <code>span</code>s and <code>div</code>s with certain classes and inject complex markup and of inline styles, most of which this plugin will remove. Say our module <code>example.js</code> contains:</p>
<div class="fragment"><div class="line">import rehypeKatex from &#39;rehype-katex&#39;</div>
<div class="line">import rehypeParse from &#39;rehype-parse&#39;</div>
<div class="line">import rehypeSanitize from &#39;rehype-sanitize&#39;</div>
<div class="line">import rehypeStringify from &#39;rehype-stringify&#39;</div>
<div class="line">import {unified} from &#39;unified&#39;</div>
<div class="line"> </div>
<div class="line">const file = await unified()</div>
<div class="line">  .use(rehypeParse, {fragment: true})</div>
<div class="line">  .use(rehypeKatex)</div>
<div class="line">  .use(rehypeSanitize)</div>
<div class="line">  .use(rehypeStringify)</div>
<div class="line">  .process(&#39;&lt;span class=&quot;math math-inline&quot;&gt;L&lt;/span&gt;&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(String(file))</div>
</div><!-- fragment --><p>Running that yields:</p>
<div class="fragment"><div class="line">&lt;span&gt;&lt;span&gt;&lt;span&gt;LL&lt;/span&gt;&lt;span aria-hidden=&quot;true&quot;&gt;&lt;span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;L&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;</div>
</div><!-- fragment --><p>It is possible to pass a schema which allows MathML and inline styles, but it would be complex, and allows <em>all</em> inline styles, which is unsafe. Alternatively, and arguably better, would be to <em>first</em> sanitize the HTML, allowing only the specific classes that <code>rehype-katex</code> and <code>rehype-mathjax</code> use, and <em>then</em> using those plugins:</p>
<div class="fragment"><div class="line">@@ -1,7 +1,7 @@</div>
<div class="line"> import rehypeKatex from &#39;rehype-katex&#39;</div>
<div class="line"> import rehypeParse from &#39;rehype-parse&#39;</div>
<div class="line">-import rehypeSanitize from &#39;rehype-sanitize&#39;</div>
<div class="line">+import rehypeSanitize, {defaultSchema} from &#39;rehype-sanitize&#39;</div>
<div class="line"> import rehypeStringify from &#39;rehype-stringify&#39;</div>
<div class="line"> import {unified} from &#39;unified&#39;</div>
<div class="line"> </div>
<div class="line"> main()</div>
<div class="line">@@ -9,8 +9,21 @@ main()</div>
<div class="line"> const file = await unified()</div>
<div class="line">   .use(rehypeParse, {fragment: true})</div>
<div class="line">+  .use(rehypeSanitize, {</div>
<div class="line">+    ...defaultSchema,</div>
<div class="line">+    attributes: {</div>
<div class="line">+      ...defaultSchema.attributes,</div>
<div class="line">+      div: [</div>
<div class="line">+        ...(defaultSchema.attributes.div || []),</div>
<div class="line">+        [&#39;className&#39;, &#39;math&#39;, &#39;math-display&#39;]</div>
<div class="line">+      ],</div>
<div class="line">+      span: [</div>
<div class="line">+        ...(defaultSchema.attributes.span || []),</div>
<div class="line">+        [&#39;className&#39;, &#39;math&#39;, &#39;math-inline&#39;]</div>
<div class="line">+      ]</div>
<div class="line">+    }</div>
<div class="line">+  })</div>
<div class="line">   .use(rehypeKatex)</div>
<div class="line">-  .use(rehypeSanitize)</div>
<div class="line">   .use(rehypeStringify)</div>
<div class="line">   .process(&#39;&lt;span class=&quot;math math-inline&quot;&gt;L&lt;/span&gt;&#39;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28941"></a>
Example: syntax highlighting</h2>
<p>Highlighting, for example with <a href="https://github.com/rehypejs/rehype-highlight"><code>rehype-highlight</code></a>, can be solved similar to how math is solved (see previous example). That is, use <code>rehype-sanitize</code> and allow the classes needed for highlighting, and highlight afterwards:</p>
<div class="fragment"><div class="line">import rehypeHighlight from &#39;rehype-highlight&#39;</div>
<div class="line">import rehypeParse from &#39;rehype-parse&#39;</div>
<div class="line">import rehypeSanitize, {defaultSchema} from &#39;rehype-sanitize&#39;</div>
<div class="line">import rehypeStringify from &#39;rehype-stringify&#39;</div>
<div class="line">import {unified} from &#39;unified&#39;</div>
<div class="line"> </div>
<div class="line">const file = await unified()</div>
<div class="line">  .use(rehypeParse, {fragment: true})</div>
<div class="line">  .use(rehypeSanitize, {</div>
<div class="line">    ...defaultSchema,</div>
<div class="line">    attributes: {</div>
<div class="line">      ...defaultSchema.attributes,</div>
<div class="line">      code: [</div>
<div class="line">        ...(defaultSchema.attributes.code || []),</div>
<div class="line">        // List of all allowed languages:</div>
<div class="line">        [&#39;className&#39;, &#39;language-js&#39;, &#39;language-css&#39;, &#39;language-md&#39;]</div>
<div class="line">      ]</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line">  .use(rehypeHighlight, {subset: false})</div>
<div class="line">  .use(rehypeStringify)</div>
<div class="line">  .process(&#39;&lt;pre&gt;&lt;code className=&quot;language-js&quot;&gt;console.log(1)&lt;/code&gt;&lt;/pre&gt;&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(String(file))</div>
</div><!-- fragment --><p>Alternatively, it’s possible to make highlighting safe by allowing all the classes used on tokens. Modifying the above code like so:</p>
<div class="fragment"><div class="line"> const file = await unified()</div>
<div class="line">   .use(rehypeParse, {fragment: true})</div>
<div class="line">+  .use(rehypeHighlight, {subset: false})</div>
<div class="line">   .use(rehypeSanitize, {</div>
<div class="line">     ...defaultSchema,</div>
<div class="line">     attributes: {</div>
<div class="line">       ...defaultSchema.attributes,</div>
<div class="line">-      code: [</div>
<div class="line">-        ...(defaultSchema.attributes.code || []),</div>
<div class="line">-        // List of all allowed languages:</div>
<div class="line">-        [&#39;className&#39;, &#39;hljs&#39;, &#39;language-js&#39;, &#39;language-css&#39;, &#39;language-md&#39;]</div>
<div class="line">+      span: [</div>
<div class="line">+        ...(defaultSchema.attributes.span || []),</div>
<div class="line">+        // List of all allowed tokens:</div>
<div class="line">+        [&#39;className&#39;, &#39;hljs-addition&#39;, &#39;hljs-attr&#39;, &#39;hljs-attribute&#39;, &#39;hljs-built_in&#39;, &#39;hljs-bullet&#39;, &#39;hljs-char&#39;, &#39;hljs-code&#39;, &#39;hljs-comment&#39;, &#39;hljs-deletion&#39;, &#39;hljs-doctag&#39;, &#39;hljs-emphasis&#39;, &#39;hljs-formula&#39;, &#39;hljs-keyword&#39;, &#39;hljs-link&#39;, &#39;hljs-literal&#39;, &#39;hljs-meta&#39;, &#39;hljs-name&#39;, &#39;hljs-number&#39;, &#39;hljs-operator&#39;, &#39;hljs-params&#39;, &#39;hljs-property&#39;, &#39;hljs-punctuation&#39;, &#39;hljs-quote&#39;, &#39;hljs-regexp&#39;, &#39;hljs-section&#39;, &#39;hljs-selector-attr&#39;, &#39;hljs-selector-class&#39;, &#39;hljs-selector-id&#39;, &#39;hljs-selector-pseudo&#39;, &#39;hljs-selector-tag&#39;, &#39;hljs-string&#39;, &#39;hljs-strong&#39;, &#39;hljs-subst&#39;, &#39;hljs-symbol&#39;, &#39;hljs-tag&#39;, &#39;hljs-template-tag&#39;, &#39;hljs-template-variable&#39;, &#39;hljs-title&#39;, &#39;hljs-type&#39;, &#39;hljs-variable&#39;</div>
<div class="line">+          ]</div>
<div class="line">       ]</div>
<div class="line">     }</div>
<div class="line">   })</div>
<div class="line">-  .use(rehypeHighlight, {subset: false})</div>
<div class="line">   .use(rehypeStringify)</div>
<div class="line">   .process(&#39;&lt;pre&gt;&lt;code className=&quot;language-js&quot;&gt;console.log(1)&lt;/code&gt;&lt;/pre&gt;&#39;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28942"></a>
Types</h1>
<p>This package is fully typed with <a href="https://www.typescriptlang.org">TypeScript</a>. It exports the additional type <a class="el" href="/Users/vivi/astro/node_modules/flexsearch/README.md#options">`Options`</a>.</p>
<h1><a class="anchor" id="autotoc_md28943"></a>
Compatibility</h1>
<p>Projects maintained by the unified collective are compatible with maintained versions of Node.js.</p>
<p>When we cut a new major release, we drop support for unmaintained versions of Node. This means we try to keep the current release line, <code>rehype-sanitize@^6</code>, compatible with Node.js 16.</p>
<p>This plugin works with <code>rehype-parse</code> version 3+, <code>rehype-stringify</code> version 3+, <code>rehype</code> version 5+, and <code>unified</code> version 6+.</p>
<h1><a class="anchor" id="autotoc_md28944"></a>
Security</h1>
<p>The defaults are safe but improper use of <code>rehype-sanitize</code> can open you up to a <a href="https://en.wikipedia.org/wiki/Cross-site_scripting">cross-site scripting (XSS)</a> attack.</p>
<p>Use <code>rehype-sanitize</code> after the last unsafe thing: everything after <code>rehype-sanitize</code> could be unsafe (but is fine if you do trust it).</p>
<h1><a class="anchor" id="autotoc_md28945"></a>
Related</h1>
<ul>
<li><a href="https://github.com/syntax-tree/hast-util-sanitize"><code>hast-util-sanitize</code></a> — utility to sanitize <a href="https://github.com/syntax-tree/hast">hast</a></li>
<li><a href="https://github.com/rehypejs/rehype-format"><code>rehype-format</code></a> — format HTML</li>
<li><a href="https://github.com/rehypejs/rehype-minify"><code>rehype-minify</code></a> — minify HTML</li>
</ul>
<h1><a class="anchor" id="autotoc_md28946"></a>
Contribute</h1>
<p>See <a href="https://github.com/rehypejs/.github/blob/HEAD/contributing.md"><code>contributing.md</code></a> in <a href="https://github.com/rehypejs/.github"><code>rehypejs/.github</code></a> for ways to get started. See <a href="https://github.com/rehypejs/.github/blob/HEAD/support.md"><code>support.md</code></a> for ways to get help.</p>
<p>This project has a <a href="https://github.com/rehypejs/.github/blob/HEAD/code-of-conduct.md">code of conduct</a>. By interacting with this repository, organization, or community you agree to abide by its terms.</p>
<h1><a class="anchor" id="autotoc_md28947"></a>
License</h1>
<p>[MIT][license] © <a href="https://wooorm.com">Titus Wormer</a> </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_f55cd8e5e7cb30762380a31ebfdc197b.html">rehype-sanitize</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
