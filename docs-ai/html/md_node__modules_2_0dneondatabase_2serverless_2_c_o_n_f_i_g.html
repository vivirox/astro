<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: Options and configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_node__modules_2_0dneondatabase_2serverless_2_c_o_n_f_i_g.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Options and configuration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md4989"></a></p>
<h1><a class="anchor" id="autotoc_md4990"></a>
<code>neon(...)</code> function</h1>
<p>The <code>neon(...)</code> function returns a query function that can be used both as a tagged-template function and as an ordinary function:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line"> </div>
<div class="line">// as a tagged-template function</div>
<div class="line">const rowsA = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line"> </div>
<div class="line">// as an ordinary function (exactly equivalent)</div>
<div class="line">const rowsB = await sql(&#39;SELECT * FROM posts WHERE id = $1&#39;, [postId]);</div>
</div><!-- fragment --><p>By default, the query function returned by <code>neon(...)</code> returns only the rows resulting from the provided SQL query, and it returns them as an array of objects where the keys are column names. For example:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const rows = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line">// -&gt; [{ id: 12, title: &quot;My post&quot;, ... }]</div>
</div><!-- fragment --><p>However, you can customise the return format of the query function using the configuration options <code>fullResults</code> and <code>arrayMode</code>. These options are available both on the <code>neon(...)</code> function and on the query function it returns (but only when the query function is called as an ordinary function, not as a tagged-template function).</p>
<h2><a class="anchor" id="autotoc_md4991"></a>
<code>arrayMode: boolean</code></h2>
<p>When <code>arrayMode</code> is true, rows are returned as an array of arrays instead of an array of objects:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL, { arrayMode: true });</div>
<div class="line">const rows = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line">// -&gt; [[12, &quot;My post&quot;, ...]]</div>
</div><!-- fragment --><p>Or, with the same effect:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const rows = await sql(&#39;SELECT * FROM posts WHERE id = $1&#39;, [postId], { arrayMode: true });</div>
<div class="line">// -&gt; [[12, &quot;My post&quot;, ...]]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4992"></a>
<code>fullResults: boolean</code></h2>
<p>When <code>fullResults</code> is true, additional metadata is returned alongside the result rows, which are then found in the <code>rows</code> property of the return value. The metadata matches what would be returned by node-postgres:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL, { fullResults: true });</div>
<div class="line">const results = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line">/* -&gt; {</div>
<div class="line">  rows: [{ id: 12, title: &quot;My post&quot;, ... }],</div>
<div class="line">  fields: [</div>
<div class="line">    { name: &quot;id&quot;, dataTypeID: 23, ... },</div>
<div class="line">    { name: &quot;title&quot;, dataTypeID: 25, ... },</div>
<div class="line">    ...</div>
<div class="line">  ],</div>
<div class="line">  rowCount: 1,</div>
<div class="line">  rowAsArray: false,</div>
<div class="line">  command: &quot;SELECT&quot;</div>
<div class="line">} </div>
<div class="line">*/</div>
</div><!-- fragment --><p>Or, with the same effect:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const results = await sql(&#39;SELECT * FROM posts WHERE id = $1&#39;, [postId], { fullResults: true });</div>
<div class="line">// -&gt; { ... same as above ... }</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4993"></a>
<code>fetchOptions: Record&lt;string, any&gt;</code></h2>
<p>The <code>fetchOptions</code> option can be passed to <code>neon(...)</code>, the <code>transaction</code> function, or the query function (if not within a <code>transaction</code> function). This option takes an object that is merged with the options to the <code>fetch</code> call.</p>
<p>For example, to increase the priority of every database <code>fetch</code> request:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL, { fetchOptions: { priority: &#39;high&#39; } });</div>
<div class="line">const rows = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
</div><!-- fragment --><p>Or to implement a <code>fetch</code> timeout:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const abortController = new AbortController();</div>
<div class="line">const timeout = setTimeout(() =&gt; abortController.abort(&#39;timed out&#39;), 10000);</div>
<div class="line">const rows = await sql(</div>
<div class="line">  &#39;SELECT * FROM posts WHERE id = $1&#39;, [postId], </div>
<div class="line">  { fetchOptions: { signal: abortController.signal } }</div>
<div class="line">);  // throws an error if no result received within 10s</div>
<div class="line">clearTimeout(timeout);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4994"></a>
<code>transaction(...)</code> function</h1>
<p>The <code>transaction(queriesOrFn, options)</code> function is exposed as a property on the query function. It allows multiple queries to be executed within a single, non-interactive transaction.</p>
<p>The first argument to <code>transaction()</code>, <code>queriesOrFn</code>, is either (1) an array of queries or (2) a non-<code>async</code> function that receives a query function as its argument and returns an array of queries.</p>
<p>The array-of-queries case looks like this:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const showLatestN = 10;</div>
<div class="line"> </div>
<div class="line">const [posts, tags] = await sql.transaction([</div>
<div class="line">  sql`SELECT * FROM posts ORDER BY posted_at DESC LIMIT ${showLatestN}`,</div>
<div class="line">  sql`SELECT * FROM tags`,</div>
<div class="line">], { </div>
<div class="line">  isolationLevel: &#39;RepeatableRead&#39;,</div>
<div class="line">  readOnly: true, </div>
<div class="line">});</div>
</div><!-- fragment --><p>Or as an example of the function case:</p>
<div class="fragment"><div class="line">const [authors, tags] = await neon(process.env.DATABASE_URL)</div>
<div class="line">  .transaction(txn =&gt; [</div>
<div class="line">    txn`SELECT * FROM authors`,</div>
<div class="line">    txn`SELECT * FROM tags`,</div>
<div class="line">  ]);</div>
</div><!-- fragment --><p>The optional second argument to <code>transaction()</code>, <code>options</code>, has the same keys as the options to the ordinary query function &ndash; <code>arrayMode</code>, <code>fullResults</code> and <code>fetchOptions</code> &ndash; plus three additional keys that concern the transaction configuration. These transaction-related keys are: <code>isolationMode</code>, <code>readOnly</code> and <code>deferrable</code>. They are described below. Defaults for the transaction-related keys can also be set as options to the <code>neon</code> function.</p>
<p>The <code>fetchOptions</code> option cannot be supplied for individual queries inside <code>transaction()</code>, since only a single <code>fetch</code> is performed for the transaction as a whole. The TypeScript types also currently do not allow <code>arrayMode</code> or <code>fullResults</code> options to be supplied for individual queries within <code>transaction()</code> (although this does have the expected effect if the type errors are ignored).</p>
<h2><a class="anchor" id="autotoc_md4995"></a>
<code>isolationMode</code></h2>
<p>This option selects a Postgres <a href="https://www.postgresql.org/docs/current/transaction-iso.html">transaction isolation mode</a>. If present, it must be one of: &lsquo;'ReadUncommitted&rsquo;<code>,</code>'ReadCommitted'<code>,</code>'RepeatableRead'<code>or</code>'Serializable'`.</p>
<h2><a class="anchor" id="autotoc_md4996"></a>
<code>readOnly</code></h2>
<p>If <code>true</code>, this option ensures that a <code>READ ONLY</code> transaction is used to execute the queries passed.</p>
<h2><a class="anchor" id="autotoc_md4997"></a>
<code>deferrable</code></h2>
<p>If <code>true</code> (and if <code>readOnly</code> is also <code>true</code>, and <code>isolationMode</code> is &lsquo;'Serializable&rsquo;<code>), this option ensures that a</code>DEFERRABLE` transaction is used to execute the queries passed.</p>
<h1><a class="anchor" id="autotoc_md4998"></a>
<code>neonConfig</code> configuration</h1>
<p>In most cases, there are two ways to set configuration options:</p>
<ol type="1">
<li>Import <code>neonConfig</code> from the package and set global default options on that.</li>
<li>Set options on individual <code>Client</code> instances using their <code>neonConfig</code> property.</li>
</ol>
<p>For example:</p>
<div class="fragment"><div class="line">import { Client, neonConfig } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">import ws from &#39;ws&#39;;</div>
<div class="line"> </div>
<div class="line">// set default option for all clients</div>
<div class="line">neonConfig.webSocketConstructor = ws;</div>
<div class="line"> </div>
<div class="line">// override the default option on an individual client</div>
<div class="line">const client = new Client(process.env.DATABASE_URL);</div>
<div class="line">client.neonConfig.webSocketConstructor = ws;</div>
</div><!-- fragment --><p>A few configuration options can only be set globally, and these are noted as such below.</p>
<h3><a class="anchor" id="autotoc_md4999"></a>
<code>webSocketConstructor: typeof WebSocket | undefined</code></h3>
<p>Set this parameter if you're using the driver in an environment where the <code>WebSocket</code> global is not defined, such as Node.js, and you need transaction or session support.</p>
<p>For example:</p>
<div class="fragment"><div class="line">import { neonConfig } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">import ws from &#39;ws&#39;;</div>
<div class="line">neonConfig.webSocketConstructor = ws; </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5000"></a>
Advanced configuration</h2>
<p>If you're using <code>@neondatabase/serverless</code> to connect to a Neon database, you usually <b>won't</b> need to touch the following configuration options. These options are intended for testing, troubleshooting, and supporting access to non-Neon Postgres instances via self-hosted WebSocket proxies.</p>
<h3><a class="anchor" id="autotoc_md5001"></a>
<code>poolQueryViaFetch: boolean</code></h3>
<p><b>Experimentally</b>, when <code>poolQueryViaFetch</code> is <code>true</code> and no listeners for the <code>"connect"</code>, <code>"acquire"</code>, <code>"release"</code> or <code>"remove"</code> events are set on the <code>Pool</code>, queries via <code>Pool.query()</code> will be sent by low-latency HTTP <code>fetch</code> request.</p>
<p>Default: currently <code>false</code> (but may be <code>true</code> in future).</p>
<p>Note: this option can only be set globally, <b>not</b> on an individual <code>Client</code> instance.</p>
<h3><a class="anchor" id="autotoc_md5002"></a>
<code>fetchEndpoint: string | ((host: string, port: number | string) =&gt; string)</code></h3>
<p>Set <code>fetchEndpoint</code> to set the server endpoint to be sent queries via http fetch.</p>
<p>This may be useful for local development (e.g. to set a port that's not the default 443).</p>
<p>Provide either the full endpoint URL, or a function that takes the database host address and port and returns the full endpoint URL (including protocol).</p>
<p>Default: &lsquo;host =&gt; '<a href="https://&rsquo;">https://&amp;rsquo;</a> + host + '/sql'`</p>
<p>Note: this option can only be set globally, <b>not</b> on an individual <code>Client</code> instance.</p>
<h3><a class="anchor" id="autotoc_md5003"></a>
<code>fetchFunction: any</code></h3>
<p>The <code>fetchFunction</code> option allows you to supply an alternative function for making http requests. The function must accept the same arguments as native <code>fetch</code>.</p>
<p>Default: <code>undefined</code>.</p>
<p>Note: this option can only be set globally, <b>not</b> on an individual <code>Client</code> instance.</p>
<h3><a class="anchor" id="autotoc_md5004"></a>
<code>wsProxy: string | (host: string, port: number | string) =&gt; string</code></h3>
<p>If connecting to a non-Neon database, the <code>wsProxy</code> option should point to <a class="el" href="md_node__modules_2_0dneondatabase_2serverless_2_d_e_p_l_o_y.html">your WebSocket proxy</a>. It can either be a string, which will have <code>?address=host:port</code> appended to it, or a function with the signature <code>(host: string, port: number | string) =&gt; string</code>. Either way, the protocol must <em>not</em> be included, because this depends on other options. For example, when using the <code>wsproxy</code> proxy, the <code>wsProxy</code> option should look something like this:</p>
<div class="fragment"><div class="line">// either:</div>
<div class="line">neonConfig.wsProxy = (host, port) =&gt; `my-wsproxy.example.com/v1?address=${host}:${port}`</div>
<div class="line">// or (with identical effect):</div>
<div class="line">neonConfig.wsProxy = &#39;my-wsproxy.example.com/v1&#39;;</div>
</div><!-- fragment --><p>Default: &lsquo;host =&gt; host + &rsquo;/v2'`.</p>
<h3><a class="anchor" id="autotoc_md5005"></a>
<code>pipelineConnect: "password" | false</code></h3>
<p>To speed up connection times, the driver will pipeline the first three messages to the database (startup, authentication and first query) if <code>pipelineConnect</code> is set to <code>"password"</code>. Note that this will only work if you've configured cleartext password authentication for the relevant user and database.</p>
<p>If your connection doesn't support password authentication, set <code>pipelineConnect</code> to <code>false</code> instead.</p>
<p>Default: <code>"password"</code>.</p>
<h3><a class="anchor" id="autotoc_md5006"></a>
<code>coalesceWrites: boolean</code></h3>
<p>When this option is <code>true</code>, multiple network writes generated in a single iteration of the JavaScript run-loop are coalesced into a single WebSocket message. Since node-postgres sends a lot of very short messages, this may reduce TCP/IP overhead.</p>
<p>Default: <code>true</code>.</p>
<h3><a class="anchor" id="autotoc_md5007"></a>
<code>forceDisablePgSSL: boolean</code></h3>
<p>This option disables TLS encryption in the Postgres protocol (as set via e.g. <code>?sslmode=require</code> in the connection string). Security is not compromised if used in conjunction with <code>useSecureWebSocket = true</code>.</p>
<p>Default: <code>true</code>.</p>
<h3><a class="anchor" id="autotoc_md5008"></a>
<code>useSecureWebSocket: boolean</code></h3>
<p>This option switches between secure (the default) and insecure WebSockets.</p>
<p>To use experimental pure-JS encryption, set <code>useSecureWebSocket = false</code> and <code>forceDisablePgSSL = false</code>, and append <code>?sslmode=verify-full</code> to your database connection string.</p>
<p><b>Remember that pure-JS encryption is currently experimental and not suitable for use in production.</b></p>
<p>Default: <code>true</code>.</p>
<h3><a class="anchor" id="autotoc_md5009"></a>
<code>subtls: any</code></h3>
<p><b>Only when using experimental pure-JS TLS encryption</b>, you must supply the <a href="https://github.com/jawj/subtls">subtls</a> TLS library to the <code>subtls</code> option like so:</p>
<div class="fragment"><div class="line">import { neonConfig } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">import * as subtls from &#39;subtls&#39;;</div>
<div class="line">neonConfig.subtls = subtls;</div>
</div><!-- fragment --><p>Default: <code>undefined</code>.</p>
<h3><a class="anchor" id="autotoc_md5010"></a>
<code>rootCerts: string /* PEM format */</code></h3>
<p><b>Only when using experimental pure-JS TLS encryption</b>, the <code>rootCerts</code> option determines what root (certificate authority) certificates are trusted.</p>
<p>Its value is a string containing zero or more certificates in PEM format.</p>
<p>Default: <code>""</code> (the empty string).</p>
<h3><a class="anchor" id="autotoc_md5011"></a>
<code>pipelineTLS: boolean</code></h3>
<p><b>Only when using experimental pure-JS encryption</b>, the driver will pipeline the SSL request message and TLS Client Hello if <code>pipelineTLS</code> is set to <code>true</code>. Currently, this is only supported by Neon database hosts, and will fail when communicating with an ordinary Postgres or pgbouncer back-end.</p>
<p>Default: <code>false</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
