<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gradiant Ascent: node_modules/@neondatabase/serverless Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Gradiant Ascent
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_88d000e696e5313b5264d8271177bc64.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">serverless Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p><code>@neondatabase/serverless</code> is <a href="https://neon.tech">Neon</a>'s PostgreSQL driver for JavaScript and TypeScript. It's:</p>
<ul>
<li><b>Low-latency</b>, thanks to <a href="https://neon.tech/blog/quicker-serverless-postgres">message pipelining</a> and other optimizations</li>
<li><b>Ideal for serverless/edge</b> deployment, using https and WebSockets in place of TCP</li>
<li><b>A drop-in replacement</b> for <a href="https://node-postgres.com/">node-postgres</a>, aka <a href="https://www.npmjs.com/package/pg"><code>pg</code></a> (on which it's based)</li>
</ul>
<h1><a class="anchor" id="autotoc_md5016"></a>
Get started</h1>
<h2><a class="anchor" id="autotoc_md5017"></a>
Install it</h2>
<p>Install it with your preferred JavaScript package manager. It's named <code>@neondatabase/serverless</code> on npm and <code>@neon/serverless</code> on JSR. So, for example:</p>
<div class="fragment"><div class="line">npm install @neondatabase/serverless</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">bunx jsr add @neon/serverless</div>
</div><!-- fragment --><p>Using TypeScript? No worries: types are included either way.</p>
<h2><a class="anchor" id="autotoc_md5018"></a>
Configure it</h2>
<p>Get your connection string from the <a href="https://console.neon.tech/">Neon console</a> and set it as an environment variable. Something like:</p>
<div class="fragment"><div class="line">DATABASE_URL=postgres://username:password@host.neon.tech/neondb</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5019"></a>
Use it</h2>
<p>For one-shot queries, use the <code>neon</code> function. For instance:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line"> </div>
<div class="line">const [post] = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line">// `post` is now { id: 12, title: &#39;My post&#39;, ... } (or undefined)</div>
</div><!-- fragment --><p>Note: interpolating <code>${postId}</code> here is <a href="https://neon.tech/blog/sql-template-tags">safe from SQL injection</a>.</p>
<h2><a class="anchor" id="autotoc_md5020"></a>
Deploy it</h2>
<p>Turn this example into a complete API endpoint deployed on <a href="https://vercel.com/docs/concepts/functions/edge-functions">Vercel Edge Functions</a> at <code><a href="https://myapp.vercel.dev/api/post?postId=123">https://myapp.vercel.dev/api/post?postId=123</a></code> by following two simple steps:</p>
<ol type="1">
<li>Create a new file <code>api/post.ts</code>:</li>
</ol>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line"> </div>
<div class="line">export default async (req: Request, ctx: any) =&gt; {</div>
<div class="line">  // get and validate the `postId` query parameter</div>
<div class="line">  const postId = parseInt(new URL(req.url).searchParams.get(&#39;postId&#39;), 10);</div>
<div class="line">  if (isNaN(postId)) return new Response(&#39;Bad request&#39;, { status: 400 });</div>
<div class="line"> </div>
<div class="line">  // query and validate the post</div>
<div class="line">  const [post] = await sql`SELECT * FROM posts WHERE id = ${postId}`;</div>
<div class="line">  if (!post) return new Response(&#39;Not found&#39;, { status: 404 });</div>
<div class="line"> </div>
<div class="line">  // return the post as JSON</div>
<div class="line">  return new Response(JSON.stringify(post), { </div>
<div class="line">    headers: { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">export const config = {</div>
<div class="line">  runtime: &#39;edge&#39;,</div>
<div class="line">  regions: [&#39;iad1&#39;],  // specify the region nearest your Neon DB</div>
<div class="line">};</div>
</div><!-- fragment --><ol type="1">
<li>Test and deploy</li>
</ol>
<div class="fragment"><div class="line">npm install -g vercel  # install vercel CLI</div>
<div class="line">npx vercel env add DATABASE_URL  # paste Neon connection string, select all environments</div>
<div class="line">npx vercel dev  # check working locally, then ...</div>
<div class="line">npx vercel deploy</div>
</div><!-- fragment --><p>The <code>neon</code> query function has a few <a class="el" href="md_node__modules_2_0dneondatabase_2serverless_2_c_o_n_f_i_g.html">additional options</a>.</p>
<h1><a class="anchor" id="autotoc_md5021"></a>
Sessions, transactions, and node-postgres compatibility</h1>
<p>A query using the <code>neon</code> function, as shown above, is carried by an https <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a> request.</p>
<p>This should work — and work fast — from any modern JavaScript environment. But you can only send one query at a time this way: sessions and transactions are not supported.</p>
<h2><a class="anchor" id="autotoc_md5022"></a>
<code>transaction()</code></h2>
<p>Multiple queries can be issued via fetch request within a single, non-interactive transaction by using the <code>transaction()</code> function. This is exposed as a property on the query function.</p>
<p>For example:</p>
<div class="fragment"><div class="line">import { neon } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line">const sql = neon(process.env.DATABASE_URL);</div>
<div class="line">const showLatestN = 10;</div>
<div class="line"> </div>
<div class="line">const [posts, tags] = await sql.transaction([</div>
<div class="line">  sql`SELECT * FROM posts ORDER BY posted_at DESC LIMIT ${showLatestN}`,</div>
<div class="line">  sql`SELECT * FROM tags`,</div>
<div class="line">]);</div>
</div><!-- fragment --><p>There are some <a class="el" href="md_node__modules_2_0dneondatabase_2serverless_2_c_o_n_f_i_g.html">additional options</a> when using <code>transaction()</code>.</p>
<h2><a class="anchor" id="autotoc_md5023"></a>
<code>Pool</code> and <code>Client</code></h2>
<p>Use the <code>Pool</code> or <code>Client</code> constructors, instead of the functions described above, when you need:</p>
<ul>
<li><b>session or interactive transaction support</b>, and/or</li>
<li><b>compatibility with node-postgres</b>, which supports query libraries like <a href="https://kysely.dev/">Kysely</a> or <a href="https://jawj.github.io/zapatos/">Zapatos</a>.</li>
</ul>
<p>Queries using <code>Pool</code> and <code>Client</code> are carried by WebSockets. There are <b>two key things</b> to know about this:</p>
<ol type="1">
<li><b>In Node.js</b> and some other environments, there's no built-in WebSocket support. In these cases, supply a WebSocket constructor function.</li>
<li><p class="startli"><b>In serverless environments</b> such as Vercel Edge Functions or Cloudflare Workers, WebSocket connections can't outlive a single request.</p>
<p class="startli">That means <code>Pool</code> or <code>Client</code> objects must be connected, used and closed <b>within a single request handler</b>. Don't create them outside a request handler; don't create them in one handler and try to reuse them in another; and to avoid exhausting available connections, don't forget to close them.</p>
</li>
</ol>
<p>These points are demonstrated in the examples below.</p>
<h2><a class="anchor" id="autotoc_md5024"></a>
API</h2>
<ul>
<li><b>The full API guide</b> to <code>Pool</code> and <code>Client</code> can be found in the <a href="https://node-postgres.com/">node-postgres docs</a>.</li>
<li>There are a few <a class="el" href="md_node__modules_2_0dneondatabase_2serverless_2_c_o_n_f_i_g.html">additional configuration options</a> that apply to <code>Pool</code> and <code>Client</code> here.</li>
</ul>
<h1><a class="anchor" id="autotoc_md5025"></a>
Example: Node.js with <code>Pool.connect()</code></h1>
<p>In Node.js, it takes two lines to configure WebSocket support. For example:</p>
<div class="fragment"><div class="line">import { Pool, neonConfig } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line"> </div>
<div class="line">import ws from &#39;ws&#39;;</div>
<div class="line">neonConfig.webSocketConstructor = ws;  // &lt;-- this is the key bit</div>
<div class="line"> </div>
<div class="line">const pool = new Pool({ connectionString: process.env.DATABASE_URL });</div>
<div class="line">pool.on(&#39;error&#39;, err =&gt; console.error(err));  // deal with e.g. re-connect</div>
<div class="line">// ...</div>
<div class="line"> </div>
<div class="line">const client = await pool.connect();</div>
<div class="line"> </div>
<div class="line">try {</div>
<div class="line">  await client.query(&#39;BEGIN&#39;);</div>
<div class="line">  const { rows: [{ id: postId }] } = await client.query(&#39;INSERT INTO posts (title) VALUES ($1) RETURNING id&#39;, [&#39;Welcome&#39;]);</div>
<div class="line">  await client.query(&#39;INSERT INTO photos (post_id, url) VALUES ($1, $2)&#39;, [postId, &#39;s3.bucket/photo/url&#39;]);</div>
<div class="line">  await client.query(&#39;COMMIT&#39;);</div>
<div class="line"> </div>
<div class="line">} catch (err) {</div>
<div class="line">  await client.query(&#39;ROLLBACK&#39;);</div>
<div class="line">  throw err;</div>
<div class="line"> </div>
<div class="line">} finally {</div>
<div class="line">  client.release();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">// ...</div>
<div class="line">await pool.end();</div>
</div><!-- fragment --><p>Other WebSocket libraries are available. For example, you could replace <code>ws</code> in the above example with <code>undici</code>:</p>
<div class="fragment"><div class="line">import { WebSocket } from &#39;undici&#39;;</div>
<div class="line">neonConfig.webSocketConstructor = WebSocket; </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5026"></a>
Example: Vercel Edge Function with <code>Pool.query()</code></h1>
<p>We can rewrite the Vercel Edge Function shown above (under the heading 'Deploy it') to use <code>Pool</code>, as follows:</p>
<div class="fragment"><div class="line">import { Pool } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line"> </div>
<div class="line">// *don&#39;t* create a `Pool` or `Client` here, outside the request handler</div>
<div class="line"> </div>
<div class="line">export default async (req: Request, ctx: any) =&gt; {</div>
<div class="line">  // create a `Pool` inside the request handler</div>
<div class="line">  const pool = new Pool({ connectionString: process.env.DATABASE_URL });</div>
<div class="line"> </div>
<div class="line">  // get and validate the `postId` query parameter</div>
<div class="line">  const postId = parseInt(new URL(req.url).searchParams.get(&#39;postId&#39;), 10);</div>
<div class="line">  if (isNaN(postId)) return new Response(&#39;Bad request&#39;, { status: 400 });</div>
<div class="line"> </div>
<div class="line">  // query and validate the post</div>
<div class="line">  const [post] = await pool.query(&#39;SELECT * FROM posts WHERE id = $1&#39;, [postId]);</div>
<div class="line">  if (!post) return new Response(&#39;Not found&#39;, { status: 404 });</div>
<div class="line"> </div>
<div class="line">  // end the `Pool` inside the same request handler </div>
<div class="line">  // (unlike `await`, `ctx.waitUntil` won&#39;t hold up the response)</div>
<div class="line">  ctx.waitUntil(pool.end());</div>
<div class="line"> </div>
<div class="line">  // return the post as JSON</div>
<div class="line">  return new Response(JSON.stringify(post), { </div>
<div class="line">    headers: { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">export const config = {</div>
<div class="line">  runtime: &#39;edge&#39;,</div>
<div class="line">  regions: [&#39;iad1&#39;],  // specify the region nearest your Neon DB</div>
<div class="line">};</div>
</div><!-- fragment --><p>Note: we don't actually use the pooling capabilities of <code>Pool</code> in this example. But it's slightly briefer than using <code>Client</code> and, because <code>Pool.query</code> is designed for one-shot queries, we may in future automatically route these queries over https for lower latency.</p>
<h1><a class="anchor" id="autotoc_md5027"></a>
Example: Vercel Edge Function with <code>Client</code></h1>
<p>Using <code>Client</code> instead, the example looks like this:</p>
<div class="fragment"><div class="line">import { Client } from &#39;@neondatabase/serverless&#39;;</div>
<div class="line"> </div>
<div class="line">// don&#39;t create a `Pool` or `Client` here, outside the request handler</div>
<div class="line"> </div>
<div class="line">export default async (req: Request, ctx: any) =&gt; {</div>
<div class="line">  // create a `Client` inside the request handler</div>
<div class="line">  const client = new Client(process.env.DATABASE_URL);</div>
<div class="line">  await client.connect();</div>
<div class="line"> </div>
<div class="line">  // get and validate the `postId` query parameter</div>
<div class="line">  const postId = parseInt(new URL(req.url).searchParams.get(&#39;postId&#39;), 10);</div>
<div class="line">  if (isNaN(postId)) return new Response(&#39;Bad request&#39;, { status: 400 });</div>
<div class="line"> </div>
<div class="line">  // query and validate the post</div>
<div class="line">  const [post] = await client.query(&#39;SELECT * FROM posts WHERE id = $1&#39;, [postId]);</div>
<div class="line">  if (!post) return new Response(&#39;Not found&#39;, { status: 404 });</div>
<div class="line"> </div>
<div class="line">  // end the `Client` inside the same request handler </div>
<div class="line">  // (unlike `await`, `ctx.waitUntil` won&#39;t hold up the response)</div>
<div class="line">  ctx.waitUntil(client.end());</div>
<div class="line"> </div>
<div class="line">  // return the post as JSON</div>
<div class="line">  return new Response(JSON.stringify(post), { </div>
<div class="line">    headers: { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">export const config = {</div>
<div class="line">  runtime: &#39;edge&#39;,</div>
<div class="line">  regions: [&#39;iad1&#39;],  // specify the region nearest your Neon DB</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md5028"></a>
More examples</h1>
<p>These repos show how to use <code>@neondatabase/serverless</code> with a variety of environments and tools:</p>
<ul>
<li><a href="https://github.com/neondatabase/neon-vercel-rawsql">Raw SQL + Vercel Edge Functions</a></li>
<li><a href="https://github.com/neondatabase/neon-vercel-http">Raw SQL via https + Vercel Edge Functions</a></li>
<li><a href="https://github.com/neondatabase/serverless-cfworker-demo">Raw SQL + Cloudflare Workers</a></li>
<li><a href="https://github.com/neondatabase/neon-vercel-kysely">Kysely + Vercel Edge Functions</a></li>
<li><a href="https://github.com/neondatabase/neon-vercel-zapatos">Zapatos + Vercel Edge Functions</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md5029"></a>
Bring your own Postgres database</h1>
<p>This package comes configured to connect to a Neon database. But you can also use it to connect to your own Postgres instances if you <a class="el" href="md_node__modules_2_0dneondatabase_2serverless_2_d_e_p_l_o_y.html">run your own WebSocket proxy</a>.</p>
<h1><a class="anchor" id="autotoc_md5030"></a>
Open-source</h1>
<p>This code is released under the [MIT license](LICENSE).</p>
<h1><a class="anchor" id="autotoc_md5031"></a>
Feedback and support</h1>
<p>Please visit <a href="https://community.neon.tech/">Neon Community</a> or <a href="https://neon.tech/docs/introduction/support">Support</a>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_acd06b18086a0dd2ae699b1e0b775be8.html">node_modules</a></li><li class="navelem"><a class="el" href="dir_4dfb2c6eed5a289e2a3795ab7ab440b9.html">@neondatabase</a></li><li class="navelem"><a class="el" href="dir_88d000e696e5313b5264d8271177bc64.html">serverless</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
