\doxysection{node\+\_\+modules/selderee Directory Reference}
\hypertarget{dir_fc7e7895823e9dc5b006ddef05d58927}{}\label{dir_fc7e7895823e9dc5b006ddef05d58927}\index{node\_modules/selderee Directory Reference@{node\_modules/selderee Directory Reference}}


\doxysubsection{Detailed Description}
  \href{https://github.com/mxxii/selderee/blob/main/LICENSE}{\texttt{ }} \href{https://www.npmjs.com/package/selderee}{\texttt{ }}

{\bfseries{Sel\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}ectors \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}de\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}cision t\texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}ree}} -\/ pick matching selectors, fast.

\DoxyHorRuler{0}
\hypertarget{README.md_autotoc_md30316}{}\doxysubsection{\texorpdfstring{What is it for}{What is it for}}\label{README.md_autotoc_md30316}
The problem statement\+: there are multiple CSS selectors with attached handlers, and a HTML DOM to process. For each HTML Element a matching handler has to be found and applied.

The naive approach is to walk through the DOM and test each and every selector against each Element. This means {\itshape O(n\texorpdfstring{$\ast$}{*}m)} complexity.

It is pretty clear though that if we have selectors that share something in common then we can reduce the number of checks.

The main {\ttfamily selderee} package offers the selectors tree structure. Runnable decision functions for specific DOM implementations are built via plugins.\hypertarget{README.md_autotoc_md30317}{}\doxysubsection{\texorpdfstring{Limitations}{Limitations}}\label{README.md_autotoc_md30317}

\begin{DoxyItemize}
\item Pseudo-\/classes and pseudo-\/elements are not supported by the underlying library \href{https://github.com/mxxii/parseley}{\texttt{ parseley}} (yet?);
\item General siblings ({\ttfamily \texorpdfstring{$\sim$}{\string~}}), descendants ({\ttfamily  }) and same column combinators ({\ttfamily \texorpdfstring{$\vert$}{|}\texorpdfstring{$\vert$}{|}}) are also not supported.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md30318}{}\doxysubsection{\texorpdfstring{{\ttfamily selderee} vs {\ttfamily css-\/select}}{{\ttfamily selderee} vs {\ttfamily css-\/select}}}\label{README.md_autotoc_md30318}
\href{https://github.com/fb55/css-select}{\texttt{ css-\/select}} -\/ a CSS selector compiler \& engine.

\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily selderee}   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily css-\/select}    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Feature   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily selderee}   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily css-\/select}    }\\\cline{1-3}
\endhead
Support for {\ttfamily htmlparser2} DOM AST   &\PBS\centering plugin   &\PBS\centering +    \\\cline{1-3}
"{}\+Compiles"{} into a function   &\PBS\centering +   &\PBS\centering +    \\\cline{1-3}
Pick selector(s) for a given Element   &\PBS\centering +   &\PBS\centering \\\cline{1-3}
Query Element(s) for a given selector   &\PBS\centering &\PBS\centering +   \\\cline{1-3}
\end{longtabu}
\hypertarget{README.md_autotoc_md30319}{}\doxysubsection{\texorpdfstring{Packages}{Packages}}\label{README.md_autotoc_md30319}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{4}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Package   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Version   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Folder   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Changelog    }\\\cline{1-4}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Package   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Version   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Folder   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Changelog    }\\\cline{1-4}
\endhead
\href{https://www.npmjs.com/package/selderee}{\texttt{ selderee}}   &\href{https://www.npmjs.com/package/selderee}{\texttt{ }}   &\href{https://github.com/mxxii/selderee/tree/main/packages/selderee/}{\texttt{ /packages/selderee}}   &\href{https://github.com/mxxii/selderee/blob/main/packages/selderee/CHANGELOG.md}{\texttt{ changelog}}    \\\cline{1-4}
\href{https://www.npmjs.com/package/@selderee/plugin-htmlparser2}{\texttt{ @selderee/plugin-\/htmlparser2}}   &\href{https://www.npmjs.com/package/@selderee/plugin-htmlparser2}{\texttt{ }}   &\href{https://github.com/mxxii/selderee/tree/main/packages/plugin-htmlparser2/}{\texttt{ /packages/plugin-\/htmlparser2}}   &\href{https://github.com/mxxii/selderee/blob/main/packages/plugin-htmlparser2/CHANGELOG.md}{\texttt{ changelog}}   \\\cline{1-4}
\end{longtabu}
\hypertarget{README.md_autotoc_md30320}{}\doxysubsection{\texorpdfstring{Install}{Install}}\label{README.md_autotoc_md30320}

\begin{DoxyCode}{0}
\DoxyCodeLine{>\ npm\ i\ selderee\ @selderee/plugin-\/htmlparser2}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md30321}{}\doxysubsection{\texorpdfstring{Documentation}{Documentation}}\label{README.md_autotoc_md30321}

\begin{DoxyItemize}
\item \href{https://github.com/mxxii/selderee/blob/main/docs/index.md}{\texttt{ API}}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md30322}{}\doxysubsection{\texorpdfstring{Usage example}{Usage example}}\label{README.md_autotoc_md30322}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ htmlparser2\ =\ require('htmlparser2');}
\DoxyCodeLine{const\ util\ =\ require('util');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ \{\ DecisionTree,\ Treeify\ \}\ =\ require('selderee');}
\DoxyCodeLine{const\ \{\ hp2Builder\ \}\ =\ require('@selderee/plugin-\/htmlparser2');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ selectorValuePairs\ =\ [}
\DoxyCodeLine{\ \ ['p',\ 'A'],}
\DoxyCodeLine{\ \ ['p.foo[bar]',\ 'B'],}
\DoxyCodeLine{\ \ ['p[class\string~=foo]',\ 'C'],}
\DoxyCodeLine{\ \ ['div.foo',\ 'D'],}
\DoxyCodeLine{\ \ ['div\ >\ p.foo',\ 'E'],}
\DoxyCodeLine{\ \ ['div\ >\ p',\ 'F'],}
\DoxyCodeLine{\ \ ['\#baz',\ 'G']}
\DoxyCodeLine{];}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Make\ a\ tree\ structure\ from\ all\ given\ selectors.}
\DoxyCodeLine{const\ selectorsDecisionTree\ =\ new\ DecisionTree(selectorValuePairs);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ \`{}treeify`\ builder\ produces\ a\ string\ output\ for\ testing\ and\ debug\ purposes.}
\DoxyCodeLine{//\ \`{}treeify`\ expects\ string\ values\ attached\ to\ each\ selector.}
\DoxyCodeLine{const\ prettyTree\ =\ selectorsDecisionTree.build(Treeify.treeify);}
\DoxyCodeLine{console.log(prettyTree);}
\DoxyCodeLine{}
\DoxyCodeLine{const\ html\ =\ /*html*/`<html><body>}
\DoxyCodeLine{\ \ <div><p\ class="{}foo\ qux"{}>second</p></div>}
\DoxyCodeLine{</body></html>`;}
\DoxyCodeLine{const\ dom\ =\ htmlparser2.parseDocument(html);}
\DoxyCodeLine{const\ element\ =\ dom.children[0].children[0].children[1].children[0];}
\DoxyCodeLine{}
\DoxyCodeLine{//\ \`{}hp2Builder`\ produces\ a\ picker\ that\ can\ pick\ values}
\DoxyCodeLine{//\ from\ the\ selectors\ tree.}
\DoxyCodeLine{const\ picker\ =\ selectorsDecisionTree.build(hp2Builder);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Get\ all\ matches}
\DoxyCodeLine{const\ allMatches\ =\ picker.pickAll(element);}
\DoxyCodeLine{console.log(util.inspect(allMatches,\ \{\ breakLength:\ 70,\ depth:\ null\ \}));}
\DoxyCodeLine{}
\DoxyCodeLine{//\ or\ get\ the\ value\ from\ the\ most\ specific\ match.}
\DoxyCodeLine{const\ bestMatch\ =\ picker.pick1(element);}
\DoxyCodeLine{console.log(`Best\ matched\ value:\ \$\{bestMatch\}`);}

\end{DoxyCode}




{\bfseries{Example output}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyCode}{0}
\DoxyCodeLine{▽}
\DoxyCodeLine{├─◻\ Tag\ name}
\DoxyCodeLine{│\ ╟─◇\ =\ p}
\DoxyCodeLine{│\ ║\ ┠─▣\ Attr\ value:\ class}
\DoxyCodeLine{│\ ║\ ┃\ ╙─◈\ \string~=\ "{}foo"{}}
\DoxyCodeLine{│\ ║\ ┃\ \ \ ┠─◨\ Attr\ presence:\ bar}
\DoxyCodeLine{│\ ║\ ┃\ \ \ ┃\ ┖─◁\ \#1\ [0,2,1]\ B}
\DoxyCodeLine{│\ ║\ ┃\ \ \ ┠─◁\ \#2\ [0,1,1]\ C}
\DoxyCodeLine{│\ ║\ ┃\ \ \ ┖─◉\ Push\ element:\ >}
\DoxyCodeLine{│\ ║\ ┃\ \ \ \ \ └─◻\ Tag\ name}
\DoxyCodeLine{│\ ║\ ┃\ \ \ \ \ \ \ ╙─◇\ =\ div}
\DoxyCodeLine{│\ ║\ ┃\ \ \ \ \ \ \ \ \ ┖─◁\ \#4\ [0,1,2]\ E}
\DoxyCodeLine{│\ ║\ ┠─◁\ \#0\ [0,0,1]\ A}
\DoxyCodeLine{│\ ║\ ┖─◉\ Push\ element:\ >}
\DoxyCodeLine{│\ ║\ \ \ └─◻\ Tag\ name}
\DoxyCodeLine{│\ ║\ \ \ \ \ ╙─◇\ =\ div}
\DoxyCodeLine{│\ ║\ \ \ \ \ \ \ ┖─◁\ \#5\ [0,0,2]\ F}
\DoxyCodeLine{│\ ╙─◇\ =\ div}
\DoxyCodeLine{│\ \ \ ┖─▣\ Attr\ value:\ class}
\DoxyCodeLine{│\ \ \ \ \ ╙─◈\ \string~=\ "{}foo"{}}
\DoxyCodeLine{│\ \ \ \ \ \ \ ┖─◁\ \#3\ [0,1,1]\ D}
\DoxyCodeLine{└─▣\ Attr\ value:\ id}
\DoxyCodeLine{\ \ ╙─◈\ =\ "{}baz"{}}
\DoxyCodeLine{\ \ \ \ ┖─◁\ \#6\ [1,0,0]\ G}
\DoxyCodeLine{[\ \{\ index:\ 2,\ value:\ 'C',\ specificity:\ [\ 0,\ 1,\ 1\ ]\ \},}
\DoxyCodeLine{\ \ \{\ index:\ 4,\ value:\ 'E',\ specificity:\ [\ 0,\ 1,\ 2\ ]\ \},}
\DoxyCodeLine{\ \ \{\ index:\ 0,\ value:\ 'A',\ specificity:\ [\ 0,\ 0,\ 1\ ]\ \},}
\DoxyCodeLine{\ \ \{\ index:\ 5,\ value:\ 'F',\ specificity:\ [\ 0,\ 0,\ 2\ ]\ \}\ ]}
\DoxyCodeLine{Best\ matched\ value:\ E}

\end{DoxyCode}


{\itshape Some gotcha\+: you may notice the check for {\ttfamily \#baz} has to be performed every time the decision tree is called. If it happens to be {\ttfamily p\#baz} or {\ttfamily div\#baz} or even {\ttfamily .foo\#baz} -\/ it would be much better to write it like this. Deeper, narrower tree means less checks on average. (in case of {\ttfamily .foo\#baz} the class check might finally outweigh the tag name check and rebalance the tree.)}

\end{adjustwidth}
\hypertarget{README.md_autotoc_md30323}{}\doxysubsection{\texorpdfstring{Development}{Development}}\label{README.md_autotoc_md30323}
Targeting Node.\+js version \texorpdfstring{$>$}{>}=14.

Monorepo uses NPM v7 workspaces (make sure v7 is installed when used with Node.\+js v14.) 