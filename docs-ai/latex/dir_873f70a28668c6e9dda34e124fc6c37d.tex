\doxysection{node\+\_\+modules/code-\/red Directory Reference}
\hypertarget{dir_873f70a28668c6e9dda34e124fc6c37d}{}\label{dir_873f70a28668c6e9dda34e124fc6c37d}\index{node\_modules/code-\/red Directory Reference@{node\_modules/code-\/red Directory Reference}}


\doxysubsection{Detailed Description}
Experimental toolkit for writing x-\/to-\/\+Java\+Script compilers. It is used in \href{https://svelte.dev}{\texttt{ Svelte}}.\hypertarget{README.md_autotoc_md10654}{}\doxysubsection{\texorpdfstring{API}{API}}\label{README.md_autotoc_md10654}
The {\ttfamily code-\/red} package exposes three core functions — {\ttfamily b}, {\ttfamily x} and {\ttfamily print}.

{\ttfamily b} and {\ttfamily x} take a template literal and return an \href{https://github.com/estree/estree}{\texttt{ ESTree}} program body, or a single node\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ b,\ x\ \}\ from\ 'code-\/red';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ expression\ =\ x`i\ +\ j`;}
\DoxyCodeLine{}
\DoxyCodeLine{assert.equal(expression.type,\ 'AssignmentExpression');}
\DoxyCodeLine{assert.equal(expression.operator,\ '+');}
\DoxyCodeLine{assert.equal(expression.left.name,\ 'i');}
\DoxyCodeLine{assert.equal(expression.right.name,\ 'j');}
\DoxyCodeLine{}
\DoxyCodeLine{const\ body\ =\ b`}
\DoxyCodeLine{\ \ \ \ const\ i\ =\ 1;}
\DoxyCodeLine{\ \ \ \ const\ j\ =\ 2;}
\DoxyCodeLine{\ \ \ \ const\ k\ =\ i\ +\ j;}
\DoxyCodeLine{\`{};}
\DoxyCodeLine{}
\DoxyCodeLine{assert.equal(body.length,\ 3);}
\DoxyCodeLine{assert.equal(body[0].type,\ 'VariableDeclaration');}

\end{DoxyCode}


Expressions in template literals correspond to replacement nodes — so you could express the above like so\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ i\ =\ x`i`;}
\DoxyCodeLine{const\ j\ =\ x`j`;}
\DoxyCodeLine{const\ expression\ =\ x`\$\{i\}\ +\ \$\{j\}`;}
\DoxyCodeLine{}
\DoxyCodeLine{const\ body\ =\ b`}
\DoxyCodeLine{\ \ \ \ const\ \$\{i\}\ =\ 1;}
\DoxyCodeLine{\ \ \ \ const\ \$\{j\}\ =\ 2;}
\DoxyCodeLine{\ \ \ \ const\ k\ =\ \$\{expression\};}
\DoxyCodeLine{\`{};}

\end{DoxyCode}


The {\ttfamily print} function takes a node and turns it into a {\ttfamily \{code, map\}} object\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ add\ =\ x`}
\DoxyCodeLine{\ \ \ \ function\ add(\$\{i\},\ \$\{j\})\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ \$\{expression\};}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\`{};}
\DoxyCodeLine{}
\DoxyCodeLine{print(add).code;}
\DoxyCodeLine{/*}
\DoxyCodeLine{function\ add(i,\ j)\ \{}
\DoxyCodeLine{\ \ \ \ return\ i\ +\ j;}
\DoxyCodeLine{\}}
\DoxyCodeLine{*/}
\DoxyCodeLine{}
\DoxyCodeLine{i.name\ =\ 'foo';}
\DoxyCodeLine{j.name\ =\ 'bar';}
\DoxyCodeLine{}
\DoxyCodeLine{print(add).code;}
\DoxyCodeLine{/*}
\DoxyCodeLine{function\ add(foo,\ bar)\ \{}
\DoxyCodeLine{\ \ \ \ return\ foo\ +\ bar;}
\DoxyCodeLine{\}}
\DoxyCodeLine{*/}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md10655}{}\doxysubsection{\texorpdfstring{Prefixes}{Prefixes}}\label{README.md_autotoc_md10655}
\hypertarget{README.md_autotoc_md10656}{}\doxysubsubsection{\texorpdfstring{{\ttfamily @}-\/prefixed names (replaceable globals)}{{\ttfamily @}-\/prefixed names (replaceable globals)}}\label{README.md_autotoc_md10656}
So that you can use globals in your code. In Svelte, we use this to insert utility functions.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ input}
\DoxyCodeLine{import\ \{\ x\ \}\ from\ 'code-\/red';}
\DoxyCodeLine{x`@foo(bar)`}
\DoxyCodeLine{}
\DoxyCodeLine{//\ output}
\DoxyCodeLine{FOO(bar)}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md10657}{}\doxysubsubsection{\texorpdfstring{{\ttfamily \#}-\/prefixed names (automatically deconflicted names)}{{\ttfamily \#}-\/prefixed names (automatically deconflicted names)}}\label{README.md_autotoc_md10657}
So that you can insert variables in your code without worrying if they clash with existing variable names.

{\ttfamily bar} used in user code and in inserted code gets a {\ttfamily \$1} suffix\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ input}
\DoxyCodeLine{import\ \{\ x\ \}\ from\ 'code-\/red';}
\DoxyCodeLine{x`}
\DoxyCodeLine{function\ foo(\#bar)\ \{}
\DoxyCodeLine{\ \ \ \ return\ \#bar\ *\ bar;}
\DoxyCodeLine{\}`;}
\DoxyCodeLine{}
\DoxyCodeLine{//\ output}
\DoxyCodeLine{function\ foo(bar\$1)\ \{}
\DoxyCodeLine{\ \ \ \ return\ bar\$1\ *\ bar;}
\DoxyCodeLine{\}}

\end{DoxyCode}


Without conflicts, no {\ttfamily \$1} suffix\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ input}
\DoxyCodeLine{import\ \{\ b\ \}\ from\ 'code-\/red';}
\DoxyCodeLine{b`const\ foo\ =\ \#bar\ =>\ \#bar\ *\ 2`;}
\DoxyCodeLine{}
\DoxyCodeLine{//\ output}
\DoxyCodeLine{const\ foo\ =\ bar\ =>\ bar\ *\ 2;}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md10658}{}\doxysubsection{\texorpdfstring{Optimiser}{Optimiser}}\label{README.md_autotoc_md10658}
TODO add an optimiser that e.\+g. collapses consecutive identical if blocks\hypertarget{README.md_autotoc_md10659}{}\doxysubsection{\texorpdfstring{Compiler}{Compiler}}\label{README.md_autotoc_md10659}
TODO add a {\ttfamily code-\/red/compiler} module that replaces template literals with the nodes they evaluate to, so that there\textquotesingle{}s nothing to parse at runtime.\hypertarget{README.md_autotoc_md10660}{}\doxysubsection{\texorpdfstring{Sourcemaps}{Sourcemaps}}\label{README.md_autotoc_md10660}
TODO support source mappings for inserted nodes with location information.\hypertarget{README.md_autotoc_md10661}{}\doxysubsection{\texorpdfstring{License}{License}}\label{README.md_autotoc_md10661}
\mbox{[}MIT\mbox{]}(LICENSE) 