\doxysection{node\+\_\+modules/unstorage/node\+\_\+modules/chokidar Directory Reference}
\hypertarget{dir_2bbb4c8e831cc5b512059362af36bed0}{}\label{dir_2bbb4c8e831cc5b512059362af36bed0}\index{node\_modules/unstorage/node\_modules/chokidar Directory Reference@{node\_modules/unstorage/node\_modules/chokidar Directory Reference}}


\doxysubsection{Detailed Description}
\begin{quote}
Minimal and efficient cross-\/platform file watching library \end{quote}
\hypertarget{README.md_autotoc_md34507}{}\doxysubsection{\texorpdfstring{Why?}{Why?}}\label{README.md_autotoc_md34507}
There are many reasons to prefer Chokidar to raw fs.\+watch / fs.\+watch\+File in 2024\+:


\begin{DoxyItemize}
\item Events are properly reported
\begin{DoxyItemize}
\item mac\+OS events report filenames
\item events are not reported twice
\item changes are reported as add / change / unlink instead of useless {\ttfamily rename}
\end{DoxyItemize}
\item Atomic writes are supported, using {\ttfamily atomic} option
\begin{DoxyItemize}
\item Some file editors use them
\end{DoxyItemize}
\item Chunked writes are supported, using {\ttfamily await\+Write\+Finish} option
\begin{DoxyItemize}
\item Large files are commonly written in chunks
\end{DoxyItemize}
\item File / dir filtering is supported
\item Symbolic links are supported
\item Recursive watching is always supported, instead of partial when using raw events
\begin{DoxyItemize}
\item Includes a way to limit recursion depth
\end{DoxyItemize}
\end{DoxyItemize}

Chokidar relies on the Node.\+js core {\ttfamily fs} module, but when using {\ttfamily fs.\+watch} and {\ttfamily fs.\+watch\+File} for watching, it normalizes the events it receives, often checking for truth by getting file stats and/or dir contents. The {\ttfamily fs.\+watch}-\/based implementation is the default, which avoids polling and keeps CPU usage down. Be advised that chokidar will initiate watchers recursively for everything within scope of the paths that have been specified, so be judicious about not wasting system resources by watching much more than needed. For some cases, {\ttfamily fs.\+watch\+File}, which utilizes polling and uses more resources, is used.

Made for \href{https://brunch.io/}{\texttt{ Brunch}} in 2012, it is now used in \href{https://www.npmjs.com/browse/depended/chokidar}{\texttt{ \texorpdfstring{$\sim$}{\string~}30 million repositories}} and has proven itself in production environments.

{\bfseries{Sep 2024 update\+:}} v4 is out! It decreases dependency count from 13 to 1, removes support for globs, adds support for ESM / Common.\+js modules, and bumps minimum node.\+js version from v8 to v14. Check out upgrading.\hypertarget{README.md_autotoc_md34508}{}\doxysubsection{\texorpdfstring{Getting started}{Getting started}}\label{README.md_autotoc_md34508}
Install with npm\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ chokidar}

\end{DoxyCode}


Use it in your code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ chokidar\ from\ 'chokidar';}
\DoxyCodeLine{}
\DoxyCodeLine{//\ One-\/liner\ for\ current\ directory}
\DoxyCodeLine{chokidar.watch('.').on('all',\ (event,\ path)\ =>\ \{}
\DoxyCodeLine{\ \ console.log(event,\ path);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Extended\ options}
\DoxyCodeLine{//\ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Initialize\ watcher.}
\DoxyCodeLine{const\ watcher\ =\ chokidar.watch('file,\ dir,\ or\ array',\ \{}
\DoxyCodeLine{\ \ ignored:\ (path,\ stats)\ =>\ stats?.isFile()\ \&\&\ !path.endsWith('.js'),\ //\ only\ watch\ js\ files}
\DoxyCodeLine{\ \ persistent:\ true}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Something\ to\ use\ when\ events\ are\ received.}
\DoxyCodeLine{const\ log\ =\ console.log.bind(console);}
\DoxyCodeLine{//\ Add\ event\ listeners.}
\DoxyCodeLine{watcher}
\DoxyCodeLine{\ \ .on('add',\ path\ =>\ log(`File\ \$\{path\}\ has\ been\ added`))}
\DoxyCodeLine{\ \ .on('change',\ path\ =>\ log(`File\ \$\{path\}\ has\ been\ changed`))}
\DoxyCodeLine{\ \ .on('unlink',\ path\ =>\ log(`File\ \$\{path\}\ has\ been\ removed`));}
\DoxyCodeLine{}
\DoxyCodeLine{//\ More\ possible\ events.}
\DoxyCodeLine{watcher}
\DoxyCodeLine{\ \ .on('addDir',\ path\ =>\ log(`Directory\ \$\{path\}\ has\ been\ added`))}
\DoxyCodeLine{\ \ .on('unlinkDir',\ path\ =>\ log(`Directory\ \$\{path\}\ has\ been\ removed`))}
\DoxyCodeLine{\ \ .on('error',\ error\ =>\ log(`Watcher\ error:\ \$\{error\}`))}
\DoxyCodeLine{\ \ .on('ready',\ ()\ =>\ log('Initial\ scan\ complete.\ Ready\ for\ changes'))}
\DoxyCodeLine{\ \ .on('raw',\ (event,\ path,\ details)\ =>\ \{\ //\ internal}
\DoxyCodeLine{\ \ \ \ log('Raw\ event\ info:',\ event,\ path,\ details);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ 'add',\ 'addDir'\ and\ 'change'\ events\ also\ receive\ stat()\ results\ as\ second}
\DoxyCodeLine{//\ argument\ when\ available:\ https://nodejs.org/api/fs.html\#fs\_class\_fs\_stats}
\DoxyCodeLine{watcher.on('change',\ (path,\ stats)\ =>\ \{}
\DoxyCodeLine{\ \ if\ (stats)\ console.log(`File\ \$\{path\}\ changed\ size\ to\ \$\{stats.size\}`);}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Watch\ new\ files.}
\DoxyCodeLine{watcher.add('new-\/file');}
\DoxyCodeLine{watcher.add(['new-\/file-\/2',\ 'new-\/file-\/3']);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Get\ list\ of\ actual\ paths\ being\ watched\ on\ the\ filesystem}
\DoxyCodeLine{let\ watchedPaths\ =\ watcher.getWatched();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Un-\/watch\ some\ files.}
\DoxyCodeLine{await\ watcher.unwatch('new-\/file');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Stop\ watching.\ The\ method\ is\ async!}
\DoxyCodeLine{await\ watcher.close().then(()\ =>\ console.log('closed'));}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Full\ list\ of\ options.\ See\ below\ for\ descriptions.}
\DoxyCodeLine{//\ Do\ not\ use\ this\ example!}
\DoxyCodeLine{chokidar.watch('file',\ \{}
\DoxyCodeLine{\ \ persistent:\ true,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ ignore\ .txt\ files}
\DoxyCodeLine{\ \ ignored:\ (file)\ =>\ file.endsWith('.txt'),}
\DoxyCodeLine{\ \ //\ watch\ only\ .txt\ files}
\DoxyCodeLine{\ \ //\ ignored:\ (file,\ \_stats)\ =>\ \_stats?.isFile()\ \&\&\ !file.endsWith('.txt'),}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ awaitWriteFinish:\ true,\ //\ emit\ single\ event\ when\ chunked\ writes\ are\ completed}
\DoxyCodeLine{\ \ atomic:\ true,\ //\ emit\ proper\ events\ when\ "{}atomic\ writes"{}\ (mv\ \_tmp\ file)\ are\ used}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ The\ options\ also\ allow\ specifying\ custom\ intervals\ in\ ms}
\DoxyCodeLine{\ \ //\ awaitWriteFinish:\ \{}
\DoxyCodeLine{\ \ //\ \ \ stabilityThreshold:\ 2000,}
\DoxyCodeLine{\ \ //\ \ \ pollInterval:\ 100}
\DoxyCodeLine{\ \ //\ \},}
\DoxyCodeLine{\ \ //\ atomic:\ 100,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ interval:\ 100,}
\DoxyCodeLine{\ \ binaryInterval:\ 300,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ cwd:\ '.',}
\DoxyCodeLine{\ \ depth:\ 99,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ followSymlinks:\ true,}
\DoxyCodeLine{\ \ ignoreInitial:\ false,}
\DoxyCodeLine{\ \ ignorePermissionErrors:\ false,}
\DoxyCodeLine{\ \ usePolling:\ false,}
\DoxyCodeLine{\ \ alwaysStat:\ false,}
\DoxyCodeLine{\});}

\end{DoxyCode}


{\ttfamily chokidar.\+watch(paths, \mbox{[}options\mbox{]})}


\begin{DoxyItemize}
\item {\ttfamily paths} (string or array of strings). Paths to files, dirs to be watched recursively.
\item {\ttfamily options} (object) Options object as defined below\+:
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34509}{}\doxysubsubsubsection{\texorpdfstring{Persistence}{Persistence}}\label{README.md_autotoc_md34509}

\begin{DoxyItemize}
\item {\ttfamily persistent} (default\+: {\ttfamily true}). Indicates whether the process should continue to run as long as files are being watched.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34510}{}\doxysubsubsubsection{\texorpdfstring{Path filtering}{Path filtering}}\label{README.md_autotoc_md34510}

\begin{DoxyItemize}
\item {\ttfamily ignored} function, regex, or path. Defines files/paths to be ignored. The whole relative or absolute path is tested, not just filename. If a function with two arguments is provided, it gets called twice per path -\/ once with a single argument (the path), second time with two arguments (the path and the \href{https://nodejs.org/api/fs.html\#fs_class_fs_stats}{\texttt{ {\ttfamily fs.\+Stats}}} object of that path).
\item {\ttfamily ignore\+Initial} (default\+: {\ttfamily false}). If set to {\ttfamily false} then {\ttfamily add}/{\ttfamily add\+Dir} events are also emitted for matching paths while instantiating the watching as chokidar discovers these file paths (before the {\ttfamily ready} event).
\item {\ttfamily follow\+Symlinks} (default\+: {\ttfamily true}). When {\ttfamily false}, only the symlinks themselves will be watched for changes instead of following the link references and bubbling events through the link\textquotesingle{}s path.
\item {\ttfamily cwd} (no default). The base directory from which watch {\ttfamily paths} are to be derived. Paths emitted with events will be relative to this.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34511}{}\doxysubsubsubsection{\texorpdfstring{Performance}{Performance}}\label{README.md_autotoc_md34511}

\begin{DoxyItemize}
\item {\ttfamily use\+Polling} (default\+: {\ttfamily false}). Whether to use fs.\+watch\+File (backed by polling), or fs.\+watch. If polling leads to high CPU utilization, consider setting this to {\ttfamily false}. It is typically necessary to {\bfseries{set this to {\ttfamily true} to successfully watch files over a network}}, and it may be necessary to successfully watch files in other non-\/standard situations. Setting to {\ttfamily true} explicitly on Mac\+OS overrides the {\ttfamily use\+Fs\+Events} default. You may also set the CHOKIDAR\+\_\+\+USEPOLLING env variable to true (1) or false (0) in order to override this option.
\item {\itshape Polling-\/specific settings} (effective when {\ttfamily use\+Polling\+: true})
\begin{DoxyItemize}
\item {\ttfamily interval} (default\+: {\ttfamily 100}). Interval of file system polling, in milliseconds. You may also set the CHOKIDAR\+\_\+\+INTERVAL env variable to override this option.
\item {\ttfamily binary\+Interval} (default\+: {\ttfamily 300}). Interval of file system polling for binary files. (\href{https://github.com/sindresorhus/binary-extensions/blob/master/binary-extensions.json}{\texttt{ see list of binary extensions}})
\end{DoxyItemize}
\item {\ttfamily always\+Stat} (default\+: {\ttfamily false}). If relying upon the \href{https://nodejs.org/api/fs.html\#fs_class_fs_stats}{\texttt{ {\ttfamily fs.\+Stats}}} object that may get passed with {\ttfamily add}, {\ttfamily add\+Dir}, and {\ttfamily change} events, set this to {\ttfamily true} to ensure it is provided even in cases where it wasn\textquotesingle{}t already available from the underlying watch events.
\item {\ttfamily depth} (default\+: {\ttfamily undefined}). If set, limits how many levels of subdirectories will be traversed.
\item {\ttfamily await\+Write\+Finish} (default\+: {\ttfamily false}). By default, the {\ttfamily add} event will fire when a file first appears on disk, before the entire file has been written. Furthermore, in some cases some {\ttfamily change} events will be emitted while the file is being written. In some cases, especially when watching for large files there will be a need to wait for the write operation to finish before responding to a file creation or modification. Setting {\ttfamily await\+Write\+Finish} to {\ttfamily true} (or a truthy value) will poll file size, holding its {\ttfamily add} and {\ttfamily change} events until the size does not change for a configurable amount of time. The appropriate duration setting is heavily dependent on the OS and hardware. For accurate detection this parameter should be relatively high, making file watching much less responsive. Use with caution.
\begin{DoxyItemize}
\item {\itshape {\ttfamily options.\+await\+Write\+Finish} can be set to an object in order to adjust timing params\+:}
\item {\ttfamily await\+Write\+Finish.\+stability\+Threshold} (default\+: 2000). Amount of time in milliseconds for a file size to remain constant before emitting its event.
\item {\ttfamily await\+Write\+Finish.\+poll\+Interval} (default\+: 100). File size polling interval, in milliseconds.
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34512}{}\doxysubsubsubsection{\texorpdfstring{Errors}{Errors}}\label{README.md_autotoc_md34512}

\begin{DoxyItemize}
\item {\ttfamily ignore\+Permission\+Errors} (default\+: {\ttfamily false}). Indicates whether to watch files that don\textquotesingle{}t have read permissions if possible. If watching fails due to {\ttfamily EPERM} or {\ttfamily EACCES} with this set to {\ttfamily true}, the errors will be suppressed silently.
\item {\ttfamily atomic} (default\+: {\ttfamily true} if {\ttfamily use\+Fs\+Events} and {\ttfamily use\+Polling} are {\ttfamily false}). Automatically filters out artifacts that occur when using editors that use "{}atomic writes"{} instead of writing directly to the source file. If a file is re-\/added within 100 ms of being deleted, Chokidar emits a {\ttfamily change} event rather than {\ttfamily unlink} then {\ttfamily add}. If the default of 100 ms does not work well for you, you can override it by setting {\ttfamily atomic} to a custom value, in milliseconds.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34513}{}\doxysubsubsection{\texorpdfstring{Methods \& Events}{Methods \& Events}}\label{README.md_autotoc_md34513}
{\ttfamily chokidar.\+watch()} produces an instance of {\ttfamily FSWatcher}. Methods of {\ttfamily FSWatcher}\+:


\begin{DoxyItemize}
\item {\ttfamily .add(path / paths)}\+: Add files, directories for tracking. Takes an array of strings or just one string.
\item {\ttfamily .on(event, callback)}\+: Listen for an FS event. Available events\+: {\ttfamily add}, {\ttfamily add\+Dir}, {\ttfamily change}, {\ttfamily unlink}, {\ttfamily unlink\+Dir}, {\ttfamily ready}, {\ttfamily raw}, {\ttfamily error}. Additionally {\ttfamily all} is available which gets emitted with the underlying event name and path for every event other than {\ttfamily ready}, {\ttfamily raw}, and {\ttfamily error}. {\ttfamily raw} is internal, use it carefully.
\item {\ttfamily .unwatch(path / paths)}\+: Stop watching files or directories. Takes an array of strings or just one string.
\item {\ttfamily .close()}\+: {\bfseries{async}} Removes all listeners from watched files. Asynchronous, returns Promise. Use with {\ttfamily await} to ensure bugs don\textquotesingle{}t happen.
\item {\ttfamily .get\+Watched()}\+: Returns an object representing all the paths on the file system being watched by this {\ttfamily FSWatcher} instance. The object\textquotesingle{}s keys are all the directories (using absolute paths unless the {\ttfamily cwd} option was used), and the values are arrays of the names of the items contained in each directory.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34514}{}\doxysubsubsection{\texorpdfstring{CLI}{CLI}}\label{README.md_autotoc_md34514}
Check out third party \href{https://github.com/open-cli-tools/chokidar-cli}{\texttt{ chokidar-\/cli}}, which allows to execute a command on each change, or get a stdio stream of change events.\hypertarget{README.md_autotoc_md34515}{}\doxysubsection{\texorpdfstring{Troubleshooting}{Troubleshooting}}\label{README.md_autotoc_md34515}
Sometimes, Chokidar runs out of file handles, causing {\ttfamily EMFILE} and {\ttfamily ENOSP} errors\+:


\begin{DoxyItemize}
\item {\ttfamily bash\+: cannot set terminal process group (-\/1)\+: Inappropriate ioctl for device bash\+: no job control in this shell}
\item {\ttfamily Error\+: watch /home/ ENOSPC}
\end{DoxyItemize}

There are two things that can cause it.


\begin{DoxyEnumerate}
\item Exhausted file handles for generic fs operations
\begin{DoxyItemize}
\item Can be solved by using \href{https://www.npmjs.com/package/graceful-fs}{\texttt{ graceful-\/fs}}, which can monkey-\/patch native {\ttfamily fs} module used by chokidar\+: `let fs = require(\textquotesingle{}fs'); let grfs = require(\textquotesingle{}graceful-\/fs\textquotesingle{}); grfs.\+gracefulify(fs);{\ttfamily }
\item {\ttfamily Can also be solved by tuning OS\+:}echo fs.\+inotify.\+max\+\_\+user\+\_\+watches=524288 \texorpdfstring{$\vert$}{|} sudo tee -\/a /etc/sysctl.conf \&\& sudo sysctl -\/p{\ttfamily .}
\end{DoxyItemize}
\item {\ttfamily Exhausted file handles for}fs.\+watch{\ttfamily 
\begin{DoxyItemize}
\item Can\textquotesingle{}t seem to be solved by graceful-\/fs or OS tuning
\item It\textquotesingle{}s possible to start using
\end{DoxyItemize}}use\+Polling\+: true{\ttfamily , which will switch backend to resource-\/intensive}fs.\+watch\+File\`{}
\end{DoxyEnumerate}

All fsevents-\/related issues ({\ttfamily WARN optional dep failed}, {\ttfamily fsevents is not a constructor}) are solved by upgrading to v4+.\hypertarget{README.md_autotoc_md34516}{}\doxysubsection{\texorpdfstring{Changelog}{Changelog}}\label{README.md_autotoc_md34516}

\begin{DoxyItemize}
\item {\bfseries{v4 (Sep 2024)\+:}} remove glob support and bundled fsevents. Decrease dependency count from 13 to 1. Rewrite in typescript. Bumps minimum node.\+js requirement to v14+
\item {\bfseries{v3 (Apr 2019)\+:}} massive CPU \& RAM consumption improvements; reduces deps / package size by a factor of 17x and bumps Node.\+js requirement to v8.\+16+.
\item {\bfseries{v2 (Dec 2017)\+:}} globs are now posix-\/style-\/only. Tons of bugfixes.
\item {\bfseries{v1 (Apr 2015)\+:}} glob support, symlink support, tons of bugfixes. Node 0.\+8+ is supported
\item {\bfseries{v0.\+1 (Apr 2012)\+:}} Initial release, extracted from \href{https://github.com/brunch/brunch/blob/9847a065aea300da99bd0753f90354cde9de1261/src/helpers.coffee\#L66}{\texttt{ Brunch}}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md34517}{}\doxysubsubsection{\texorpdfstring{Upgrading}{Upgrading}}\label{README.md_autotoc_md34517}
If you\textquotesingle{}ve used globs before and want do replicate the functionality with v4\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ v3}
\DoxyCodeLine{chok.watch('**/*.js');}
\DoxyCodeLine{chok.watch("{}./directory/**/*"{});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ v4}
\DoxyCodeLine{chok.watch('.',\ \{}
\DoxyCodeLine{\ \ ignored:\ (path,\ stats)\ =>\ stats?.isFile()\ \&\&\ !path.endsWith('.js'),\ //\ only\ watch\ js\ files}
\DoxyCodeLine{\});}
\DoxyCodeLine{chok.watch('./directory');}
\DoxyCodeLine{}
\DoxyCodeLine{//\ other\ way}
\DoxyCodeLine{import\ \{\ glob\ \}\ from\ 'node:fs/promises';}
\DoxyCodeLine{const\ watcher\ =\ watch(await\ Array.fromAsync(glob('**/*.js')));}
\DoxyCodeLine{}
\DoxyCodeLine{//\ unwatching}
\DoxyCodeLine{//\ v3}
\DoxyCodeLine{chok.unwatch('**/*.js');}
\DoxyCodeLine{//\ v4}
\DoxyCodeLine{chok.unwatch(await\ glob('**/*.js'));}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md34518}{}\doxysubsection{\texorpdfstring{Also}{Also}}\label{README.md_autotoc_md34518}
Why was chokidar named this way? What\textquotesingle{}s the meaning behind it?

\texorpdfstring{$>$}{>}Chowkidar is a transliteration of a Hindi word meaning \textquotesingle{}watchman, gatekeeper\textquotesingle{}, चौकीदार. This ultimately comes from Sanskrit \+\_\+ चतुष्क\+\_\+ (crossway, quadrangle, consisting-\/of-\/four). This word is also used in other languages like Urdu as (چوکیدار) which is widely used in Pakistan and India.\hypertarget{README.md_autotoc_md34519}{}\doxysubsection{\texorpdfstring{License}{License}}\label{README.md_autotoc_md34519}
MIT (c) Paul Miller (\href{https://paulmillr.com}{\texttt{ https\+://paulmillr.\+com}}), see \mbox{[}LICENSE\mbox{]}(LICENSE) file. 