\doxysection{node\+\_\+modules/jest-\/canvas-\/mock Directory Reference}
\hypertarget{dir_72b85d86fed7a9f6d05ad47951eb31f1}{}\label{dir_72b85d86fed7a9f6d05ad47951eb31f1}\index{node\_modules/jest-\/canvas-\/mock Directory Reference@{node\_modules/jest-\/canvas-\/mock Directory Reference}}


\doxysubsection{Detailed Description}
\begin{quote}
Mock {\ttfamily canvas} when run unit test cases with jest. For more browser environment, you can use \href{https://github.com/hustcc/jest-electron}{\texttt{ jest-\/electron}} for real browser runtime. \end{quote}


\href{https://github.com/hustcc/jest-canvas-mock/actions/workflows/build.yml}{\texttt{ }} \href{https://coveralls.io/github/hustcc/jest-canvas-mock}{\texttt{ }} \href{https://www.npmjs.com/package/jest-canvas-mock}{\texttt{ }} \href{https://www.npmjs.com/package/jest-canvas-mock}{\texttt{ }} \href{https://github.com/jest-community/awesome-jest}{\texttt{ }}\hypertarget{README.md_autotoc_md19424}{}\doxysubsection{\texorpdfstring{Install}{Install}}\label{README.md_autotoc_md19424}
This should only be installed as a development dependency ({\ttfamily dev\+Dependencies}) as it is only designed for testing.


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ i\ -\/-\/save-\/dev\ jest-\/canvas-\/mock}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md19425}{}\doxysubsection{\texorpdfstring{Setup}{Setup}}\label{README.md_autotoc_md19425}
In your {\ttfamily package.\+json} under the {\ttfamily jest}, create a {\ttfamily setup\+Files} array and add {\ttfamily jest-\/canvas-\/mock} to the array.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ "{}jest"{}:\ \{}
\DoxyCodeLine{\ \ \ \ "{}setupFiles"{}:\ ["{}jest-\/canvas-\/mock"{}]}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


If you already have a {\ttfamily setup\+Files} attribute you can also append {\ttfamily jest-\/canvas-\/mock} to the array.


\begin{DoxyCode}{0}
\DoxyCodeLine{\{}
\DoxyCodeLine{\ \ "{}jest"{}:\ \{}
\DoxyCodeLine{\ \ \ \ "{}setupFiles"{}:\ ["{}./\_\_setups\_\_/other.js"{},\ "{}jest-\/canvas-\/mock"{}]}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\}}

\end{DoxyCode}


More about in \href{https://facebook.github.io/jest/docs/en/configuration.html\#content}{\texttt{ configuration section}}.\hypertarget{README.md_autotoc_md19426}{}\doxysubsection{\texorpdfstring{Setup file}{Setup file}}\label{README.md_autotoc_md19426}
Alternatively you can create a new setup file which then requires this module or add the {\ttfamily require} statement to an existing setup file.

{\ttfamily \+\_\+\+\_\+setups\+\_\+\+\_\+/canvas.\+js}


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ 'jest-\/canvas-\/mock';}
\DoxyCodeLine{//\ or}
\DoxyCodeLine{require('jest-\/canvas-\/mock');}

\end{DoxyCode}


Add that file to your {\ttfamily setup\+Files} array\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{"{}jest"{}:\ \{}
\DoxyCodeLine{\ \ "{}setupFiles"{}:\ [}
\DoxyCodeLine{\ \ \ \ "{}./\_\_setups\_\_/canvas.js"{}}
\DoxyCodeLine{\ \ ]}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md19427}{}\doxysubsection{\texorpdfstring{Reset}{Reset}}\label{README.md_autotoc_md19427}
If you reset the jest mocks (for example, with {\ttfamily jest.\+reset\+All\+Mocks()}), you can call {\ttfamily setup\+Jest\+Canvas\+Mock()} to re-\/create it.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ setupJestCanvasMock\ \}\ from\ 'jest-\/canvas-\/mock';}
\DoxyCodeLine{}
\DoxyCodeLine{beforeEach(()\ =>\ \{}
\DoxyCodeLine{\ \ jest.resetAllMocks();}
\DoxyCodeLine{\ \ setupJestCanvasMock();}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md19428}{}\doxysubsection{\texorpdfstring{Mock Strategy}{Mock Strategy}}\label{README.md_autotoc_md19428}
This mock strategy implements all the canvas functions and actually verifies the parameters. If a known condition would cause the browser to throw a {\ttfamily Type\+Error} or a {\ttfamily DOMException}, it emulates the error. For instance, the {\ttfamily Canvas\+Rendering\+Context2D\#arc} function will throw a {\ttfamily Type\+Error} if the radius is negative, or if it was not provided with enough parameters.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ arc\ throws\ a\ TypeError\ when\ the\ argument\ length\ is\ less\ than\ 5}
\DoxyCodeLine{expect(()\ =>\ ctx.arc(1,\ 2,\ 3,\ 4)).toThrow(TypeError);}
\DoxyCodeLine{}
\DoxyCodeLine{//\ when\ radius\ is\ negative,\ arc\ throws\ a\ dom\ exception\ when\ all\ parameters\ are\ finite}
\DoxyCodeLine{expect(()\ =>\ ctx.arc(0,\ 0,\ -\/10,\ 0,\ Math.PI\ *\ 2)).toThrow(DOMException);}

\end{DoxyCode}


The function will do {\ttfamily Number} type coercion and verify the inputs exactly like the browser does. So this is valid input.


\begin{DoxyCode}{0}
\DoxyCodeLine{expect(()\ =>\ ctx.arc('10',\ '10',\ '20',\ '0',\ '6.14')).not.toThrow();}

\end{DoxyCode}


Another part of the strategy is to validate input types. When using the {\ttfamily Canvas\+Rendering\+Context2D\#fill} function, if you pass it an invalid {\ttfamily fill\+Rule} it will throw a {\ttfamily Type\+Error} just like the browser does.


\begin{DoxyCode}{0}
\DoxyCodeLine{expect(()\ =>\ ctx.fill('invalid!')).toThrow(TypeError);}
\DoxyCodeLine{expect(()\ =>\ ctx.fill(new\ Path2D(),\ 'invalid!')).toThrow(TypeError);}

\end{DoxyCode}


We try to follow the ECMAScript specification as closely as possible.\hypertarget{README.md_autotoc_md19429}{}\doxysubsection{\texorpdfstring{Snapshots}{Snapshots}}\label{README.md_autotoc_md19429}
There are multiple ways to validate canvas state using snapshots. There are currently three methods attached to the {\ttfamily Canvas\+Rendering\+Context2D} class. The first way to use this feature is by using the {\ttfamily \+\_\+\+\_\+get\+Events} method.


\begin{DoxyCode}{0}
\DoxyCodeLine{/**}
\DoxyCodeLine{\ *\ In\ order\ to\ see\ which\ functions\ and\ properties\ were\ used\ for\ the\ test,\ you\ can\ use\ \`{}\_\_getEvents`}
\DoxyCodeLine{\ *\ to\ gather\ this\ information.}
\DoxyCodeLine{\ */}
\DoxyCodeLine{const\ events\ =\ ctx.\_\_getEvents();}
\DoxyCodeLine{}
\DoxyCodeLine{expect(events).toMatchSnapshot();\ //\ jest\ will\ assert\ the\ events\ match\ the\ snapshot}

\end{DoxyCode}


The second way is to inspect the current path associated with the context.


\begin{DoxyCode}{0}
\DoxyCodeLine{ctx.beginPath();}
\DoxyCodeLine{ctx.arc(1,\ 2,\ 3,\ 4,\ 5);}
\DoxyCodeLine{ctx.moveTo(6,\ 7);}
\DoxyCodeLine{ctx.rect(6,\ 7,\ 8,\ 9);}
\DoxyCodeLine{ctx.closePath();}
\DoxyCodeLine{}
\DoxyCodeLine{/**}
\DoxyCodeLine{\ *\ Any\ method\ that\ modifies\ the\ current\ path\ (and\ subpath)\ will\ be\ pushed\ to\ an\ event\ array.\ When}
\DoxyCodeLine{\ *\ using\ the\ \`{}\_\_getPath`\ method,\ that\ array\ will\ sliced\ and\ usable\ for\ snapshots.}
\DoxyCodeLine{\ */}
\DoxyCodeLine{const\ path\ =\ ctx.\_\_getPath();}
\DoxyCodeLine{expect(path).toMatchSnapshot();}

\end{DoxyCode}


The third way is to inspect all of the successful draw calls submitted to the context.


\begin{DoxyCode}{0}
\DoxyCodeLine{ctx.drawImage(img,\ 0,\ 0);}
\DoxyCodeLine{}
\DoxyCodeLine{/**}
\DoxyCodeLine{\ *\ Every\ drawImage,\ fill,\ stroke,\ fillText,\ or\ strokeText\ function\ call\ will\ be\ logged\ in\ an\ event}
\DoxyCodeLine{\ *\ array.\ This\ method\ will\ return\ those\ events\ here\ for\ inspection.}
\DoxyCodeLine{\ */}
\DoxyCodeLine{const\ calls\ =\ ctx.\_\_getDrawCalls();}
\DoxyCodeLine{expect(calls).toMatchSnapshot();}

\end{DoxyCode}


In some cases it may be useful to clear the events or draw calls that have already been logged.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ Clear\ events}
\DoxyCodeLine{ctx.\_\_clearEvents();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Clear\ draw\ calls}
\DoxyCodeLine{ctx.\_\_clearDrawCalls();}

\end{DoxyCode}


Finally, it\textquotesingle{}s possible to inspect the clipping region calls by using the {\ttfamily \+\_\+\+\_\+get\+Clipping\+Region} function.


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ clippingRegion\ =\ ctx.\_\_getClippingRegion();}
\DoxyCodeLine{expect(clippingRegion).toMatchSnapshot();}

\end{DoxyCode}


The clipping region cannot be cleared because it\textquotesingle{}s based on the stack values and when the {\ttfamily .clip()} function is called.\hypertarget{README.md_autotoc_md19430}{}\doxysubsection{\texorpdfstring{Override default mock return value}{Override default mock return value}}\label{README.md_autotoc_md19430}
You can override the default mock return value in your test to suit your need. For example, to override return value of {\ttfamily to\+Data\+URL}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{canvas.toDataURL.mockReturnValueOnce(}
\DoxyCodeLine{\ \ 'data:image/png;base64,\ iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='}
\DoxyCodeLine{);}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md19431}{}\doxysubsection{\texorpdfstring{Contributors}{Contributors}}\label{README.md_autotoc_md19431}

\begin{DoxyItemize}
\item \href{https://github.com/hustcc}{\texttt{ @hustcc}}
\item \href{https://github.com/jtenner}{\texttt{ @jtenner}}
\item \href{https://github.com/evanoc0}{\texttt{ @evanoc0}}
\item \href{https://github.com/lekha}{\texttt{ @lekha}}
\item \href{https://github.com/yonatankra}{\texttt{ @yonatankra}}
\item \href{https://github.com/LitoMore}{\texttt{ @\+Lito\+More}}
\item \href{https://github.com/hrd543}{\texttt{ @hrd543}}
\item \href{https://github.com/danielrentz}{\texttt{ @danielrentz}}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md19432}{}\doxysubsection{\texorpdfstring{License}{License}}\label{README.md_autotoc_md19432}
MIT\texorpdfstring{$<$}{<}a href="{}https\+://github.\+com/hustcc"{} \texorpdfstring{$>$}{>}hustcc. 