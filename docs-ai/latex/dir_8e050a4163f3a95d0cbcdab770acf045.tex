\doxysection{node\+\_\+modules/p-\/timeout Directory Reference}
\hypertarget{dir_8e050a4163f3a95d0cbcdab770acf045}{}\label{dir_8e050a4163f3a95d0cbcdab770acf045}\index{node\_modules/p-\/timeout Directory Reference@{node\_modules/p-\/timeout Directory Reference}}


\doxysubsection{Detailed Description}
\begin{quote}
Timeout a promise after a specified amount of time \end{quote}


\begin{DoxyNote}{Note}
You may want to use {\ttfamily Abort\+Signal.\+timeout()} instead. Learn more.
\end{DoxyNote}
\hypertarget{readme.md_autotoc_md25441}{}\doxysubsection{\texorpdfstring{Install}{Install}}\label{readme.md_autotoc_md25441}

\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ p-\/timeout}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25442}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{readme.md_autotoc_md25442}

\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{setTimeout\}\ from\ 'node:timers/promises';}
\DoxyCodeLine{import\ pTimeout\ from\ 'p-\/timeout';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ delayedPromise\ =\ setTimeout(200);}
\DoxyCodeLine{}
\DoxyCodeLine{await\ pTimeout(delayedPromise,\ \{}
\DoxyCodeLine{\ \ \ \ milliseconds:\ 50,}
\DoxyCodeLine{\});}
\DoxyCodeLine{//=>\ [TimeoutError:\ Promise\ timed\ out\ after\ 50\ milliseconds]}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25443}{}\doxysubsection{\texorpdfstring{API}{API}}\label{readme.md_autotoc_md25443}
\hypertarget{readme.md_autotoc_md25444}{}\doxysubsubsection{\texorpdfstring{p\+Timeout(input, options)}{p\+Timeout(input, options)}}\label{readme.md_autotoc_md25444}
Returns a decorated {\ttfamily input} that times out after {\ttfamily milliseconds} time. It has a {\ttfamily .clear()} method that clears the timeout.

If you pass in a cancelable promise, specifically a promise with a {\ttfamily .cancel()} method, that method will be called when the {\ttfamily p\+Timeout} promise times out.\hypertarget{readme.md_autotoc_md25445}{}\doxysubsubsubsection{\texorpdfstring{input}{input}}\label{readme.md_autotoc_md25445}
Type\+: {\ttfamily Promise}

Promise to decorate.\hypertarget{readme.md_autotoc_md25446}{}\doxysubsubsubsection{\texorpdfstring{options}{options}}\label{readme.md_autotoc_md25446}
Type\+: {\ttfamily object}\hypertarget{readme.md_autotoc_md25447}{}\doxysubsubsubsubsection{\texorpdfstring{milliseconds}{milliseconds}}\label{readme.md_autotoc_md25447}
Type\+: {\ttfamily number}

Milliseconds before timing out.

Passing {\ttfamily Infinity} will cause it to never time out.\hypertarget{readme.md_autotoc_md25448}{}\doxysubsubsubsubsection{\texorpdfstring{message}{message}}\label{readme.md_autotoc_md25448}
Type\+: {\ttfamily string \texorpdfstring{$\vert$}{|} Error \texorpdfstring{$\vert$}{|} false}\textbackslash{} Default\+: `\textquotesingle{}Promise timed out after 50 milliseconds'\`{}

Specify a custom error message or error to throw when it times out\+:


\begin{DoxyItemize}
\item `message\+: \textquotesingle{}too slow'{\ttfamily will throw}Timeout\+Error(\textquotesingle{}too slow\textquotesingle{}){\ttfamily  -\/}message\+: new My\+Custom\+Error(\textquotesingle{}it’s over 9000\textquotesingle{}){\ttfamily will throw the same error instance -\/}message\+: false{\ttfamily will make the promise resolve with}undefined\`{} instead of rejecting
\end{DoxyItemize}

If you do a custom error, it\textquotesingle{}s recommended to sub-\/class {\ttfamily Timeout\+Error}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{TimeoutError\}\ from\ 'p-\/timeout';}
\DoxyCodeLine{}
\DoxyCodeLine{class\ MyCustomError\ extends\ TimeoutError\ \{}
\DoxyCodeLine{\ \ \ \ name\ =\ "{}MyCustomError"{};}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25449}{}\doxysubsubsubsubsection{\texorpdfstring{fallback}{fallback}}\label{readme.md_autotoc_md25449}
Type\+: {\ttfamily Function}

Do something other than rejecting with an error on timeout.

You could for example retry\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{setTimeout\}\ from\ 'node:timers/promises';}
\DoxyCodeLine{import\ pTimeout\ from\ 'p-\/timeout';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ delayedPromise\ =\ ()\ =>\ setTimeout(200);}
\DoxyCodeLine{}
\DoxyCodeLine{await\ pTimeout(delayedPromise(),\ \{}
\DoxyCodeLine{\ \ \ \ milliseconds:\ 50,}
\DoxyCodeLine{\ \ \ \ fallback:\ ()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ pTimeout(delayedPromise(),\ \{milliseconds:\ 300\});}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25450}{}\doxysubsubsubsubsection{\texorpdfstring{custom\+Timers}{custom\+Timers}}\label{readme.md_autotoc_md25450}
Type\+: {\ttfamily object} with function properties {\ttfamily set\+Timeout} and {\ttfamily clear\+Timeout}

Custom implementations for the {\ttfamily set\+Timeout} and {\ttfamily clear\+Timeout} functions.

Useful for testing purposes, in particular to work around \href{https://sinonjs.org/releases/latest/fake-timers/}{\texttt{ {\ttfamily sinon.\+use\+Fake\+Timers()}}}.

Example\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{setTimeout\}\ from\ 'node:timers/promises';}
\DoxyCodeLine{import\ pTimeout\ from\ 'p-\/timeout';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ originalSetTimeout\ =\ setTimeout;}
\DoxyCodeLine{const\ originalClearTimeout\ =\ clearTimeout;}
\DoxyCodeLine{}
\DoxyCodeLine{sinon.useFakeTimers();}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Use\ \`{}pTimeout`\ without\ being\ affected\ by\ \`{}sinon.useFakeTimers()`:}
\DoxyCodeLine{await\ pTimeout(doSomething(),\ \{}
\DoxyCodeLine{\ \ \ \ milliseconds:\ 2000,}
\DoxyCodeLine{\ \ \ \ customTimers:\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ setTimeout:\ originalSetTimeout,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ clearTimeout:\ originalClearTimeout}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25451}{}\doxysubsubsubsection{\texorpdfstring{signal}{signal}}\label{readme.md_autotoc_md25451}
Type\+: \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal}{\texttt{ {\ttfamily Abort\+Signal}}}

You can abort the promise using \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortController}{\texttt{ {\ttfamily Abort\+Controller}}}.

{\itshape Requires Node.\+js 16 or later.}


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ pTimeout\ from\ 'p-\/timeout';}
\DoxyCodeLine{import\ delay\ from\ 'delay';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ delayedPromise\ =\ delay(3000);}
\DoxyCodeLine{}
\DoxyCodeLine{const\ abortController\ =\ new\ AbortController();}
\DoxyCodeLine{}
\DoxyCodeLine{setTimeout(()\ =>\ \{}
\DoxyCodeLine{\ \ \ \ abortController.abort();}
\DoxyCodeLine{\},\ 100);}
\DoxyCodeLine{}
\DoxyCodeLine{await\ pTimeout(delayedPromise,\ \{}
\DoxyCodeLine{\ \ \ \ milliseconds:\ 2000,}
\DoxyCodeLine{\ \ \ \ signal:\ abortController.signal}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md25452}{}\doxysubsubsection{\texorpdfstring{Timeout\+Error}{Timeout\+Error}}\label{readme.md_autotoc_md25452}
Exposed for instance checking and sub-\/classing.\hypertarget{readme.md_autotoc_md25453}{}\doxysubsection{\texorpdfstring{Related}{Related}}\label{readme.md_autotoc_md25453}

\begin{DoxyItemize}
\item \href{https://github.com/sindresorhus/delay}{\texttt{ delay}} -\/ Delay a promise a specified amount of time
\item \href{https://github.com/sindresorhus/p-min-delay}{\texttt{ p-\/min-\/delay}} -\/ Delay a promise a minimum amount of time
\item \href{https://github.com/sindresorhus/p-retry}{\texttt{ p-\/retry}} -\/ Retry a promise-\/returning function
\item \href{https://github.com/sindresorhus/promise-fun}{\texttt{ More…}}
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md25454}{}\doxysubsection{\texorpdfstring{Abort\+Signal}{Abort\+Signal}}\label{readme.md_autotoc_md25454}
\begin{quote}
Modern alternative to {\ttfamily p-\/timeout} \end{quote}


Asynchronous functions like {\ttfamily fetch} can accept an \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal}{\texttt{ {\ttfamily Abort\+Signal}}}, which can be conveniently created with \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal/timeout_static}{\texttt{ {\ttfamily Abort\+Signal.\+timeout()}}}.

The advantage over {\ttfamily p-\/timeout} is that the promise-\/generating function (like {\ttfamily fetch}) is actually notified that the user is no longer expecting an answer, so it can interrupt its work and free resources.


\begin{DoxyCode}{0}
\DoxyCodeLine{//\ Call\ API,\ timeout\ after\ 5\ seconds}
\DoxyCodeLine{const\ response\ =\ await\ fetch('./my-\/api',\ \{signal:\ AbortSignal.timeout(5000)\});}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{async\ function\ buildWall(signal)\ \{}
\DoxyCodeLine{\ \ \ \ for\ (const\ brick\ of\ bricks)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ signal.throwIfAborted();}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ Or:\ if\ (signal.aborted)\ \{\ return;\ \}}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ await\ layBrick();}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Stop\ long\ work\ after\ 60\ seconds}
\DoxyCodeLine{await\ buildWall(AbortSignal.timeout(60\_000))}

\end{DoxyCode}


You can also combine multiple signals, like when you have a timeout {\itshape and} an {\ttfamily Abort\+Controller} triggered with a “\+Cancel” button click. You can use the upcoming \href{https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal/any_static}{\texttt{ {\ttfamily Abort\+Signal.\+any()}}} helper or \href{https://github.com/fregante/abort-utils/blob/main/source/merge-signals.md}{\texttt{ {\ttfamily abort-\/utils}}}. 