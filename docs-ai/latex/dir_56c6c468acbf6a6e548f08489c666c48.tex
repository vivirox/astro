\doxysection{node\+\_\+modules/@octokit/plugin-\/throttling Directory Reference}
\hypertarget{dir_56c6c468acbf6a6e548f08489c666c48}{}\label{dir_56c6c468acbf6a6e548f08489c666c48}\index{node\_modules/"@octokit/plugin-\/throttling Directory Reference@{node\_modules/"@octokit/plugin-\/throttling Directory Reference}}


\doxysubsection{Detailed Description}
\begin{quote}
Octokit plugin for Git\+Hubâ€™s recommended request throttling \end{quote}


\href{https://www.npmjs.com/package/@octokit/plugin-throttling}{\texttt{ }} \href{https://github.com/octokit/plugin-throttling.js/actions?workflow=Test}{\texttt{ }}

Implements all \href{https://docs.github.com/en/rest/guides/best-practices-for-integrators}{\texttt{ recommended best practices}} to prevent hitting secondary rate limits.\hypertarget{README.md_autotoc_md5346}{}\doxysubsection{\texorpdfstring{Usage}{Usage}}\label{README.md_autotoc_md5346}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{2}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Browsers }&

Load {\ttfamily @octokit/plugin-\/throttling} and \href{https://github.com/octokit/core.js}{\texttt{ {\ttfamily @octokit/core}}} (or core-\/compatible module) directly from \href{https://esm.sh}{\texttt{ esm.\+sh}}


\begin{DoxyCode}{0}
\DoxyCodeLine{<script\ type="{}module"{}>}
\DoxyCodeLine{\ \ import\ \{\ Octokit\ \}\ from\ "{}https://esm.sh/@octokit/core"{};}
\DoxyCodeLine{\ \ import\ \{\ throttling\ \}\ from\ "{}https://esm.sh/@octokit/plugin-\/throttling"{};}
\DoxyCodeLine{</script>}

\end{DoxyCode}


\\\cline{1-2}
\cellcolor{\tableheadbgcolor}\textbf{ Node }&

Install with {\ttfamily npm install @octokit/core @octokit/plugin-\/throttling}. Optionally replace {\ttfamily @octokit/core} with a core-\/compatible module.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{\ Octokit\ \}\ from\ "{}@octokit/core"{};}
\DoxyCodeLine{import\ \{\ throttling\ \}\ from\ "{}@octokit/plugin-\/throttling"{};}

\end{DoxyCode}


\\\cline{1-2}
\end{longtabu}


\begin{DoxyImportant}{Important}
As we use \href{https://nodejs.org/api/packages.html\#conditional-exports}{\texttt{ conditional exports}}, you will need to adapt your {\ttfamily tsconfig.\+json} by setting {\ttfamily "{}module\+Resolution"{}\+: "{}node16"{}, "{}module"{}\+: "{}node16"{}}. ~\newline
~\newline
 See the Type\+Script docs on \href{https://www.typescriptlang.org/docs/handbook/modules/reference.html\#packagejson-exports}{\texttt{ package.\+json "{}exports"{}}}.~\newline
 See this \href{https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c}{\texttt{ helpful guide on transitioning to ESM}} from \href{https://github.com/sindresorhus}{\texttt{ @sindresorhus}}
\end{DoxyImportant}
The code below creates a "{}\+Hello, world!"{} issue on every repository in a given organization. Without the throttling plugin it would send many requests in parallel and would hit rate limits very quickly. But the {\ttfamily @octokit/plugin-\/throttling} slows down your requests according to the official guidelines, so you don\textquotesingle{}t get blocked before your quota is exhausted.

The {\ttfamily throttle.\+on\+Secondary\+Rate\+Limit} and {\ttfamily throttle.\+on\+Rate\+Limit} options are required. Return {\ttfamily true} to automatically retry the request after {\ttfamily retry\+After} seconds.


\begin{DoxyCode}{0}
\DoxyCodeLine{const\ MyOctokit\ =\ Octokit.plugin(throttling);}
\DoxyCodeLine{}
\DoxyCodeLine{const\ octokit\ =\ new\ MyOctokit(\{}
\DoxyCodeLine{\ \ auth:\ \`{}secret123`,}
\DoxyCodeLine{\ \ throttle:\ \{}
\DoxyCodeLine{\ \ \ \ onRateLimit:\ (retryAfter,\ options,\ octokit,\ retryCount)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ octokit.log.warn(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \`{}Request\ quota\ exhausted\ for\ request\ \$\{options.method\}\ \$\{options.url\}`,}
\DoxyCodeLine{\ \ \ \ \ \ );}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ if\ (retryCount\ <\ 1)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ //\ only\ retries\ once}
\DoxyCodeLine{\ \ \ \ \ \ \ \ octokit.log.info(`Retrying\ after\ \$\{retryAfter\}\ seconds!`);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ return\ true;}
\DoxyCodeLine{\ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{\ \ \ \ onSecondaryRateLimit:\ (retryAfter,\ options,\ octokit)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ //\ does\ not\ retry,\ only\ logs\ a\ warning}
\DoxyCodeLine{\ \ \ \ \ \ octokit.log.warn(}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \`{}SecondaryRateLimit\ detected\ for\ request\ \$\{options.method\}\ \$\{options.url\}`,}
\DoxyCodeLine{\ \ \ \ \ \ );}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{async\ function\ createIssueOnAllRepos(org)\ \{}
\DoxyCodeLine{\ \ const\ repos\ =\ await\ octokit.paginate(}
\DoxyCodeLine{\ \ \ \ octokit.repos.listForOrg.endpoint(\{\ org\ \}),}
\DoxyCodeLine{\ \ );}
\DoxyCodeLine{\ \ return\ Promise.all(}
\DoxyCodeLine{\ \ \ \ repos.map((\{\ name\ \})\ =>}
\DoxyCodeLine{\ \ \ \ \ \ octokit.issues.create(\{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ owner,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ repo:\ name,}
\DoxyCodeLine{\ \ \ \ \ \ \ \ title:\ "{}Hello,\ world!"{},}
\DoxyCodeLine{\ \ \ \ \ \ \}),}
\DoxyCodeLine{\ \ \ \ ),}
\DoxyCodeLine{\ \ );}
\DoxyCodeLine{\}}

\end{DoxyCode}


Pass {\ttfamily \{ throttle\+: \{ enabled\+: false \} \}} to disable this plugin.\hypertarget{README.md_autotoc_md5347}{}\doxysubsubsection{\texorpdfstring{Clustering}{Clustering}}\label{README.md_autotoc_md5347}
Enabling Clustering support ensures that your application will not go over rate limits {\bfseries{across Octokit instances and across Nodejs processes}}.

First install either {\ttfamily redis} or {\ttfamily ioredis}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\#\ NodeRedis\ (https://github.com/NodeRedis/node\_redis)}
\DoxyCodeLine{npm\ install\ -\/-\/save\ redis}
\DoxyCodeLine{}
\DoxyCodeLine{\#\ or\ ioredis\ (https://github.com/luin/ioredis)}
\DoxyCodeLine{npm\ install\ -\/-\/save\ ioredis}

\end{DoxyCode}


Then in your application\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ Bottleneck\ from\ "{}bottleneck"{};}
\DoxyCodeLine{import\ Redis\ from\ "{}redis"{};}
\DoxyCodeLine{}
\DoxyCodeLine{const\ client\ =\ Redis.createClient(\{}
\DoxyCodeLine{\ \ /*\ options\ */}
\DoxyCodeLine{\});}
\DoxyCodeLine{const\ connection\ =\ new\ Bottleneck.RedisConnection(\{\ client\ \});}
\DoxyCodeLine{connection.on("{}error"{},\ err\ =>\ console.error(err));}
\DoxyCodeLine{}
\DoxyCodeLine{const\ octokit\ =\ new\ MyOctokit(\{}
\DoxyCodeLine{\ \ auth:\ 'secret123'}
\DoxyCodeLine{\ \ throttle:\ \{}
\DoxyCodeLine{\ \ \ \ onSecondaryRateLimit:\ (retryAfter,\ options,\ octokit)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ /*\ ...\ */}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{\ \ \ \ onRateLimit:\ (retryAfter,\ options,\ octokit)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ /*\ ...\ */}
\DoxyCodeLine{\ \ \ \ \},}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ The\ Bottleneck\ connection\ object}
\DoxyCodeLine{\ \ \ \ connection,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ A\ "{}throttling\ ID"{}.\ All\ octokit\ instances\ with\ the\ same\ ID}
\DoxyCodeLine{\ \ \ \ //\ using\ the\ same\ Redis\ server\ will\ share\ the\ throttling.}
\DoxyCodeLine{\ \ \ \ id:\ "{}my-\/super-\/app"{},}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ //\ Otherwise\ the\ plugin\ uses\ a\ lighter\ version\ of\ Bottleneck\ without\ Redis\ support}
\DoxyCodeLine{\ \ \ \ Bottleneck}
\DoxyCodeLine{\ \ \}}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{//\ To\ close\ the\ connection\ and\ allow\ your\ application\ to\ exit\ cleanly:}
\DoxyCodeLine{await\ connection.disconnect();}

\end{DoxyCode}


To use the {\ttfamily ioredis} library instead\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ Redis\ from\ "{}ioredis"{};}
\DoxyCodeLine{const\ client\ =\ new\ Redis(\{}
\DoxyCodeLine{\ \ /*\ options\ */}
\DoxyCodeLine{\});}
\DoxyCodeLine{const\ connection\ =\ new\ Bottleneck.IORedisConnection(\{\ client\ \});}
\DoxyCodeLine{connection.on("{}error"{},\ (err)\ =>\ console.error(err));}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md5348}{}\doxysubsection{\texorpdfstring{Options}{Options}}\label{README.md_autotoc_md5348}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ name  }&\cellcolor{\tableheadbgcolor}\textbf{ type  }&\cellcolor{\tableheadbgcolor}\textbf{ description     }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ name  }&\cellcolor{\tableheadbgcolor}\textbf{ type  }&\cellcolor{\tableheadbgcolor}\textbf{ description     }\\\cline{1-3}
\endhead
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily options.\+retry\+After\+Base\+Value}  }&{\ttfamily Number}  &Number of milliseconds that will be used to multiply the time to wait based on {\ttfamily retry-\/after} or {\ttfamily x-\/ratelimit-\/reset} headers. Defaults to {\ttfamily 1000}   \\\cline{1-3}
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily options.\+fallback\+Secondary\+Rate\+Retry\+After}  }&{\ttfamily Number}  &Number of seconds to wait until retrying a request in case a secondary rate limit is hit and no {\ttfamily retry-\/after} header was present in the response. Defaults to {\ttfamily 60}   \\\cline{1-3}
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily options.\+connection}  }&{\ttfamily Bottleneck.\+Redis\+Connection}  &A Bottleneck connection instance. See \href{\#clustering}{\texttt{ Clustering}} above.   \\\cline{1-3}
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily options.\+id}  }&{\ttfamily string}  &A "{}throttling ID"{}. All octokit instances with the same ID using the same Redis server will share the throttling. See \href{\#clustering}{\texttt{ Clustering}} above. Defaults to {\ttfamily no-\/id}.   \\\cline{1-3}
\cellcolor{\tableheadbgcolor}\textbf{ {\ttfamily options.\+Bottleneck}  }&{\ttfamily Bottleneck}  &Bottleneck constructor. See \href{\#clustering}{\texttt{ Clustering}} above. Defaults to {\ttfamily bottleneck/light}.    \\\cline{1-3}
\end{longtabu}
\hypertarget{README.md_autotoc_md5349}{}\doxysubsection{\texorpdfstring{LICENSE}{LICENSE}}\label{README.md_autotoc_md5349}
\mbox{[}MIT\mbox{]}(LICENSE) 