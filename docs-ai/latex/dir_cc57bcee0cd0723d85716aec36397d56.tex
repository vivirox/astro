\doxysection{node\+\_\+modules/trough Directory Reference}
\hypertarget{dir_cc57bcee0cd0723d85716aec36397d56}{}\label{dir_cc57bcee0cd0723d85716aec36397d56}\index{node\_modules/trough Directory Reference@{node\_modules/trough Directory Reference}}


\doxysubsection{Detailed Description}
\href{https://github.com/wooorm/trough/actions}{\texttt{ }} \href{https://codecov.io/github/wooorm/trough}{\texttt{ }} \href{https://www.npmjs.com/package/trough}{\texttt{ }} \href{https://bundlejs.com/?q=trough}{\texttt{ }}

{\ttfamily trough} is middleware.\hypertarget{readme.md_autotoc_md33189}{}\doxysubsection{\texorpdfstring{Contents}{Contents}}\label{readme.md_autotoc_md33189}

\begin{DoxyItemize}
\item What is this?
\item When should I use this?
\item Install
\item Use
\item \doxylink{README.md_api}{API}
\begin{DoxyItemize}
\item \`{}trough()\`{}
\item \`{}wrap(middleware, callback)\`{}
\item \`{}\+Callback\`{}
\item \`{}\+Middleware\`{}
\item \doxylink{pipeline_8cc_a219a66c8cf101fc8c26a5c86edd940f4}{\`{}\+Pipeline\`{}}
\item \`{}\+Run\`{}
\item \`{}\+Use\`{}
\end{DoxyItemize}
\item Compatibility
\item Security
\item \doxylink{readme.md_contribute}{Contribute}
\item \doxylink{README.md_license}{License}
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33190}{}\doxysubsection{\texorpdfstring{What is this?}{What is this?}}\label{readme.md_autotoc_md33190}
{\ttfamily trough} is like \href{https://github.com/segmentio/ware}{\texttt{ {\ttfamily ware}}} with less sugar. Middleware functions can also change the input of the next.

The word {\bfseries{trough}} ({\ttfamily /tr√¥f/}) means a channel used to convey a liquid.\hypertarget{readme.md_autotoc_md33191}{}\doxysubsection{\texorpdfstring{When should I use this?}{When should I use this?}}\label{readme.md_autotoc_md33191}
You can use this package when you‚Äôre building something that accepts ‚Äúplugins‚Äù, which are functions, that can be sync or async, promises or callbacks.\hypertarget{readme.md_autotoc_md33192}{}\doxysubsection{\texorpdfstring{Install}{Install}}\label{readme.md_autotoc_md33192}
This package is \href{https://gist.github.com/sindresorhus/a39789f98801d908bbc7ff3ecc99d99c}{\texttt{ ESM only}}. In Node.\+js (version 16+), install with \href{https://docs.npmjs.com/cli/install}{\texttt{ npm}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{npm\ install\ trough}

\end{DoxyCode}


In Deno with \href{https://esm.sh}{\texttt{ {\ttfamily esm.\+sh}}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough,\ wrap\}\ from\ 'https://esm.sh/trough@2'}

\end{DoxyCode}


In browsers with \href{https://esm.sh}{\texttt{ {\ttfamily esm.\+sh}}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{<script\ type="{}module"{}>}
\DoxyCodeLine{\ \ import\ \{trough,\ wrap\}\ from\ 'https://esm.sh/trough@2?bundle'}
\DoxyCodeLine{</script>}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md33193}{}\doxysubsection{\texorpdfstring{Use}{Use}}\label{readme.md_autotoc_md33193}

\begin{DoxyCode}{0}
\DoxyCodeLine{import\ fs\ from\ 'node:fs'}
\DoxyCodeLine{import\ path\ from\ 'node:path'}
\DoxyCodeLine{import\ process\ from\ 'node:process'}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ pipeline\ =\ trough()}
\DoxyCodeLine{\ \ .use(function\ (fileName)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('Checking‚Ä¶\ '\ +\ fileName)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .use(function\ (fileName)\ \{}
\DoxyCodeLine{\ \ \ \ return\ path.join(process.cwd(),\ fileName)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .use(function\ (filePath,\ next)\ \{}
\DoxyCodeLine{\ \ \ \ fs.stat(filePath,\ function\ (error,\ stats)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ next(error,\ \{filePath,\ stats\})}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .use(function\ (ctx,\ next)\ \{}
\DoxyCodeLine{\ \ \ \ if\ (ctx.stats.isFile())\ \{}
\DoxyCodeLine{\ \ \ \ \ \ fs.readFile(ctx.filePath,\ next)}
\DoxyCodeLine{\ \ \ \ \}\ else\ \{}
\DoxyCodeLine{\ \ \ \ \ \ next(new\ Error('Expected\ file'))}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{}
\DoxyCodeLine{pipeline.run('readme.md',\ console.log)}
\DoxyCodeLine{pipeline.run('node\_modules',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Checking‚Ä¶\ readme.md}
\DoxyCodeLine{Checking‚Ä¶\ node\_modules}
\DoxyCodeLine{Error:\ Expected\ file}
\DoxyCodeLine{\ \ \ \ at\ \string~/example.js:22:12}
\DoxyCodeLine{\ \ \ \ at\ wrapped\ (\string~/node\_modules/trough/index.js:111:16)}
\DoxyCodeLine{\ \ \ \ at\ next\ (\string~/node\_modules/trough/index.js:62:23)}
\DoxyCodeLine{\ \ \ \ at\ done\ (\string~/node\_modules/trough/index.js:145:7)}
\DoxyCodeLine{\ \ \ \ at\ \string~/example.js:15:7}
\DoxyCodeLine{\ \ \ \ at\ FSReqCallback.oncomplete\ (node:fs:199:5)}
\DoxyCodeLine{null\ <Buffer\ 23\ 20\ 74\ 72\ 6f\ 75\ 67\ 68\ 0a\ 0a\ 5b\ 21\ 5b\ 42\ 75\ 69\ 6c\ 64\ 5d\ 5b\ 62\ 75\ 69\ 6c\ 64\ 2d\ 62\ 61\ 64\ 67\ 65\ 5d\ 5d\ 5b\ 62\ 75\ 69\ 6c\ 64\ 5d\ 0a\ 5b\ 21\ 5b\ 43\ 6f\ 76\ 65\ 72\ 61\ ...\ 7994\ more\ bytes>}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md33194}{}\doxysubsection{\texorpdfstring{API}{API}}\label{readme.md_autotoc_md33194}
This package exports the identifiers \`{}trough\`{} and \`{}wrap\`{}. There is no default export.

It exports the \href{https://www.typescriptlang.org}{\texttt{ Type\+Script}} types \`{}\+Callback\`{}, \`{}\+Middleware\`{}, \doxylink{pipeline_8cc_a219a66c8cf101fc8c26a5c86edd940f4}{\`{}\+Pipeline\`{}}, \`{}\+Run\`{}, and \`{}\+Use\`{}.\hypertarget{readme.md_autotoc_md33195}{}\doxysubsubsection{\texorpdfstring{{\ttfamily trough()}}{{\ttfamily trough()}}}\label{readme.md_autotoc_md33195}
Create new middleware.\hypertarget{readme.md_autotoc_md33196}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33196}
There are no parameters.\hypertarget{readme.md_autotoc_md33197}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33197}
\doxylink{pipeline_8cc_a219a66c8cf101fc8c26a5c86edd940f4}{\`{}\+Pipeline\`{}}.\hypertarget{readme.md_autotoc_md33198}{}\doxysubsubsection{\texorpdfstring{{\ttfamily wrap(middleware, callback)}}{{\ttfamily wrap(middleware, callback)}}}\label{readme.md_autotoc_md33198}
Wrap {\ttfamily middleware} into a uniform interface.

You can pass all input to the resulting function. {\ttfamily callback} is then called with the output of {\ttfamily middleware}.

If {\ttfamily middleware} accepts more arguments than the later given in input, an extra {\ttfamily done} function is passed to it after that input, which must be called by {\ttfamily middleware}.

The first value in {\ttfamily input} is the main input value. All other input values are the rest input values. The values given to {\ttfamily callback} are the input values, merged with every non-\/nullish output value.


\begin{DoxyItemize}
\item if {\ttfamily middleware} throws an error, returns a promise that is rejected, or calls the given {\ttfamily done} function with an error, {\ttfamily callback} is called with that error
\item if {\ttfamily middleware} returns a value or returns a promise that is resolved, that value is the main output value
\item if {\ttfamily middleware} calls {\ttfamily done}, all non-\/nullish values except for the first one (the error) overwrite the output values
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33199}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33199}

\begin{DoxyItemize}
\item {\ttfamily middleware} (\`{}\+Middleware\`{}) ‚Äî function to wrap
\item {\ttfamily callback} (\`{}\+Callback\`{}) ‚Äî callback called with the output of {\ttfamily middleware}
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33200}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33200}
Wrapped middleware (\`{}\+Run\`{}).\hypertarget{readme.md_autotoc_md33201}{}\doxysubsubsection{\texorpdfstring{{\ttfamily Callback}}{{\ttfamily Callback}}}\label{readme.md_autotoc_md33201}
Callback function (Type\+Script type).\hypertarget{readme.md_autotoc_md33202}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33202}

\begin{DoxyItemize}
\item {\ttfamily error} ({\ttfamily Error}, optional) ‚Äî error, if any
\item {\ttfamily ...output} ({\ttfamily Array\texorpdfstring{$<$}{<}unknown\texorpdfstring{$>$}{>}}, optional) ‚Äî output values
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33203}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33203}
Nothing ({\ttfamily undefined}).\hypertarget{readme.md_autotoc_md33204}{}\doxysubsubsection{\texorpdfstring{{\ttfamily Middleware}}{{\ttfamily Middleware}}}\label{readme.md_autotoc_md33204}
A middleware function called with the output of its predecessor (Type\+Script type).\hypertarget{readme.md_autotoc_md33205}{}\doxysubsubsubsubsubsection{\texorpdfstring{Synchronous}{Synchronous}}\label{readme.md_autotoc_md33205}
If {\ttfamily fn} returns or throws an error, the pipeline fails and {\ttfamily done} is called with that error.

If {\ttfamily fn} returns a value (neither {\ttfamily null} nor {\ttfamily undefined}), the first {\ttfamily input} of the next function is set to that value (all other {\ttfamily input} is passed through).

The following example shows how returning an error stops the pipeline\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing)\ \{}
\DoxyCodeLine{\ \ \ \ return\ new\ Error('Got:\ '\ +\ thing)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('some\ value',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Error:\ Got:\ some\ value}
\DoxyCodeLine{\ \ \ \ at\ \string~/example.js:5:12}
\DoxyCodeLine{\ \ \ \ ‚Ä¶}

\end{DoxyCode}


The following example shows how throwing an error stops the pipeline\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing)\ \{}
\DoxyCodeLine{\ \ \ \ throw\ new\ Error('Got:\ '\ +\ thing)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('more\ value',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Error:\ Got:\ more\ value}
\DoxyCodeLine{\ \ \ \ at\ \string~/example.js:5:11}
\DoxyCodeLine{\ \ \ \ ‚Ä¶}

\end{DoxyCode}


The following example shows how the first output can be modified\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing)\ \{}
\DoxyCodeLine{\ \ \ \ return\ 'even\ '\ +\ thing}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('more\ value',\ 'untouched',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{null\ \textcolor{stringliteral}{'even\ more\ value'}\ \textcolor{stringliteral}{'untouched'}}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md33206}{}\doxysubsubsubsubsubsection{\texorpdfstring{Promise}{Promise}}\label{readme.md_autotoc_md33206}
If {\ttfamily fn} returns a promise, and that promise rejects, the pipeline fails and {\ttfamily done} is called with the rejected value.

If {\ttfamily fn} returns a promise, and that promise resolves with a value (neither {\ttfamily null} nor {\ttfamily undefined}), the first {\ttfamily input} of the next function is set to that value (all other {\ttfamily input} is passed through).

The following example shows how rejecting a promise stops the pipeline\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing)\ \{}
\DoxyCodeLine{\ \ \ \ return\ new\ Promise(function\ (resolve,\ reject)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ reject('Got:\ '\ +\ thing)}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('thing',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Got:\ thing}

\end{DoxyCode}


The following example shows how the input isn‚Äôt touched by resolving to {\ttfamily null}.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ ()\ \{}
\DoxyCodeLine{\ \ \ \ return\ new\ Promise(function\ (resolve)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ setTimeout(function\ ()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ resolve(null)}
\DoxyCodeLine{\ \ \ \ \ \ \},\ 100)}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('Input',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{null\ \textcolor{stringliteral}{'Input'}}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md33207}{}\doxysubsubsubsubsubsection{\texorpdfstring{Asynchronous}{Asynchronous}}\label{readme.md_autotoc_md33207}
If {\ttfamily fn} accepts one more argument than the given {\ttfamily input}, a {\ttfamily next} function is given (after the input). {\ttfamily next} must be called, but doesn‚Äôt have to be called async.

If {\ttfamily next} is given a value (neither {\ttfamily null} nor {\ttfamily undefined}) as its first argument, the pipeline fails and {\ttfamily done} is called with that value.

If {\ttfamily next} is given no value (either {\ttfamily null} or {\ttfamily undefined}) as the first argument, all following non-\/nullish values change the input of the following function, and all nullish values default to the {\ttfamily input}.

The following example shows how passing a first argument stops the pipeline\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing,\ next)\ \{}
\DoxyCodeLine{\ \ \ \ next(new\ Error('Got:\ '\ +\ thing))}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('thing',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{Error:\ Got:\ thing}
\DoxyCodeLine{\ \ \ \ at\ \string~/example.js:5:10}

\end{DoxyCode}


The following example shows how more values than the input are passed.


\begin{DoxyCode}{0}
\DoxyCodeLine{import\ \{trough\}\ from\ 'trough'}
\DoxyCodeLine{}
\DoxyCodeLine{trough()}
\DoxyCodeLine{\ \ .use(function\ (thing,\ next)\ \{}
\DoxyCodeLine{\ \ \ \ setTimeout(function\ ()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ next(null,\ null,\ 'values')}
\DoxyCodeLine{\ \ \ \ \},\ 100)}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .run('some',\ console.log)}

\end{DoxyCode}


Yields\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{null\ \textcolor{stringliteral}{'some'}\ \textcolor{stringliteral}{'values'}}

\end{DoxyCode}
\hypertarget{readme.md_autotoc_md33208}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33208}

\begin{DoxyItemize}
\item {\ttfamily ...input} ({\ttfamily Array\texorpdfstring{$<$}{<}any\texorpdfstring{$>$}{>}}, optional) ‚Äî input values
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33209}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33209}
Output, promise, etc ({\ttfamily any}).\hypertarget{readme.md_autotoc_md33210}{}\doxysubsubsection{\texorpdfstring{{\ttfamily Pipeline}}{{\ttfamily Pipeline}}}\label{readme.md_autotoc_md33210}
Pipeline (Type\+Script type).\hypertarget{readme.md_autotoc_md33211}{}\doxysubsubsubsubsubsection{\texorpdfstring{Properties}{Properties}}\label{readme.md_autotoc_md33211}

\begin{DoxyItemize}
\item {\ttfamily run} (\`{}\+Run\`{}) ‚Äî run the pipeline
\item {\ttfamily use} (\`{}\+Use\`{}) ‚Äî add middleware
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33212}{}\doxysubsubsection{\texorpdfstring{{\ttfamily Run}}{{\ttfamily Run}}}\label{readme.md_autotoc_md33212}
Call all middleware (Type\+Script type).

Calls {\ttfamily done} on completion with either an error or the output of the last middleware.

\begin{quote}
üëâ {\bfseries{Note}}\+: as the length of input defines whether async functions get a {\ttfamily next} function, it‚Äôs recommended to keep {\ttfamily input} at one value normally. \end{quote}
\hypertarget{readme.md_autotoc_md33213}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33213}

\begin{DoxyItemize}
\item {\ttfamily ...input} ({\ttfamily Array\texorpdfstring{$<$}{<}any\texorpdfstring{$>$}{>}}, optional) ‚Äî input values
\item {\ttfamily done} (\`{}\+Callback\`{}) ‚Äî callback called when done
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33214}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33214}
Nothing ({\ttfamily undefined}).\hypertarget{readme.md_autotoc_md33215}{}\doxysubsubsection{\texorpdfstring{{\ttfamily Use}}{{\ttfamily Use}}}\label{readme.md_autotoc_md33215}
Add middleware (Type\+Script type).\hypertarget{readme.md_autotoc_md33216}{}\doxysubsubsubsubsubsection{\texorpdfstring{Parameters}{Parameters}}\label{readme.md_autotoc_md33216}

\begin{DoxyItemize}
\item {\ttfamily middleware} (\`{}\+Middleware\`{}) ‚Äî middleware function
\end{DoxyItemize}\hypertarget{readme.md_autotoc_md33217}{}\doxysubsubsubsubsubsection{\texorpdfstring{Returns}{Returns}}\label{readme.md_autotoc_md33217}
Current pipeline (\doxylink{pipeline_8cc_a219a66c8cf101fc8c26a5c86edd940f4}{\`{}\+Pipeline\`{}}).\hypertarget{readme.md_autotoc_md33218}{}\doxysubsection{\texorpdfstring{Compatibility}{Compatibility}}\label{readme.md_autotoc_md33218}
This projects is compatible with maintained versions of Node.\+js.

When we cut a new major release, we drop support for unmaintained versions of Node. This means we try to keep the current release line, {\ttfamily trough@2}, compatible with Node.\+js 12.\hypertarget{readme.md_autotoc_md33219}{}\doxysubsection{\texorpdfstring{Security}{Security}}\label{readme.md_autotoc_md33219}
This package is safe.\hypertarget{readme.md_autotoc_md33220}{}\doxysubsection{\texorpdfstring{Contribute}{Contribute}}\label{readme.md_autotoc_md33220}
Yes please! See \href{https://opensource.guide/how-to-contribute/}{\texttt{ How to Contribute to Open Source}}.\hypertarget{readme.md_autotoc_md33221}{}\doxysubsection{\texorpdfstring{License}{License}}\label{readme.md_autotoc_md33221}
\mbox{[}MIT\mbox{]}\mbox{[}file-\/license\mbox{]} ¬© \href{https://wooorm.com}{\texttt{ Titus Wormer}} 