\doxysection{node\+\_\+modules/tinypool Directory Reference}
\hypertarget{dir_3e4eca3d5f9c9ee19611c1311de3124f}{}\label{dir_3e4eca3d5f9c9ee19611c1311de3124f}\index{node\_modules/tinypool Directory Reference@{node\_modules/tinypool Directory Reference}}


\doxysubsection{Detailed Description}
\begin{quote}
Piscina\+: A fast, efficient Node.\+js Worker Thread Pool implementation \end{quote}


Tinypool is a fork of piscina. What we try to achieve in this library, is to eliminate some dependencies and features that our target users don\textquotesingle{}t need (currently, our main user will be Vitest). Tinypool\textquotesingle{}s install size (38KB) can then be smaller than Piscina\textquotesingle{}s install size (6MB). If you need features like \href{https://github.com/piscinajs/piscina\#property-utilization-readonly}{\texttt{ utilization}} or \href{https://github.com/piscinajs/piscina\#thread-priority-on-linux-systems}{\texttt{ NAPI}}, \href{https://github.com/piscinajs/piscina}{\texttt{ Piscina}} is a better choice for you. We think that Piscina is an amazing library, and we may try to upstream some of the dependencies optimization in this fork.


\begin{DoxyItemize}
\item ✅ Smaller install size, 38KB
\item ✅ Minimal
\item ✅ No dependencies
\item ✅ Physical cores instead of Logical cores with \href{https://www.npmjs.com/package/physical-cpu-count}{\texttt{ physical-\/cpu-\/count}}
\item ✅ Supports {\ttfamily worker\+\_\+threads} and {\ttfamily child\+\_\+process}
\item ❌ No utilization
\item ❌ No NAPI
\item Written in Type\+Script, and ESM support only. For Node.\+js 18.\+x and higher.
\end{DoxyItemize}

{\itshape In case you need more tiny libraries like tinypool or tinyspy, please consider submitting an \href{https://github.com/tinylibs/rfcs}{\texttt{ RFC}}}\hypertarget{README.md_autotoc_md32868}{}\doxysubsection{\texorpdfstring{Example}{Example}}\label{README.md_autotoc_md32868}
\hypertarget{README.md_autotoc_md32869}{}\doxysubsubsection{\texorpdfstring{Using {\ttfamily node\+:worker\+\_\+threads}}{Using {\ttfamily node\+:worker\+\_\+threads}}}\label{README.md_autotoc_md32869}
\hypertarget{README.md_autotoc_md32870}{}\doxysubsubsubsection{\texorpdfstring{Basic usage}{Basic usage}}\label{README.md_autotoc_md32870}

\begin{DoxyCode}{0}
\DoxyCodeLine{//\ main.mjs}
\DoxyCodeLine{import\ Tinypool\ from\ 'tinypool'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ pool\ =\ new\ Tinypool(\{}
\DoxyCodeLine{\ \ filename:\ new\ URL('./worker.mjs',\ import.meta.url).href,}
\DoxyCodeLine{\})}
\DoxyCodeLine{const\ result\ =\ await\ pool.run(\{\ a:\ 4,\ b:\ 6\ \})}
\DoxyCodeLine{console.log(result)\ //\ Prints\ 10}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Make\ sure\ to\ destroy\ pool\ once\ it's\ not\ needed\ anymore}
\DoxyCodeLine{//\ This\ terminates\ all\ pool's\ idle\ workers}
\DoxyCodeLine{await\ pool.destroy()}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ worker.mjs}
\DoxyCodeLine{export\ default\ (\{\ a,\ b\ \})\ =>\ \{}
\DoxyCodeLine{\ \ return\ a\ +\ b}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md32871}{}\doxysubsubsubsection{\texorpdfstring{Main thread \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker thread communication}{Main thread \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker thread communication}}\label{README.md_autotoc_md32871}


{\bfseries{See code}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ main.mjs}
\DoxyCodeLine{import\ Tinypool\ from\ 'tinypool'}
\DoxyCodeLine{import\ \{\ MessageChannel\ \}\ from\ 'node:worker\_threads'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ pool\ =\ new\ Tinypool(\{}
\DoxyCodeLine{\ \ filename:\ new\ URL('./worker.mjs',\ import.meta.url).href,}
\DoxyCodeLine{\})}
\DoxyCodeLine{const\ \{\ port1,\ port2\ \}\ =\ new\ MessageChannel()}
\DoxyCodeLine{const\ promise\ =\ pool.run(\{\ port:\ port1\ \},\ \{\ transferList:\ [port1]\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{port2.on('message',\ (message)\ =>\ console.log('Main\ thread\ received:',\ message))}
\DoxyCodeLine{setTimeout(()\ =>\ port2.postMessage('Hello\ from\ main\ thread!'),\ 1000)}
\DoxyCodeLine{}
\DoxyCodeLine{await\ promise}
\DoxyCodeLine{}
\DoxyCodeLine{port1.close()}
\DoxyCodeLine{port2.close()}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ worker.mjs}
\DoxyCodeLine{export\ default\ (\{\ port\ \})\ =>\ \{}
\DoxyCodeLine{\ \ return\ new\ Promise((resolve)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ port.on('message',\ (message)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ console.log('Worker\ received:',\ message)}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ port.postMessage('Hello\ from\ worker\ thread!')}
\DoxyCodeLine{\ \ \ \ \ \ resolve()}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\}}

\end{DoxyCode}


\end{adjustwidth}
\hypertarget{README.md_autotoc_md32872}{}\doxysubsubsection{\texorpdfstring{Using {\ttfamily node\+:child\+\_\+process}}{Using {\ttfamily node\+:child\+\_\+process}}}\label{README.md_autotoc_md32872}
\hypertarget{README.md_autotoc_md32873}{}\doxysubsubsubsection{\texorpdfstring{Basic usage}{Basic usage}}\label{README.md_autotoc_md32873}


{\bfseries{See code}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ main.mjs}
\DoxyCodeLine{import\ Tinypool\ from\ 'tinypool'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ pool\ =\ new\ Tinypool(\{}
\DoxyCodeLine{\ \ runtime:\ 'child\_process',}
\DoxyCodeLine{\ \ filename:\ new\ URL('./worker.mjs',\ import.meta.url).href,}
\DoxyCodeLine{\})}
\DoxyCodeLine{const\ result\ =\ await\ pool.run(\{\ a:\ 4,\ b:\ 6\ \})}
\DoxyCodeLine{console.log(result)\ //\ Prints\ 10}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ worker.mjs}
\DoxyCodeLine{export\ default\ (\{\ a,\ b\ \})\ =>\ \{}
\DoxyCodeLine{\ \ return\ a\ +\ b}
\DoxyCodeLine{\}}

\end{DoxyCode}


\end{adjustwidth}
\hypertarget{README.md_autotoc_md32874}{}\doxysubsubsubsection{\texorpdfstring{Main process \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker process communication}{Main process \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker process communication}}\label{README.md_autotoc_md32874}


{\bfseries{See code}}\begin{adjustwidth}{1em}{0em}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ main.mjs}
\DoxyCodeLine{import\ Tinypool\ from\ 'tinypool'}
\DoxyCodeLine{}
\DoxyCodeLine{const\ pool\ =\ new\ Tinypool(\{}
\DoxyCodeLine{\ \ runtime:\ 'child\_process',}
\DoxyCodeLine{\ \ filename:\ new\ URL('./worker.mjs',\ import.meta.url).href,}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{const\ messages\ =\ []}
\DoxyCodeLine{const\ listeners\ =\ []}
\DoxyCodeLine{const\ channel\ =\ \{}
\DoxyCodeLine{\ \ onMessage:\ (listener)\ =>\ listeners.push(listener),}
\DoxyCodeLine{\ \ postMessage:\ (message)\ =>\ messages.push(message),}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{const\ promise\ =\ pool.run(\{\},\ \{\ channel\ \})}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Send\ message\ to\ worker}
\DoxyCodeLine{setTimeout(}
\DoxyCodeLine{\ \ ()\ =>\ listeners.forEach((listener)\ =>\ listener('Hello\ from\ main\ process')),}
\DoxyCodeLine{\ \ 1000}
\DoxyCodeLine{)}
\DoxyCodeLine{}
\DoxyCodeLine{//\ Wait\ for\ task\ to\ finish}
\DoxyCodeLine{await\ promise}
\DoxyCodeLine{}
\DoxyCodeLine{console.log(messages)}
\DoxyCodeLine{//\ [\{\ received:\ 'Hello\ from\ main\ process',\ response:\ 'Hello\ from\ worker'\ \}]}

\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{//\ worker.mjs}
\DoxyCodeLine{export\ default\ async\ function\ run()\ \{}
\DoxyCodeLine{\ \ return\ new\ Promise((resolve)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ process.on('message',\ (message)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ \ \ //\ Ignore\ Tinypool's\ internal\ messages}
\DoxyCodeLine{\ \ \ \ \ \ if\ (message?.\_\_tinypool\_worker\_message\_\_)\ return}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ \ \ process.send(\{\ received:\ message,\ response:\ 'Hello\ from\ worker'\ \})}
\DoxyCodeLine{\ \ \ \ \ \ resolve()}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\}}

\end{DoxyCode}


\end{adjustwidth}
\hypertarget{README.md_autotoc_md32875}{}\doxysubsection{\texorpdfstring{API}{API}}\label{README.md_autotoc_md32875}
We have a similar API to Piscina, so for more information, you can read Piscina\textquotesingle{}s detailed \href{https://github.com/piscinajs/piscina\#piscina---the-nodejs-worker-pool}{\texttt{ documentation}} and apply the same techniques here.\hypertarget{README.md_autotoc_md32876}{}\doxysubsubsection{\texorpdfstring{Tinypool specific APIs}{Tinypool specific APIs}}\label{README.md_autotoc_md32876}
\hypertarget{README.md_autotoc_md32877}{}\doxysubsubsubsection{\texorpdfstring{Pool constructor options}{Pool constructor options}}\label{README.md_autotoc_md32877}

\begin{DoxyItemize}
\item {\ttfamily isolate\+Workers}\+: Disabled by default. Always starts with a fresh worker when running tasks to isolate the environment.
\item {\ttfamily terminate\+Timeout}\+: Disabled by default. If terminating a worker takes {\ttfamily terminate\+Timeout} amount of milliseconds to execute, an error is raised.
\item {\ttfamily max\+Memory\+Limit\+Before\+Recycle}\+: Disabled by default. When defined, the worker\textquotesingle{}s heap memory usage is compared against this value after task has been finished. If the current memory usage exceeds this limit, worker is terminated and a new one is started to take its place. This option is useful when your tasks leak memory and you don\textquotesingle{}t want to enable {\ttfamily isolate\+Workers} option.
\item {\ttfamily runtime}\+: Used to pick worker runtime. Default value is {\ttfamily worker\+\_\+threads}.
\begin{DoxyItemize}
\item {\ttfamily worker\+\_\+threads}\+: Runs workers in \href{https://nodejs.org/api/worker_threads.html}{\texttt{ {\ttfamily node\+:worker\+\_\+threads}}}. For {\ttfamily main thread \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker thread} communication you can use \href{https://nodejs.org/api/worker_threads.html\#class-messageport}{\texttt{ {\ttfamily Message\+Port}}} in the {\ttfamily pool.\+run()} method\textquotesingle{}s \href{https://nodejs.org/api/worker_threads.html\#portpostmessagevalue-transferlist}{\texttt{ {\ttfamily transfer\+List} option}}. See example.
\item {\ttfamily child\+\_\+process}\+: Runs workers in \href{https://nodejs.org/api/child_process.html}{\texttt{ {\ttfamily node\+:child\+\_\+process}}}. For {\ttfamily main thread \texorpdfstring{$<$}{<}-\/\texorpdfstring{$>$}{>} worker process} communication you can use {\ttfamily Tinypool\+Channel} in the {\ttfamily pool.\+run()} method\textquotesingle{}s {\ttfamily channel} option. For filtering out the Tinypool\textquotesingle{}s internal messages see {\ttfamily Tinypool\+Worker\+Message}. See example.
\end{DoxyItemize}
\end{DoxyItemize}\hypertarget{README.md_autotoc_md32878}{}\doxysubsubsubsection{\texorpdfstring{Pool methods}{Pool methods}}\label{README.md_autotoc_md32878}

\begin{DoxyItemize}
\item {\ttfamily cancel\+Pending\+Tasks()}\+: Gracefully cancels all pending tasks without stopping or interfering with on-\/going tasks. This method is useful when your tasks may have side effects and should not be terminated forcefully during task execution. If your tasks don\textquotesingle{}t have any side effects you may want to use \href{https://github.com/piscinajs/piscina\#cancelable-tasks}{\texttt{ {\ttfamily \{ signal \}}}} option for forcefully terminating all tasks, including the on-\/going ones, instead.
\item {\ttfamily recycle\+Workers(options)}\+: Waits for all current tasks to finish and re-\/creates all workers. Can be used to force isolation imperatively even when {\ttfamily isolate\+Workers} is disabled. Accepts {\ttfamily \{ runtime \}} option as argument.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md32879}{}\doxysubsubsubsection{\texorpdfstring{Exports}{Exports}}\label{README.md_autotoc_md32879}

\begin{DoxyItemize}
\item {\ttfamily worker\+Id}\+: Each worker now has an id ( \texorpdfstring{$<$}{<}= {\ttfamily max\+Threads}) that can be imported from {\ttfamily tinypool} in the worker itself (or {\ttfamily process.\+\_\+\+\_\+tinypool\+\_\+state\+\_\+\+\_\+.\+worker\+Id}).
\end{DoxyItemize}\hypertarget{README.md_autotoc_md32880}{}\doxysubsection{\texorpdfstring{Authors}{Authors}}\label{README.md_autotoc_md32880}
\texorpdfstring{$\vert$}{|} \href{https://github.com/Aslemammad}{\texttt{ ~\newline
 Mohammad Bagher }} \texorpdfstring{$\vert$}{|} \texorpdfstring{$\vert$}{|} -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/--- \texorpdfstring{$\vert$}{|}\hypertarget{README.md_autotoc_md32881}{}\doxysubsection{\texorpdfstring{Sponsors}{Sponsors}}\label{README.md_autotoc_md32881}
Your sponsorship can make a huge difference in continuing our work in open source!

\href{https://cdn.jsdelivr.net/gh/aslemammad/static/sponsors.svg}{\texttt{  }} \hypertarget{README.md_autotoc_md32882}{}\doxysubsection{\texorpdfstring{Credits}{Credits}}\label{README.md_autotoc_md32882}
\href{https://vitest.dev/}{\texttt{ The Vitest team}} for giving me the chance of creating and maintaing this project for vitest.

\href{https://github.com/piscinajs/piscina}{\texttt{ Piscina}}, because Tinypool is not more than a friendly fork of piscina. 